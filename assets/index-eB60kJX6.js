(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var L=function(){function t(){this._callbacks=[]}return t.prototype.addListener=function(e){this._callbacks.push(e)},t.prototype.removeListener=function(e){var n=this._callbacks.indexOf(e);n>-1&&this._callbacks.splice(n,1)},t.prototype.call=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._callbacks.forEach(function(r){r.apply(r,e)},this)},t}(),tt=function(){function t(e,n){this._scene=e,this._personaId=n,this._scene.onConversationResultEvents[n]||(this._scene.onConversationResultEvents[n]=new L),this._onConversationResultEvent=this._scene.onConversationResultEvents[n],this._scene.onSpeechMarkerEvents[n]||(this._scene.onSpeechMarkerEvents[n]=new L),this._onSpeechMarkerEvent=this._scene.onSpeechMarkerEvents[n]}return t.prototype.startSpeaking=function(e,n,r){n===void 0&&(n=null),r===void 0&&(r=null);var i={personaId:this._personaId,text:e};return n&&(i.context=n),r&&(i.optionalArgs=r),this._scene.sendRequest("startSpeaking",i)},t.prototype.stopSpeaking=function(){var e={personaId:this._personaId};return this._scene.sendRequest("stopSpeaking",e)},t.prototype.conversationSend=function(e,n,r){var i={personaId:this._personaId,text:e,variables:n,optionalArgs:r};return this._scene.sendRequest("conversationSend",i)},t.prototype.conversationSetVariables=function(e){var n={personaId:this._personaId,variables:e};return this._scene.sendRequest("conversationSetVariables",n)},t.prototype.conversationGetVariables=function(){var e={personaId:this._personaId};return this._scene.sendRequest("conversationGetVariables",e)},t.prototype.animateToNamedCameraWithOrbitPan=function(e,n,r,i,o,a){var u={personaId:this._personaId,cameraName:e,time:n,orbitDegX:r,orbitDegY:i,panDeg:o,tiltDeg:a};return this._scene.sendRequest("animateToNamedCamera",u)},t.prototype.playAnimation=function(e){var n={personaId:this._personaId,animation:e};return this._scene.sendRequest("playAnimation",n)},t.prototype.getVariables=function(e,n,r){n===void 0&&(n=!1),r===void 0&&(r="");var i={personaId:this._personaId,names:e,errorTolerant:n,format:r};return this._scene.sendRequest("getVariables",i)},t.prototype.setVariables=function(e){var n={personaId:this._personaId,Variables:e};return this._scene.sendRequest("setVariables",n)},t.prototype.setVariablesOneway=function(e){var n={personaId:this._personaId,Variables:e};this._scene.sendOnewaySceneRequest("setVariables",n)},t.prototype.getVariablesList=function(){var e={personaId:this._personaId};return this._scene.sendRequest("getVariablesList",e)},t.prototype.getModelVariablesList=function(e){var n={personaId:this._personaId,Models:e};return this._scene.sendRequest("getModelVariablesList",n)},t.prototype.getModelChildren=function(e){var n={personaId:this._personaId,Models:e};return this._scene.sendRequest("getModelChildren",n)},t.prototype.getModelFilterSearchResult=function(e){var n={personaId:this._personaId,Models:e};return this._scene.sendRequest("getModelFilterSearchResult",n)},t.prototype.getModelVariableFilterSearchResult=function(e){var n={personaId:this._personaId,Models:e};return this._scene.sendRequest("getModelVariableFilterSearchResult",n)},t.prototype.getConnectorEntries=function(e){var n={personaId:this._personaId,model:e};return this._scene.sendRequest("getConnectorEntries",n)},t.prototype.startBlProfiling=function(){var e={personaId:this._personaId};return this._scene.sendRequest("startBlProfiling",e)},t.prototype.stopBlProfiling=function(e){var n={personaId:this._personaId,reverse:e};return this._scene.sendRequest("stopBlProfiling",n)},t.prototype.getModelHierarchy=function(e){var n={personaId:this._personaId,model:e};return this._scene.sendRequest("getModelHierarchy",n)},t.prototype.createMonitorSet=function(e,n){var r={personaId:this._personaId,setName:[{SetName:e}],variables:n};return this._scene.sendRequest("createMonitorSet",r)},t.prototype.removeMonitorSet=function(e){var n={personaId:this._personaId,setName:[{SetName:e}]};return this._scene.sendRequest("removeMonitorSet",n)},t.prototype.addVariableToMonitorSet=function(e,n){var r={personaId:this._personaId,setName:[{SetName:e}],variables:n};return this._scene.sendRequest("addVariableToMonitorSet",r)},t.prototype.removeVariableFromMonitorSet=function(e,n){var r={personaId:this._personaId,setName:[{SetName:e}],variables:n};return this._scene.sendRequest("removeVariableFromMonitorSet",r)},t.prototype.renderModel=function(e){var n={personaId:this._personaId,modelName:e};return this._scene.sendRequest("renderModel",n)},Object.defineProperty(t.prototype,"onConversationResultEvent",{get:function(){return this._onConversationResultEvent},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onSpeechMarkerEvent",{get:function(){return this._onSpeechMarkerEvent},enumerable:!1,configurable:!0}),t}(),Dt=function(t,e){return Dt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},Dt(t,e)};function ii(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Dt(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var k=function(){return k=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},k.apply(this,arguments)};function oi(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function T(t,e,n,r){function i(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(l){try{s(r.next(l))}catch(f){a(f)}}function c(l){try{s(r.throw(l))}catch(f){a(f)}}function s(l){l.done?o(l.value):i(l.value).then(u,c)}s((r=r.apply(t,e||[])).next())})}function S(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(s){return function(l){return c([s,l])}}function c(s){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(n=0)),n;)try{if(r=1,i&&(o=s[0]&2?i.return:s[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;switch(i=0,o&&(s=[s[0]&2,o.value]),s[0]){case 0:case 1:o=s;break;case 4:return n.label++,{value:s[1],done:!1};case 5:n.label++,i=s[1],s=[0];continue;case 7:s=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){n.label=s[1];break}if(s[0]===6&&n.label<o[1]){n.label=o[1],o=s;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(s);break}o[2]&&n.ops.pop(),n.trys.pop();continue}s=e.call(t,n)}catch(l){s=[6,l],i=0}finally{r=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}}function Y(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function xt(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o}function Ut(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}var be=function(){function t(){var e=this;this.state="pending",this.fate="unresolved",this.promise=new Promise(function(n,r){e._resolve=n,e._reject=r}),this.promise.then(function(){return e.state="fulfilled"},function(){return e.state="rejected"})}return t.prototype.resolve=function(e){if(this.fate==="resolved"){console.error("Deferred cannot be resolved twice");return}this.fate="resolved",this._resolve(e)},t.prototype.reject=function(e){if(this.fate==="resolved"){console.error("Deferred cannot be resolved twice");return}this.fate="resolved",this._reject(e)},t.prototype.isResolved=function(){return this.fate==="resolved"},t.prototype.isPending=function(){return this.state==="pending"},t.prototype.isFulfilled=function(){return this.state==="fulfilled"},t.prototype.isRejected=function(){return this.state==="rejected"},t}(),ft=function(){function t(){this._hasMicrophone=!1,this._hasCamera=!1,this._isAndroid=!1,this._isBrowserSupported=!1,this._isEdge=!1,this._isIos=!1,this._isAndroid=this.detectAndroid(),this._isEdge=this.detectEdge(),this._isIos=this.detectIos()}return t.prototype.detectEdge=function(){return this.userAgentMatches("Edge")},t.prototype.detectAndroid=function(){return this.userAgentMatches("Android")},t.prototype.detectIos=function(){var e=(/iPad|iPhone|iPod/i.test(navigator.platform)||navigator&&navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1)&&!window.MSStream;return e},t.prototype.userAgentMatches=function(e){var n=window.navigator.userAgent,r=n.match(e);return r?r.length>0:!1},t.prototype.detectWebRTCFeatures=function(){var e=this;return new Promise(function(n,r){window.SmIsUnderRuntimeHost&&(e._isBrowserSupported=!0,e._hasMicrophone=!0,e._hasCamera=!0,n(e));var i=!1;["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(s){i||s in window&&(i=!0)});var o=navigator.userAgent.match(/iPhone|iPad|iPod/i)&&!window.MSStream,a=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);i&&o&&!a&&(i=!1),e._isBrowserSupported=i,e._isBrowserSupported||n(e);var u=null;navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(u=function(s){Promise.resolve(navigator.mediaDevices.enumerateDevices()).then(function(l){l===void 0&&(l=[]),s(l)}).catch(function(){s([])})});var c=window.MediaStreamTrack;!u&&c&&c.getSources&&(u=c.getSources.bind(c)),!u&&navigator.enumerateDevices&&(u=navigator.enumerateDevices.bind(navigator)),u?u(function(s){s.forEach(function(l){l.kind==="audioinput"&&(e._hasMicrophone=!0),l.kind==="videoinput"&&(e._hasCamera=!0)}),n(e)}):n(e)})},Object.defineProperty(t.prototype,"hasMicrophone",{get:function(){return this._hasMicrophone},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCamera",{get:function(){return this._hasCamera},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isAndroid",{get:function(){return this._isAndroid},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isBrowserSupported",{get:function(){return this._isBrowserSupported},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEdge",{get:function(){return this._isEdge},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isIos",{get:function(){return this._isIos},enumerable:!1,configurable:!0}),t}(),hn=["debug","log","warn","error"],K=function(){function t(e,n){e===void 0&&(e="log"),n===void 0&&(n=!0),this.isEnabled=n,this.availableLogLevels=[],this._minLogLevel="log",this.setMinLogLevel(e)}return t.prototype.log=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];this.isEnabled&&this.availableLogLevels.includes(e)&&console[e].apply(console,Ut([],xt(n),!1))},t.prototype.enableLogging=function(e){this.isEnabled=e},t.prototype.getMinLogLevel=function(){return this._minLogLevel},t.prototype.setMinLogLevel=function(e){var n=hn.indexOf(e);this._minLogLevel=e,this.availableLogLevels=hn.slice(n)},t}();function y(t,e){var n=new Error(t);return n.name=e,n}var ai=function(){function t(e,n){n===void 0&&(n=new K);var r=this;this.logger=n,this._isMicrophoneConnected=!1,this._isCameraConnected=!1,this._onConnectedStorage=function(i,o,a,u){},this._closed=!1,this._outgoingQueue=[],this._microphoneMuteDelay=-1,this._offsetX=0,this._offsetY=0,e&&(this._viewport_element=e),window.SmRuntimeHostReceiveMessage=this.receiveMessage.bind(this),typeof window.SmRuntimeHostStyleViewportElement=="function"&&window.SmRuntimeHostStyleViewportElement(this._viewport_element),this._onClose=function(i){},this._onMessage=function(i){},this._onUserText=function(i){},this.sendVideoBounds(0,0),setTimeout(function(){r.sendVideoBounds(0,0)},3e3),this._features=new ft,this.log("Local session created!")}return t.prototype.receiveMessage=function(e){var n,r,i=JSON.parse(e);this.log("message received: ".concat(e)),this._onMessage(i),i.name==="state"&&i.category==="scene"&&((r=(n=i.body)===null||n===void 0?void 0:n.session)===null||r===void 0?void 0:r.state)==="idle"&&(this.log("Local session ending - conversationEnded"),this.close(!0,"conversationEnded"))},Object.defineProperty(t.prototype,"onConnected",{set:function(e){this._onConnectedStorage=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onClose",{set:function(e){this._onClose=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onMessage",{set:function(e){this._onMessage=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onUserText",{set:function(e){this._onUserText=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loggingEnabled",{get:function(){return this.logger.isEnabled},set:function(e){this.logger.log("warn","loggingEnabled is deprecated and will be removed in a future version. Please use setLogging(boolean)"),this.logger.enableLogging(e)},enumerable:!1,configurable:!0}),t.prototype.setMinLogLevel=function(e){this.logger.setMinLogLevel(e)},t.prototype.setLogging=function(e){this.logger.enableLogging(e)},t.prototype.log=function(e){this.logger.log("log",e)},t.prototype.sendVideoBounds=function(e,n){var r=this;setTimeout(function(){var i=r._viewport_element;if(i){var o=document.defaultView||window,a=parseInt(o.getComputedStyle(i).width,10),u=parseInt(o.getComputedStyle(i).height,10);for(r._offsetX=0,r._offsetY=0;i&&!isNaN(i.offsetLeft)&&!isNaN(i.offsetTop);)r._offsetX+=i.offsetLeft-i.scrollLeft,r._offsetY+=i.offsetTop-i.scrollTop,i=i.offsetParent;if(document.documentElement){var c=document.documentElement.scrollLeft,s=document.documentElement.scrollTop;r._offsetX-=c,r._offsetY-=s}r.log("Updating bounds: x =  ".concat(r._offsetX," , y = ").concat(r._offsetY,"', w = ").concat(a,", h = ").concat(u));var l=r._offsetY,f=r._offsetX,d=r._offsetY+u,h=r._offsetX+a,v={name:"videoBounds",body:{top:l,left:f,bottom:d,right:h},category:"local",kind:"event"};r.sendMessage(v)}},0)},t.prototype.hideVideo=function(){var e=0,n=0,r=0,i=0,o={name:"videoBounds",body:{top:e,left:n,bottom:r,right:i},category:"local",kind:"event"};this.sendMessage(o)},t.prototype.sendRtcEvent=function(e,n){},t.prototype.connect=function(){return T(this,void 0,void 0,function(){var e,n,r,i=this;return S(this,function(o){switch(o.label){case 0:return e=new be,this.log("Local session connecting!"),this._closed=!1,[4,this._features.detectWebRTCFeatures()];case 1:return n=o.sent(),this._closed=!1,this._sessionId=void 0,this._isMicrophoneConnected=n.hasMicrophone,this._isCameraConnected=n.hasCamera,typeof window.local_websocket_port=="number"?(this._serverConnection=new WebSocket("ws://localhost:"+window.local_websocket_port),this.log("websocket open"),this._serverConnection.onmessage=function(a){i.gotMessageFromServer(a)},this._serverConnection.onerror=function(a){e.isPending()&&e.reject(y("websocket failed","serverConnectionFailed"))},this._serverConnection.onopen=function(a){window.SmRuntimeHostReceiveMessage=function(){},i.log("Local session connected!");for(var u=0;u<i._outgoingQueue.length;u++)i._serverConnection.send(JSON.stringify(i._outgoingQueue[u])),i.logger.log("log","SmLocalSession.prototype.sendMessage, forwarding message to Web Socket: "+i._outgoingQueue[u]);i._outgoingQueue=[],e.isPending()&&e.resolve()},this._serverConnection.onclose=function(a){i.logger.log("log","websocket closed: code(".concat(a.code,"), reason(").concat(a.reason,"), clean(").concat(a.wasClean,")")),e.isRejected||i.close(!1,"normal")}):(this.log("local_websocket_port not found! Failed to create WebSocket"),e.isPending()&&e.reject(y("websocket failed","local_websocket_port not found"))),r={name:"startSession",body:{},category:"scene",kind:"request"},this.sendMessage(r),[2,e.promise]}})})},t.prototype.gotMessageFromServer=function(e){var n=e.data,r=JSON.parse(n),i=r.category,o=r.name,a=r.body;i!=="webrtc"?this._onMessage(r):o==="close"&&this.close(!1,a.reason),o==="state"&&i==="scene"&&a.session!==null&&a.session!==void 0&&a.session.state==="idle"&&(this.log("Local session ending due to server idle message"),this.close(!0,"conversationEnded"))},t.prototype.sendMessage=function(e){var n=JSON.stringify(e);this._serverConnection&&this._serverConnection.readyState===WebSocket.OPEN?(this._serverConnection.send(n),this.log("SmLocalSession.prototype.sendMessage, forwarding message to Web Socket: ".concat(n))):this._outgoingQueue.push(e)},t.prototype.sendUserText=function(e){this.logger.log("log","SmLocalSession.prototype.sendUserText, discarding text: "+e)},t.prototype.close=function(e,n){if(n===void 0&&(n="normal"),!this._closed&&(this._closed=!0,this._onClose(n),this._isMicrophoneConnected=!1,this._isCameraConnected=!1,this.hideVideo(),this._serverConnection)){this.log("closing server connection");var r=1e3;this._serverConnection.close(r,n)}},Object.defineProperty(t.prototype,"peerConnection",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userMediaStream",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"serverConnection",{get:function(){return this._serverConnection},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sessionId",{get:function(){return this._sessionId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isMicrophoneConnected",{get:function(){return this._isMicrophoneConnected},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCameraConnected",{get:function(){return this._isCameraConnected},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"features",{get:function(){return this._features},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"microphoneMuteDelay",{get:function(){return this._microphoneMuteDelay},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"microphoneMuted",{get:function(){return typeof window.SmRuntimeHostIsMicrophoneMuted=="function"?window.SmRuntimeHostIsMicrophoneMuted():!1},set:function(e){typeof window.SmRuntimeHostMuteMicrophone=="function"&&window.SmRuntimeHostMuteMicrophone(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetX",{get:function(){return this._offsetX},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetY",{get:function(){return this._offsetY},enumerable:!1,configurable:!0}),t.prototype.isMicrophoneActive=function(){return this.isMicrophoneConnected&&!this.microphoneMuted},t.prototype.isCameraActive=function(){return this.isCameraConnected},t.prototype.setMediaDeviceActive=function(e){return e.microphone,e.camera,T(this,void 0,void 0,function(){return S(this,function(n){throw y("setMediaDeviceActive not supported on LocalSession","notSupported")})})},t}(),si=function(t){ii(e,t);function e(){var n=t!==null&&t.apply(this,arguments)||this;return n.requestName="",n.status=0,n}return Object.defineProperty(e.prototype,"message",{get:function(){return"Scene response failed, status: ".concat(this.status)},enumerable:!1,configurable:!0}),e}(Error),p;(function(t){t[t.None=0]="None",t[t.Microphone=1]="Microphone",t[t.MicrophoneAndCamera=2]="MicrophoneAndCamera",t[t.Camera=3]="Camera"})(p||(p={}));var kt;(function(t){t.PAGE_METADATA="PAGE_METADATA"})(kt||(kt={}));var B;(function(t){t.Disconnected="Disconnected",t.SearchingForDigitalPerson="SearchingForDigitalPerson",t.DownloadingAssets="DownloadingAssets",t.ConnectingToDigitalPerson="ConnectingToDigitalPerson",t.Connected="Connected"})(B||(B={}));var ui=function(){function t(e,n,r,i,o,a,u,c,s,l){var f=this;this._connectPendingRemoteStream=null,this._resumeRequested=!1,this._isResumedSession=!1,this._outgoingQueue=[],this._controlOpen=!1,this._controlQueue=[],this._requestedUserMedia=p.None,this._requiredUserMedia=p.None,this._onConnected=function(d,h,v,m){},this._pendingLog=[],this._closed=!1,this._shouldLogToServer=!1,this._microphoneMuteDelay=-1,this._changeUserMediaQueue=new Array,this._removeListeners=new Array,this._videoOptions={frameRate:10,width:640,height:480,facingMode:"user"},this._audioOptions={noiseSuppression:!1,autoGainControl:!1,channelCount:1,sampleRate:16e3,sampleSize:16,echoCancellation:!0},this._videoElement=e,this._serverUri=n,this._connectUserText=r||"",this._accessToken=i,this._audioOnly=o,this._audioOptions.echoCancellation=c,this._requiredUserMedia=u,this._requestedUserMedia=a,this._logger=s,this._onClose=function(d){},this._onMessage=function(d){},this._onUserText=function(d){},this._sessionError=function(d){f.log("session error: ".concat(d),"error")},this._features=new ft,this._connectionState=l}return Object.defineProperty(t.prototype,"onConnected",{set:function(e){this._onConnected=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onClose",{set:function(e){this._onClose=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onMessage",{set:function(e){this._onMessage=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onUserText",{set:function(e){this._onUserText=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loggingEnabled",{get:function(){return this._logger.isEnabled},set:function(e){this.log("loggingEnabled is deprecated and will be removed in a future version. Please use setLogging(boolean)","warn"),this._logger.enableLogging(e)},enumerable:!1,configurable:!0}),t.prototype.setMinLogLevel=function(e){this._logger.setMinLogLevel(e)},t.prototype.setLogging=function(e){this._logger.enableLogging(e)},t.prototype.log=function(e,n){if(n===void 0&&(n="debug"),this._logger.isEnabled){var r=new Date,i="smsdk: ".concat(r.toISOString(),": ").concat(e);this._shouldLogToServer&&this.logToServer(i),this._logger.log(n,i)}},t.prototype.logToServer=function(e){this.sessionId?this.sendlogMessage([e]):this._pendingLog.push(e)},t.prototype.sendlogMessage=function(e){if(this._sessionId&&e&&e.length>0){var n={category:"diagnostics",kind:"event",name:"log",body:{name:"browser",text:e}};this.sendMessage(n)}},t.prototype.connect=function(e){return T(this,void 0,void 0,function(){var n,r,i=this;return S(this,function(o){return n=new be,this._closed=!1,e&&(this._connectUserText=e),this._serverUri&&(this._serverUri.startsWith("ws:")||this._serverUri.startsWith("wss:"))?(this.selectUserMedia(this._requestedUserMedia,this._requiredUserMedia,n,this.getUserMediaSuccess.bind(this)),[2,n.promise]):(r=new XMLHttpRequest,r.open("GET","/api/jwt"+window.location.search),r.onreadystatechange=function(a){return T(i,void 0,void 0,function(){var u;return S(this,function(c){return r.readyState===XMLHttpRequest.DONE&&(r.status===200?(this.log("JWT request returned: ".concat(r.responseText)),u=JSON.parse(r.responseText),this._serverUri=u.url,this._accessToken=u.jwt,this.selectUserMedia(this._requestedUserMedia,this._requiredUserMedia,n,this.getUserMediaSuccess.bind(this))):(this.log("JWT Request failed, status: ".concat(r.statusText),"error"),n.reject(y("Failed to acquire jwt at /api/jwt","noServer")))),[2]})})},r.send(),[2,n.promise])})})},t.prototype.webcamRequested=function(e,n){return!this._audioOnly&&[p.MicrophoneAndCamera,p.Camera].some(function(r){return[e,n].includes(r)})},t.prototype.micRequested=function(e,n){return[p.Microphone,p.MicrophoneAndCamera].some(function(r){return[e,n].includes(r)})},t.prototype.getMediaConstraints=function(e,n){var r=navigator.mediaDevices.getSupportedConstraints();return this.log("Browser supports media constraints: ".concat(r)),{audio:this.micRequested(e,n)?this.buildAudioOptions():!1,video:this.webcamRequested(e,n)?this._videoOptions:!1}},t.prototype.buildAudioOptions=function(){var e=navigator.mediaDevices.getSupportedConstraints(),n=k({},this._audioOptions);return Object.keys(n).forEach(function(r){e[r]||delete n[r]}),n},t.prototype.selectUserMedia=function(e,n,r,i){var o=this;if(e===p.None&&n===p.None){i(null,r);return}if(navigator.mediaDevices.getUserMedia){var a=this.getMediaConstraints(e,n);this.log("Best video constraints: ".concat(a)),navigator.mediaDevices.getUserMedia(a).then(function(u){i(u,r)}).catch(function(u){n===e?(o.log("getUserMedia could not get required media, error given: ".concat(u),"error"),r.reject(o.MakeErrorForUserMedia(u))):n!==p.None?o.getUserMediaRequiredOnlyFallback(n,r,i):e===p.MicrophoneAndCamera?o.getUserMediaAudioOnlyFallback(r,i):i(null,r)})}else r.reject(y("Your browser does not support getUserMedia API","notSupported"))},t.prototype.getUserMediaRequiredOnlyFallback=function(e,n,r){var i=this;this.log("Retrying with required media only");var o=this.getMediaConstraints(p.None,e);return this.log("Attempt constraints: ".concat(o)),navigator.mediaDevices.getUserMedia(o).then(function(a){r(a,n)}).catch(function(a){i.log("getUserMedia could not get required media, error given: ".concat(a),"error"),n.reject(i.MakeErrorForUserMedia(a))})},t.prototype.getUserMediaAudioOnlyFallback=function(e,n){var r=this;this.log("Retrying with microphone only");var i={video:!1,audio:this.buildAudioOptions()};return this.log("Attempt constraints: ".concat(i)),navigator.mediaDevices.getUserMedia(i).then(function(o){n(o,e)}).catch(function(o){r.log("getUserMedia could not get microphone audio, error given: ".concat(o),"error"),n(null,e)})},t.prototype.MakeErrorForUserMedia=function(e){var n="noUserMedia";return y(e.message,n)},t.prototype.getUserMediaSuccess=function(e,n){var r=this;this.log("Got user media"),this._localStream=e,this.microphoneMuted=!0,this.log("connecting to: ".concat(this._serverUri)),this._accessToken?this._serverConnection=new WebSocket(this._serverUri+"?access_token="+this._accessToken):this._serverConnection=new WebSocket(this._serverUri),this._serverConnection.onmessage=function(i){try{r.gotMessageFromServer(i,n)}catch(o){r.log("unexpected exception processing received message: ".concat(o),"error")}},this._serverConnection.onerror=function(i){n.isPending()&&n.reject(y("websocket failed","serverConnectionFailed"))},this._serverConnection.onopen=function(i){r.log("Websocket open"),r._connectionState.setConnectionState(B.SearchingForDigitalPerson)},this._serverConnection.onclose=function(i){r.log("websocket closed: code(".concat(i.code,"), reason(").concat(i.reason,"), clean(").concat(i.wasClean,")")),n.isRejected||r.close(!1,"normal",n)}},t.prototype.hasTurnServer=function(e){var n,r,i,o;if(!e)return!1;try{for(var a=Y(e),u=a.next();!u.done;u=a.next()){var c=u.value;if(!(!c||!c.urls))try{for(var s=(i=void 0,Y(c.urls)),l=s.next();!l.done;l=s.next()){var f=l.value;if(f.indexOf("turn:")===0)return!0}}catch(d){i={error:d}}finally{try{l&&!l.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}}}catch(d){n={error:d}}finally{try{u&&!u.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return!1},t.prototype.gotMessageFromServer=function(e,n){var r=this,i,o,a=e.data;this.log("message received: ".concat(a));var u=JSON.parse(a),c=u.category,s=u.name,l=u.body;if(c!=="webrtc"){this._controlConnection!==null&&c==="scene"&&(this._controlOpen&&this._serverConnection.readyState===WebSocket.OPEN?this._controlConnection.send(a):this._controlQueue.push(a)),this._onMessage(u);return}if(u.kind==="event")if(s==="established"){this._connectionState.setConnectionState(B.DownloadingAssets);var f={iceServers:[]};if(l.iceServers&&(f.iceServers=l.iceServers,this.hasTurnServer(l.iceServers)&&(this.log("Detected turn server, forcing relay mode"),f.iceTransportPolicy="relay")),this.log("selected ice servers: ".concat(f.iceServers)),l.settings&&typeof l.settings.microphoneMuteDelay=="number"&&(this._microphoneMuteDelay=l.settings.microphoneMuteDelay),this.log("microphone mute delay after persona speech: ".concat(this._microphoneMuteDelay)),this._shouldLogToServer=(o=(i=l.settings)===null||i===void 0?void 0:i.logToServer)!==null&&o!==void 0?o:!1,this._peerConnection=new RTCPeerConnection(f),this._peerConnection.onicecandidate=this.gotIceCandidate.bind(this),"ontrack"in this._peerConnection&&!this._features.isEdge?(this._peerConnection.ontrack=function(E){(E.track.kind==="video"||E.track.kind==="audio")&&(!r._remoteStream||!r._audioOnly&&E.track.kind==="video")&&r.onRemoteStream(E.streams[0])},this._videoElement.addEventListener("loadeddata",this.onVideoLoaded.bind(this)),this._removeListeners.push({target:this._videoElement,name:"loadeddata",callback:this.onVideoLoaded})):this._peerConnection.onaddstream=function(E){r.onRemoteStream(E.stream)},this._peerConnection.oniceconnectionstatechange=function(E){r.log("ICE connection state: ".concat(r._peerConnection.iceConnectionState)),r._peerConnection.iceConnectionState==="failed"&&(y("ice connection failed","mediaStreamFailed"),n&&n.isPending()&&(r._serverConnection.close(),r._controlConnection&&(r._controlConnection.readyState===WebSocket.OPEN||r._controlConnection.readyState===WebSocket.CONNECTING)&&r._controlConnection.close(),n.reject(y("ice connection failed","mediaStreamFailed"))))},this.log("adding local media stream if any"),this._localStream)if(!this._peerConnection.addTrack)this._peerConnection.addStream(this._localStream),this.log("adding local media stream by stream");else try{this.log("adding local media stream by track"),this._localStream.getTracks().forEach(function(E){r._peerConnection.addTrack(E,r._localStream)})}catch(E){this.log("error: ".concat(E),"error")}if(this._peerConnection.addTransceiver("audio",{direction:"sendrecv"}),this._peerConnection.addTransceiver("video",{direction:"sendrecv"}),l.resumeSessionId){var d={voiceActivityDetection:!1,iceRestart:!0};this._sessionId=l.resumeSessionId,this._isResumedSession=!0,this.log("established, trying to resume session with session_id = ".concat(l.resumeSessionId)),this.createOffer(this._peerConnection,d).then(function(E){r.createdDescription.bind(r),r.createdDescription(E,"updateOffer")}).catch(this._sessionError.bind(this))}else{var d={voiceActivityDetection:!1,iceRestart:!1};this._isResumedSession=!1,this.createOffer(this._peerConnection,d).then(this.createdDescription.bind(this)).catch(this._sessionError.bind(this))}}else if(s==="accepted"){this._connectionState.setConnectionState(B.ConnectingToDigitalPerson),this.log("accepted, session_id = ".concat(l.sessionId)),this._sessionId=l.sessionId,this._resumeRequested=l.resumeRequested,this._server=l.server,this._sceneId=l.sceneId;for(var h=0;h<this._outgoingQueue.length;h++)this._outgoingQueue[h].body.sessionId=this._sessionId,this.sendMessage(this._outgoingQueue[h]);this._outgoingQueue=[];var v=function(){r&&r.sendCameraRotation()};window.addEventListener("orientationchange",v),this._removeListeners.push({target:window,name:"orientationchange",callback:v}),this.sendCameraRotation();var m=document.defaultView||window,O=m.getComputedStyle(this._videoElement),b=parseInt("".concat(O.width),10),A=parseInt("".concat(O.height),10);this.log("accepted, sending video width/height: ".concat(b," / ").concat(A)),this.sendVideoBounds(b,A),this.sendlogMessage(this._pendingLog),this._pendingLog=[],l.controlUrl&&(this._controlUrl=l.controlUrl,this._controlQueue=[],this._controlOpen=!1,this._controlConnection=new WebSocket(l.controlUrl+"?access_token="+this._accessToken),this._controlConnection.onmessage=function(E){var G=E.data;G&&r._serverConnection.readyState===WebSocket.OPEN&&r._serverConnection.send(G)},this._controlConnection.onerror=function(){r.close(!0,"controlFailed",n)},this._controlConnection.onopen=function(E){if(r.log("control websocket open"),!r._controlOpen){r._controlOpen=!0;for(var G=0;G<r._controlQueue.length;G++)r.log("control websocket now open, forwarding queued message: ".concat(r._controlQueue[G])),r._controlConnection.send(r._controlQueue[G]);r._controlQueue=[]}},this._controlConnection.onclose=function(E){r.log("control closed: code(".concat(E.code,"), reason(").concat(E.reason,"), clean(").concat(E.wasClean,")")),r.close(!0,"controlDisconnected",n)})}else if(s==="answer"){this.log("set remote description"),this.log(JSON.stringify(l));var C={sdp:l.sdp,type:"answer"};this.setRemoteDescription(this._peerConnection,C).then(function(){}).catch(this._sessionError.bind(this))}else if(s==="connected")this._remoteStream?(this._connectionState.setConnectionState(B.Connected),this.onConnectedSuccess(),n&&n.resolve(l.sessionId)):(this.log("Connected but no remote media stream available"),this._connectPendingRemoteStream=function(){r.onConnectedSuccess(),n&&n.resolve(l.sessionId)});else if(s==="ice"){this.log("add ice candidate");var I=void 0;if(l.complete)this._features.isEdge&&(I=this._peerConnection.addIceCandidate(new RTCIceCandidate({candidate:"",sdpMid:"",sdpMLineIndex:0})));else{var R=new RTCIceCandidate({candidate:l.candidate,sdpMid:l.sdpMid,sdpMLineIndex:l.sdpMLineIndex});I=this._peerConnection.addIceCandidate(R)}I&&I.catch(this._sessionError.bind(this))}else if(s==="offer"){this._sessionId=l.sessionId;var C={sdp:l.sdp,type:"offer"};this.setRemoteDescription(this._peerConnection,C).then(function(){return r.createAnswer(r._peerConnection)}).then(this.createdDescription.bind(this)).catch(this._sessionError.bind(this))}else s==="userText"?(this.log("rtc - user text message received: ".concat(l.userText)),this._onUserText(l.userText)):s==="close"&&this.close(!1,l.reason,n)},t.prototype.gotIceCandidate=function(e){e.candidate?(this.log("got local ice candidate"),this.sendRtcEvent("ice",{complete:!1,candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex})):(this.log("end ice candidate"),this.sendRtcEvent("ice",{complete:!0,candidate:"",sdpMid:"",sdpMLineIndex:0}))},t.prototype.createdDescription=function(e,n){var r=this;n===void 0&&(n="offer"),this.log("got description");var i={sdp:e.sdp,type:e.type};this.log(JSON.stringify({sdp:i})),this.setLocalDescription(this._peerConnection,e).then(function(){r.log("send sdp offer to server"),r.sendRtcEvent(n,{sdp:r._peerConnection.localDescription?r._peerConnection.localDescription.sdp:null,type:r._peerConnection.localDescription?r._peerConnection.localDescription.type:null,user_text:r._connectUserText,features:{videoStartedEvent:!0}})}).catch(this._sessionError.bind(this))},t.prototype.onRemoteStream=function(e){this.log("got remote stream"),this._remoteStream=e,this.log("ICE connection state: ".concat(this._peerConnection.iceConnectionState)),this._connectPendingRemoteStream&&(this._connectPendingRemoteStream(),this._connectPendingRemoteStream=null)},t.prototype.onConnectedSuccess=function(){var e=this,n,r;this._onConnected(this._resumeRequested,this._isResumedSession,this._server,this.sessionId),this._videoElement.hidden=!1,this._videoElement.srcObject=this._remoteStream;var i=function(o){return T(e,void 0,void 0,function(){return S(this,function(a){return this._remoteStream&&this._remoteStream.addTrack(o.track),[2]})})};this._peerConnection.addEventListener("track",i),this._removeListeners.push({target:this._peerConnection,name:"track",callback:i}),this.log("video enabled"),this.sendUserCamera(),(n=this._onMicrophoneActive)===null||n===void 0||n.call(this.isMicrophoneActive()),(r=this._onCameraActive)===null||r===void 0||r.call(this.isCameraActive())},t.prototype.onVideoLoaded=function(e){var n=this;this.log("video has loaded");var r=function(){n.log("video has started playing"),n.sendRtcEvent("videoStarted",{}),n.microphoneMuted=!1};if(!this._videoElement.muted){r();return}var i=function(){r(),n._videoElement.removeEventListener("volumechange",i)};this._videoElement.addEventListener("volumechange",i,!1)},t.prototype.sendRtcEvent=function(e,n){if(this._serverConnection!==null){this._sessionId&&(n.sessionId=this._sessionId);var r={category:"webrtc",kind:"event",name:e,body:n};this._sessionId||e==="offer"?this.sendMessage(r):this._outgoingQueue.push(r)}},t.prototype.sendVideoBounds=function(e,n){this.sendRtcEvent("videoBounds",{width:e,height:n})},t.prototype.sendUserCamera=function(e){var n={active:this.isCameraActive()};e!==void 0&&(n.rotation=e),this.sendRtcEvent("userCamera",n)},t.prototype.sendCameraRotation=function(){if(this._features.isIos){var e=window.orientation;this.log("send updated camera rotation, device orientation: ".concat(e));var n=0;e===0?n=90:e===90?n=180:e===180?n=270:e===-90&&(n=0),this.sendUserCamera(n)}},t.prototype.sendMessage=function(e){this._serverConnection&&(this._serverConnection.readyState===WebSocket.OPEN?this._serverConnection.send(JSON.stringify(e)):this.log("server connection not ready, discarding message: ".concat(e)))},t.prototype.sendUserText=function(e){this.sendRtcEvent("userText",{userText:e})},t.prototype.hasCamera=function(e){return e===p.Camera||e===p.MicrophoneAndCamera},t.prototype.hasMicrophone=function(e){return e===p.Microphone||e===p.MicrophoneAndCamera},t.prototype.makeUserMedia=function(e,n){return e&&n?p.MicrophoneAndCamera:e?p.Microphone:n?p.Camera:p.None},t.prototype.findSenderTrackByKind=function(e){var n,r,i;if(!this._peerConnection)return null;var o=this._peerConnection.getSenders();try{for(var a=Y(o),u=a.next();!u.done;u=a.next()){var c=u.value;if(c.track&&((i=c.track)===null||i===void 0?void 0:i.kind)===e)return c.track}}catch(s){n={error:s}}finally{try{u&&!u.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return null},t.prototype.findSenderByKind=function(e){var n,r,i,o,a,u;if(!this._peerConnection)return null;try{for(var c=Y(this._peerConnection.getTransceivers()),s=c.next();!s.done;s=c.next()){var l=s.value;if(l.direction==="sendrecv"&&((u=(a=l.receiver)===null||a===void 0?void 0:a.track)===null||u===void 0?void 0:u.kind)===e)return l.sender}}catch(v){n={error:v}}finally{try{s&&!s.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}try{for(var f=Y(this._peerConnection.getSenders()),d=f.next();!d.done;d=f.next()){var h=d.value;if(h.track===null||h.track.kind===e)return h}}catch(v){i={error:v}}finally{try{d&&!d.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}return null},t.prototype.processChangeUserMediaQueue=function(){var e,n,r,i;return T(this,void 0,void 0,function(){var o,a,u,c;return S(this,function(s){switch(s.label){case 0:if(o=this._changeUserMediaQueue.length>0?this._changeUserMediaQueue[0]:void 0,!o)return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),a=this.isMicrophoneActive(),u=this.isCameraActive(),[4,this.changeUserMediaInternal(this.makeUserMedia((e=o.microphone)!==null&&e!==void 0?e:a,(n=o.camera)!==null&&n!==void 0?n:u))];case 2:return s.sent(),o.microphone!==void 0&&o.microphone!==a&&((r=this._onMicrophoneActive)===null||r===void 0||r.call(this.isMicrophoneActive())),o.camera!==void 0&&o.camera!==u&&((i=this._onCameraActive)===null||i===void 0||i.call(this.isCameraActive())),o.deferred.resolve(),[3,4];case 3:return c=s.sent(),o.deferred.reject(c),[3,4];case 4:this._changeUserMediaQueue.shift(),s.label=5;case 5:if(o)return[3,0];s.label=6;case 6:return[2]}})})},t.prototype.changeUserMediaInternal=function(e){return T(this,void 0,void 0,function(){var n,r,i,o,a,u,c,s=this;return S(this,function(l){switch(l.label){case 0:return n=this.findSenderTrackByKind("audio"),r=this.findSenderTrackByKind("video"),i=this.hasMicrophone(e)&&(!n||n.readyState==="ended"),o=this.hasCamera(e)&&(!r||r.readyState==="ended"),a=null,i||o?(u=this.makeUserMedia(i,o),c=new be,this.selectUserMedia(u,u,c,function(f,d){return T(s,void 0,void 0,function(){return S(this,function(h){return a=f,d.resolve(),[2]})})}),[4,c.promise]):[3,2];case 1:l.sent(),this._localStream||(this._localStream=new MediaStream),l.label=2;case 2:return[4,this.updateSenderTrack("audio",this.hasMicrophone(e),a)];case 3:return l.sent(),[4,this.updateSenderTrack("video",this.hasCamera(e),a)];case 4:return l.sent(),this.sendUserCamera(),[2]}})})},t.prototype.updateSenderTrack=function(e,n,r){var i,o;return T(this,void 0,void 0,function(){var a,u,c,s;return S(this,function(l){switch(l.label){case 0:if(a=this.findSenderByKind(e),u=a==null?void 0:a.track,!(a&&(!u||n!==u.enabled)))return[3,7];if(this.log("new user "+e+" active state = "+n),!n)return[3,6];l.label=1;case 1:return l.trys.push([1,4,,5]),u&&((i=this._localStream)===null||i===void 0||i.removeTrack(u)),r?(c=this.getTrackByKind(r,e),c?((o=this._localStream)===null||o===void 0||o.addTrack(c),a.track===c?[3,3]:(this.log("replacing user "+e+" track"),[4,a.replaceTrack(c)])):[3,3]):[3,3];case 2:l.sent(),l.label=3;case 3:return[3,5];case 4:throw s=l.sent(),this.log("failed to get user ".concat(e," track, error: ").concat(s),"error"),y("failed to get user "+e+": "+s,"failedUpgrade");case 5:return[3,7];case 6:u&&(u.enabled=!1,u.stop()),l.label=7;case 7:return[2]}})})},t.prototype.getTrackByKind=function(e,n){var r,i;if(e)try{for(var o=Y(e.getTracks()),a=o.next();!a.done;a=o.next()){var u=a.value;if(u.kind===n)return u}}catch(c){r={error:c}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}},t.prototype.isSenderTrackEnabled=function(e){var n=this.findSenderTrackByKind(e);return!!(n!=null&&n.enabled)},t.prototype.isMicrophoneActive=function(){return this.isSenderTrackEnabled("audio")},t.prototype.isCameraActive=function(){return this.isSenderTrackEnabled("video")},t.prototype.setMediaDeviceActive=function(e){var n=e.microphone,r=e.camera;return T(this,void 0,void 0,function(){var i;return S(this,function(o){return i=new be,this._changeUserMediaQueue.push({microphone:n,camera:r,deferred:i}),this._changeUserMediaQueue.length===1&&this.processChangeUserMediaQueue(),[2,i.promise]})})},t.prototype.close=function(e,n,r){var i,o;if(e===void 0&&(e=!0),n===void 0&&(n="normal"),!this._closed){if(this._closed=!0,this._peerConnection)try{this._peerConnection.close()}catch(f){this.log("error: ".concat(f),"error")}if(this._localStream)try{var a=this._localStream.getTracks();for(var u in a)a[u].stop()}catch(f){this.log("error: ".concat(f),"error")}e&&this.sendRtcEvent("close",{reason:"normal"}),r&&(r.isResolved()?this._onClose(n):r.reject(y("websocket closed: "+n,n))),this._serverConnection&&(this.log("closing server connection"),this._serverConnection.close()),this._controlConnection&&this._controlConnection.close();try{for(var c=Y(this._removeListeners),s=c.next();!s.done;s=c.next()){var l=s.value;l.target.removeEventListener(l.name,l.callback)}}catch(f){i={error:f}}finally{try{s&&!s.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}}},t.prototype.createOffer=function(e,n){return e.createOffer(n)},t.prototype.setRemoteDescription=function(e,n){return e.setRemoteDescription(n)},t.prototype.setLocalDescription=function(e,n){return e.setLocalDescription(n)},t.prototype.createAnswer=function(e){return e.createAnswer()},Object.defineProperty(t.prototype,"peerConnection",{get:function(){return this._peerConnection},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"serverConnection",{get:function(){return this._serverConnection},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sessionId",{get:function(){return this._sessionId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"server",{get:function(){return this._server},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sceneId",{get:function(){return this._sceneId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isMicrophoneConnected",{get:function(){return!!this.findSenderTrackByKind("audio")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCameraConnected",{get:function(){return!!this.findSenderTrackByKind("video")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"features",{get:function(){return this._features},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"microphoneMuteDelay",{get:function(){return this._microphoneMuteDelay},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userMediaStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"microphoneMuted",{get:function(){if(!this._localStream)return!0;var e=this._localStream.getAudioTracks();return!e||e.length<1?!0:!e[0].enabled},set:function(e){var n,r;if(this._localStream){var i=this._localStream.getAudioTracks();if(!(!i||i.length<1)){var o=this.findSenderByKind("audio");if(((n=o==null?void 0:o.track)===null||n===void 0?void 0:n.readyState)==="live"&&o.track===i[0]){var a=!e;i[0].enabled=a,this.log("microphone muted active notification: ".concat(a)),(r=this._onMicrophoneActive)===null||r===void 0||r.call(a)}}}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"webcamMuted",{get:function(){if(!this._localStream)return!0;var e=this._localStream.getVideoTracks();return!e||e.length<1?!0:!e[0].enabled},set:function(e){var n,r;if(this._localStream){var i=this._localStream.getVideoTracks();if(!(!i||i.length<1)){var o=this.findSenderByKind("video");if(((n=o==null?void 0:o.track)===null||n===void 0?void 0:n.readyState)==="live"&&o.track===i[0]){var a=!e;i[0].enabled=a,(r=this._onCameraActive)===null||r===void 0||r.call(a)}}}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetX",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetY",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"microphoneActiveCallbacks",{set:function(e){this._onMicrophoneActive=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cameraActiveCallbacks",{set:function(e){this._onCameraActive=e},enumerable:!1,configurable:!0}),t}(),ci=function(){function t(e,n,r){r===void 0&&(r=new K);var i=this;this.logger=r,this._outgoingQueue=[],this._onConnectedStorage=function(o,a,u,c){},this._pendingLog=[],this._closed=!1,this._shouldLogToServer=!1,this._serverUri=e,this._accessToken=n,this._onClose=function(o){},this._onMessage=function(o){},this._sessionError=function(o){i.logger.log("error","session error: ".concat(o))},this._features=new ft}return Object.defineProperty(t.prototype,"onConnected",{set:function(e){this._onConnectedStorage=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onClose",{set:function(e){this._onClose=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onMessage",{set:function(e){this._onMessage=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loggingEnabled",{get:function(){return this.logger.isEnabled},set:function(e){this.logger.log("warn","loggingEnabled is deprecated and will be removed in a future version. Please use setLogging(boolean)"),this.logger.enableLogging(e)},enumerable:!1,configurable:!0}),t.prototype.setMinLogLevel=function(e){this.logger.setMinLogLevel(e)},t.prototype.setLogging=function(e){this.logger.enableLogging(e)},t.prototype.log=function(e){this.loggingEnabled&&(this._shouldLogToServer?this.logToServer(e):this.logger.log("log",e))},t.prototype.logToServer=function(e){this.sessionId?this.sendlogMessage([e]):this._pendingLog.push(e)},t.prototype.sendlogMessage=function(e){if(this._sessionId&&e&&e.length>0){var n={category:"diagnostics",kind:"event",name:"log",body:{name:"browser",text:e}};this.sendMessage(n)}},t.prototype.connect=function(){return T(this,void 0,void 0,function(){var e;return S(this,function(n){return e=new be,this._closed=!1,this._serverUri&&(this._serverUri.startsWith("ws:")||this._serverUri.startsWith("wss:"))&&this.connectByWebSocket(e),[2,e.promise]})})},t.prototype.connectByWebSocket=function(e){var n=this;this.log("connecting to: ".concat(this._serverUri)),this._accessToken?this._serverConnection=new WebSocket(this._serverUri+"?access_token="+this._accessToken):this._serverConnection=new WebSocket(this._serverUri),this._serverConnection.onmessage=function(r){n.gotMessageFromServer(r,e)},this._serverConnection.onerror=function(r){e.isPending()&&e.reject(y("websocket failed","serverConnectionFailed"))},this._serverConnection.onopen=function(r){n.log("websocket open"),e.resolve()},this._serverConnection.onclose=function(r){n.log("websocket closed: code(".concat(r.code,"), reason(").concat(r.reason,"), clean(").concat(r.wasClean,")")),e.isRejected||n.close(!1,"normal",e)}},t.prototype.gotMessageFromServer=function(e,n){var r=e.data;this.log("message received: ".concat(r));var i=JSON.parse(r),o=i.category,a=i.name,u=i.body;if(o!=="webrtc"){this._onMessage(i);return}if(i.kind==="event")if(a==="accepted"){this.log("accepted, session_id = ".concat(u.sessionId)),this._sessionId=u.sessionId;for(var c=0;c<this._outgoingQueue.length;c++)this._outgoingQueue[c].body.sessionId=this._sessionId,this.sendMessage(this._outgoingQueue[c]);this._outgoingQueue=[],this.sendlogMessage(this._pendingLog),this._pendingLog=[]}else a==="close"&&this.close(!1,u.reason,n)},t.prototype.sendMessage=function(e){this._serverConnection&&(this._serverConnection.readyState===WebSocket.OPEN?this._serverConnection.send(JSON.stringify(e)):this.log("not ready, discarding message: ".concat(e)))},t.prototype.close=function(e,n,r){n===void 0&&(n="normal"),!this._closed&&(this._closed=!0,r&&(r.isResolved()?this._onClose(n):r.reject(y("websocket closed: "+n,n))),this._serverConnection&&(this.log("closing server connection"),this._serverConnection.close()))},Object.defineProperty(t.prototype,"serverConnection",{get:function(){return this._serverConnection},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sessionId",{get:function(){return this._sessionId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"peerConnection",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"features",{get:function(){return this._features},enumerable:!1,configurable:!0}),t.prototype.sendRtcEvent=function(e,n){},t.prototype.sendVideoBounds=function(e,n){},t.prototype.sendUserText=function(e){this.logger.log("error","WebSocketSession discarding text: "+e)},Object.defineProperty(t.prototype,"microphoneMuteDelay",{get:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"microphoneMuted",{get:function(){return null},set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onUserText",{set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isMicrophoneConnected",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCameraConnected",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetX",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetY",{get:function(){return 0},enumerable:!1,configurable:!0}),t.prototype.isMicrophoneActive=function(){return!1},t.prototype.isCameraActive=function(){return!1},t.prototype.setMediaDeviceActive=function(e){return e.microphone,e.camera,T(this,void 0,void 0,function(){return S(this,function(n){throw y("setMediaDeviceActive not supported on WebSocketSession","notSupported")})})},t}(),nt;(function(t){t.Scene="scene"})(nt||(nt={}));var Ae;(function(t){t.Response="response",t.Request="request"})(Ae||(Ae={}));var Me;(function(t){t.Idle="idle",t.Animating="animating",t.Speaking="speaking"})(Me||(Me={}));var Bt;(function(t){t.UI_CONTENT_AWARENESS="UI_CONTENT_AWARENESS",t.UI_SDK_CAMERA_CONTROL="UI_SDK_CAMERA_CONTROL"})(Bt||(Bt={}));var ee=[],li=function(){return ee.some(function(t){return t.activeTargets.length>0})},fi=function(){return ee.some(function(t){return t.skippedTargets.length>0})},pn="ResizeObserver loop completed with undelivered notifications.",di=function(){var t;typeof ErrorEvent=="function"?t=new ErrorEvent("error",{message:pn}):(t=document.createEvent("Event"),t.initEvent("error",!1,!1),t.message=pn),window.dispatchEvent(t)},Pe;(function(t){t.BORDER_BOX="border-box",t.CONTENT_BOX="content-box",t.DEVICE_PIXEL_CONTENT_BOX="device-pixel-content-box"})(Pe||(Pe={}));var te=function(t){return Object.freeze(t)},_i=function(){function t(e,n){this.inlineSize=e,this.blockSize=n,te(this)}return t}(),or=function(){function t(e,n,r,i){return this.x=e,this.y=n,this.width=r,this.height=i,this.top=this.y,this.left=this.x,this.bottom=this.top+this.height,this.right=this.left+this.width,te(this)}return t.prototype.toJSON=function(){var e=this,n=e.x,r=e.y,i=e.top,o=e.right,a=e.bottom,u=e.left,c=e.width,s=e.height;return{x:n,y:r,top:i,right:o,bottom:a,left:u,width:c,height:s}},t.fromRect=function(e){return new t(e.x,e.y,e.width,e.height)},t}(),en=function(t){return t instanceof SVGElement&&"getBBox"in t},ar=function(t){if(en(t)){var e=t.getBBox(),n=e.width,r=e.height;return!n&&!r}var i=t,o=i.offsetWidth,a=i.offsetHeight;return!(o||a||t.getClientRects().length)},vn=function(t){var e;if(t instanceof Element)return!0;var n=(e=t==null?void 0:t.ownerDocument)===null||e===void 0?void 0:e.defaultView;return!!(n&&t instanceof n.Element)},hi=function(t){switch(t.tagName){case"INPUT":if(t.type!=="image")break;case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return!0}return!1},Re=typeof window<"u"?window:{},Be=new WeakMap,En=/auto|scroll/,pi=/^tb|vertical/,vi=/msie|trident/i.test(Re.navigator&&Re.navigator.userAgent),D=function(t){return parseFloat(t||"0")},ue=function(t,e,n){return t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=!1),new _i((n?e:t)||0,(n?t:e)||0)},gn=te({devicePixelContentBoxSize:ue(),borderBoxSize:ue(),contentBoxSize:ue(),contentRect:new or(0,0,0,0)}),sr=function(t,e){if(e===void 0&&(e=!1),Be.has(t)&&!e)return Be.get(t);if(ar(t))return Be.set(t,gn),gn;var n=getComputedStyle(t),r=en(t)&&t.ownerSVGElement&&t.getBBox(),i=!vi&&n.boxSizing==="border-box",o=pi.test(n.writingMode||""),a=!r&&En.test(n.overflowY||""),u=!r&&En.test(n.overflowX||""),c=r?0:D(n.paddingTop),s=r?0:D(n.paddingRight),l=r?0:D(n.paddingBottom),f=r?0:D(n.paddingLeft),d=r?0:D(n.borderTopWidth),h=r?0:D(n.borderRightWidth),v=r?0:D(n.borderBottomWidth),m=r?0:D(n.borderLeftWidth),O=f+s,b=c+l,A=m+h,C=d+v,I=u?t.offsetHeight-C-t.clientHeight:0,R=a?t.offsetWidth-A-t.clientWidth:0,E=i?O+A:0,G=i?b+C:0,Ue=r?r.width:D(n.width)-E-R,ke=r?r.height:D(n.height)-G-I,ni=Ue+O+R+A,ri=ke+b+I+C,_n=te({devicePixelContentBoxSize:ue(Math.round(Ue*devicePixelRatio),Math.round(ke*devicePixelRatio),o),borderBoxSize:ue(ni,ri,o),contentBoxSize:ue(Ue,ke,o),contentRect:new or(f,c,Ue,ke)});return Be.set(t,_n),_n},ur=function(t,e,n){var r=sr(t,n),i=r.borderBoxSize,o=r.contentBoxSize,a=r.devicePixelContentBoxSize;switch(e){case Pe.DEVICE_PIXEL_CONTENT_BOX:return a;case Pe.BORDER_BOX:return i;default:return o}},Ei=function(){function t(e){var n=sr(e);this.target=e,this.contentRect=n.contentRect,this.borderBoxSize=te([n.borderBoxSize]),this.contentBoxSize=te([n.contentBoxSize]),this.devicePixelContentBoxSize=te([n.devicePixelContentBoxSize])}return t}(),cr=function(t){if(ar(t))return 1/0;for(var e=0,n=t.parentNode;n;)e+=1,n=n.parentNode;return e},gi=function(){var t=1/0,e=[];ee.forEach(function(a){if(a.activeTargets.length!==0){var u=[];a.activeTargets.forEach(function(s){var l=new Ei(s.target),f=cr(s.target);u.push(l),s.lastReportedSize=ur(s.target,s.observedBox),f<t&&(t=f)}),e.push(function(){a.callback.call(a.observer,u,a.observer)}),a.activeTargets.splice(0,a.activeTargets.length)}});for(var n=0,r=e;n<r.length;n++){var i=r[n];i()}return t},mn=function(t){ee.forEach(function(n){n.activeTargets.splice(0,n.activeTargets.length),n.skippedTargets.splice(0,n.skippedTargets.length),n.observationTargets.forEach(function(i){i.isActive()&&(cr(i.target)>t?n.activeTargets.push(i):n.skippedTargets.push(i))})})},mi=function(){var t=0;for(mn(t);li();)t=gi(),mn(t);return fi()&&di(),t>0},vt,lr=[],yi=function(){return lr.splice(0).forEach(function(t){return t()})},Ti=function(t){if(!vt){var e=0,n=document.createTextNode(""),r={characterData:!0};new MutationObserver(function(){return yi()}).observe(n,r),vt=function(){n.textContent="".concat(e?e--:e++)}}lr.push(t),vt()},Si=function(t){Ti(function(){requestAnimationFrame(t)})},ze=0,Oi=function(){return!!ze},bi=250,Ai={attributes:!0,characterData:!0,childList:!0,subtree:!0},yn=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"],Tn=function(t){return t===void 0&&(t=0),Date.now()+t},Et=!1,Ri=function(){function t(){var e=this;this.stopped=!0,this.listener=function(){return e.schedule()}}return t.prototype.run=function(e){var n=this;if(e===void 0&&(e=bi),!Et){Et=!0;var r=Tn(e);Si(function(){var i=!1;try{i=mi()}finally{if(Et=!1,e=r-Tn(),!Oi())return;i?n.run(1e3):e>0?n.run(e):n.start()}})}},t.prototype.schedule=function(){this.stop(),this.run()},t.prototype.observe=function(){var e=this,n=function(){return e.observer&&e.observer.observe(document.body,Ai)};document.body?n():Re.addEventListener("DOMContentLoaded",n)},t.prototype.start=function(){var e=this;this.stopped&&(this.stopped=!1,this.observer=new MutationObserver(this.listener),this.observe(),yn.forEach(function(n){return Re.addEventListener(n,e.listener,!0)}))},t.prototype.stop=function(){var e=this;this.stopped||(this.observer&&this.observer.disconnect(),yn.forEach(function(n){return Re.removeEventListener(n,e.listener,!0)}),this.stopped=!0)},t}(),Gt=new Ri,Sn=function(t){!ze&&t>0&&Gt.start(),ze+=t,!ze&&Gt.stop()},Ci=function(t){return!en(t)&&!hi(t)&&getComputedStyle(t).display==="inline"},wi=function(){function t(e,n){this.target=e,this.observedBox=n||Pe.CONTENT_BOX,this.lastReportedSize={inlineSize:0,blockSize:0}}return t.prototype.isActive=function(){var e=ur(this.target,this.observedBox,!0);return Ci(this.target)&&(this.lastReportedSize=e),this.lastReportedSize.inlineSize!==e.inlineSize||this.lastReportedSize.blockSize!==e.blockSize},t}(),Ii=function(){function t(e,n){this.activeTargets=[],this.skippedTargets=[],this.observationTargets=[],this.observer=e,this.callback=n}return t}(),Ge=new WeakMap,On=function(t,e){for(var n=0;n<t.length;n+=1)if(t[n].target===e)return n;return-1},Ve=function(){function t(){}return t.connect=function(e,n){var r=new Ii(e,n);Ge.set(e,r)},t.observe=function(e,n,r){var i=Ge.get(e),o=i.observationTargets.length===0;On(i.observationTargets,n)<0&&(o&&ee.push(i),i.observationTargets.push(new wi(n,r&&r.box)),Sn(1),Gt.schedule())},t.unobserve=function(e,n){var r=Ge.get(e),i=On(r.observationTargets,n),o=r.observationTargets.length===1;i>=0&&(o&&ee.splice(ee.indexOf(r),1),r.observationTargets.splice(i,1),Sn(-1))},t.disconnect=function(e){var n=this,r=Ge.get(e);r.observationTargets.slice().forEach(function(i){return n.unobserve(e,i.target)}),r.activeTargets.splice(0,r.activeTargets.length)},t}(),Ni=function(){function t(e){if(arguments.length===0)throw new TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.");if(typeof e!="function")throw new TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.");Ve.connect(this,e)}return t.prototype.observe=function(e,n){if(arguments.length===0)throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!vn(e))throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element");Ve.observe(this,e,n)},t.prototype.unobserve=function(e){if(arguments.length===0)throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!vn(e))throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element");Ve.unobserve(this,e)},t.prototype.disconnect=function(){Ve.disconnect(this)},t.toString=function(){return"function ResizeObserver () { [polyfill code] }"},t}(),Mi=function(){return Promise.all(Array.from(document.images).filter(function(t){return!t.complete}).map(function(t){return new Promise(function(e){t.onload=e,t.onerror=e})}))},Pi=function(t,e){e===void 0&&(e=500);var n=-1;return function(){n&&clearTimeout(n),n=setTimeout(function(){return t()},e)}},Li=function(){function t(e,n,r){n===void 0&&(n=300),r===void 0&&(r=new K);var i=this;this.scene=e,this.debounceTime=n,this.logger=r,this.VIDEO_FRAME_STR="data-sm-video",this.VIDEO_FRAME_STR_BRACKETED="[".concat(this.VIDEO_FRAME_STR,"]"),this.CONTENT_STR="data-sm-content",this.CONTENT_STR_BRACKETED="[".concat(this.CONTENT_STR,"]"),this.CUE_ATTRIBUTES=[this.VIDEO_FRAME_STR,this.CONTENT_STR],this.CUE_ATTRIBUTES_BRACKETED=[this.VIDEO_FRAME_STR_BRACKETED,this.CONTENT_STR_BRACKETED].join(),this.RESIZE_OBSERVER_BOX_OPTIONS="border-box",this.callMeasure=!1,this.contentCollection={},this.videoFrame=null,this.debouncedMeasure=Pi(function(){return i.measureInternal()},n),this.resizeObserver=new Ni(function(){return i.measureDebounced()}),this.getInitialElements(),this.mutationObserver=new MutationObserver(function(o){return i.mutationCallback(o)}),this.setupEventListeners(),this.observeMutations(),this.measureInternal()}return t.prototype.isLoggingEnabled=function(){return this.logger.isEnabled},t.prototype.setLogging=function(e){this.logger.enableLogging(e)},t.prototype.getMinLogLevel=function(){return this.logger.getMinLogLevel()},t.prototype.setMinLogLevel=function(e){this.logger.setMinLogLevel(e)},t.prototype.setupEventListeners=function(){var e=this;window.addEventListener("resize",function(){return e.measureDebounced()})},t.prototype.getInitialElements=function(){var e=this,n=document.querySelector(this.VIDEO_FRAME_STR_BRACKETED),r=document.querySelectorAll(this.CONTENT_STR_BRACKETED);this.trackVideoElement(n),Array.from(r).map(function(i){return e.trackContentElement(i)})},t.prototype.observeMutations=function(){var e=document.documentElement||document.body;this.mutationObserver.observe(e,{attributeFilter:this.CUE_ATTRIBUTES,attributeOldValue:!0,childList:!0,subtree:!0})},t.prototype.disconnect=function(){var e=this;this.mutationObserver.disconnect(),this.resizeObserver.disconnect(),window.removeEventListener("resize",function(){return e.measureDebounced()}),this.scene.contentAwareness=void 0},t.prototype.reconnect=function(){this.scene.contentAwareness=this,this.observeMutations(),this.setupEventListeners(),this.measure()},t.prototype.measure=function(){this.measureInternal()},t.prototype.measureDebounced=function(){this.debouncedMeasure()},t.prototype.measureInternal=function(){if(!this.scene.isConnected()){this.logger.log("error","ContentAwareness: Scene does not exist or is not connected yet");return}var e=this.measureWindow(),n=this.measureVideoFrame(),r=this.measureContent();if(e&&n&&r){var i=this.buildUpdateContentAwarenessRequest(e.innerWidth,e.innerHeight,n,r);this.scene.sendRequest("updateContentAwareness",i)}},t.prototype.measureVideoFrame=function(){if(!this.videoFrame)return this.logger.log("warn","ContentAwareness: Unable to find a video element"),null;var e=this.videoFrame.getBoundingClientRect();return this.invalidDimensions(e)?(this.logger.log("warn","ContentAwareness: Video has a zero width and height"),null):{x1:Math.round(e.left),x2:Math.round(e.right),y1:Math.round(e.top),y2:Math.round(e.bottom)}},t.prototype.measureContent=function(){var e=this,n=[];return Object.keys(this.contentCollection).map(function(r){var i=e.contentCollection[r],o=i.getBoundingClientRect();if(e.invalidDimensions(o)&&e.logger.log("warn","ContentAwareness: Element '".concat(r,"' has a zero width and height")),e.invalidContent(o)){e.logger.log("warn","ContentAwareness: Element '".concat(r,"' is not being tracked")),delete e.contentCollection[r];return}n.push({id:r,x1:Math.round(o.left),x2:Math.round(o.right),y1:Math.round(o.top),y2:Math.round(o.bottom)})}),n},t.prototype.invalidDimensions=function(e){return e.width===0&&e.height===0},t.prototype.invalidContent=function(e){return e.top===0&&e.bottom===0&&e.right===0&&e.left===0},t.prototype.measureWindow=function(){return{innerHeight:Math.round(window.innerHeight),innerWidth:Math.round(window.innerWidth)}},t.prototype.buildUpdateContentAwarenessRequest=function(e,n,r,i){return{viewWidth:e,viewHeight:n,videoFrame:r,content:i}},t.prototype.trackVideoElement=function(e){e&&(this.videoFrame&&(this.logger.log("warn","ContentAwareness: Already observing a video element, switching to new video element"),this.untrackVideoElement(this.videoFrame)),this.videoFrame=e,this.resizeObserver.observe(this.videoFrame,{box:this.RESIZE_OBSERVER_BOX_OPTIONS}))},t.prototype.trackContentElement=function(e){var n=e.getAttribute(this.CONTENT_STR);return n?(this.contentCollection[n]=e,this.resizeObserver.observe(e,{box:this.RESIZE_OBSERVER_BOX_OPTIONS}),!0):!1},t.prototype.untrackContentElement=function(e){var n=e.getAttribute(this.CONTENT_STR),r=this.contentCollection[n];e===r&&(delete this.contentCollection[n],this.resizeObserver.unobserve(e))},t.prototype.untrackVideoElement=function(e){e===this.videoFrame&&(this.videoFrame=null),this.resizeObserver.unobserve(e)},t.prototype.mutationCallback=function(e){var n=this,r=!1;this.callMeasure=!1;for(var i=0;i<e.length;++i)switch(e[i].type){case"childList":{if(e[i].target.nodeType!==Node.ELEMENT_NODE)break;this.untrackRemovedNodeWithCUE(e[i].removedNodes),this.trackAddedNodeWithCUE(e[i].addedNodes);for(var o=0;o<e[i].addedNodes.length;o++)try{var a=e[i].addedNodes[o];if(!a.hasAttribute)continue;var u=a.tagName==="IMG",c=!!a.querySelector("img");if(r=u||c,r)break}catch{this.logger.log("warn","ContentAwareness: Failed to track non-element node",e[i].addedNodes[o])}break}case"attributes":{if(e[i].target.nodeType!==Node.ELEMENT_NODE)break;try{var a=e[i].target,s=e[i].attributeName;if(s===this.VIDEO_FRAME_STR)a.hasAttribute(s)?(this.trackVideoElement(a),this.callMeasure=!0):this.videoFrame&&this.untrackVideoElement(a);else if(s===this.CONTENT_STR){var l=a.getAttribute(s),f=e[i].oldValue;f&&(this.resizeObserver.unobserve(this.contentCollection[f]),delete this.contentCollection[f]),l&&(this.contentCollection[l]=a,this.resizeObserver.observe(a,{box:this.RESIZE_OBSERVER_BOX_OPTIONS})),this.callMeasure=!0}break}catch{this.logger.log("warn","ContentAwareness: Failed to track non-element node",e[i].target)}}}this.callMeasure&&(r?Mi().then(function(){n.measureDebounced()}):this.measureDebounced())},t.prototype.trackAddedNodeWithCUE=function(e){var n=this;e.forEach(function(r){try{var i=r;if(!i.hasAttribute)return;i.hasAttribute(n.VIDEO_FRAME_STR)?(n.trackVideoElement(i),n.callMeasure=!0):i.hasAttribute(n.CONTENT_STR)&&(n.callMeasure=n.trackContentElement(i)),i.querySelector(n.CUE_ATTRIBUTES_BRACKETED)!==null&&i.querySelectorAll(n.CUE_ATTRIBUTES_BRACKETED).forEach(function(o){o.hasAttribute(n.VIDEO_FRAME_STR)?(n.trackVideoElement(o),n.callMeasure=!0):o.hasAttribute(n.CONTENT_STR)&&(n.callMeasure=n.trackContentElement(o))})}catch{n.logger.log("warn","ContentAwareness: Failed to track non-element node",r)}})},t.prototype.untrackRemovedNodeWithCUE=function(e){var n=this;e.forEach(function(r){try{var i=r;if(!i.hasAttribute)return;i.hasAttribute(n.VIDEO_FRAME_STR)?n.untrackVideoElement(i):i.hasAttribute(n.CONTENT_STR)&&(n.untrackContentElement(i),n.callMeasure=!0),i.querySelector(n.CUE_ATTRIBUTES_BRACKETED)!==null&&i.querySelectorAll(n.CUE_ATTRIBUTES_BRACKETED).forEach(function(o){o.hasAttribute(n.VIDEO_FRAME_STR)?n.untrackVideoElement(o):o.hasAttribute(n.CONTENT_STR)&&(n.untrackContentElement(o),n.callMeasure=!0)})}catch{n.logger.log("warn","ContentAwareness: Failed to track non-element node",r)}})},t}(),Di=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},ce="1.2.0",bn=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function xi(t){var e=new Set([t]),n=new Set,r=t.match(bn);if(!r)return function(){return!1};var i={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};if(i.prerelease!=null)return function(c){return c===t};function o(u){return n.add(u),!1}function a(u){return e.add(u),!0}return function(c){if(e.has(c))return!0;if(n.has(c))return!1;var s=c.match(bn);if(!s)return o(c);var l={major:+s[1],minor:+s[2],patch:+s[3],prerelease:s[4]};return l.prerelease!=null||i.major!==l.major?o(c):i.major===0?i.minor===l.minor&&i.patch<=l.patch?a(c):o(c):i.minor<=l.minor?a(c):o(c)}}var Ui=xi(ce),ki=ce.split(".")[0],Le=Symbol.for("opentelemetry.js.api."+ki),De=Di;function dt(t,e,n,r){var i;r===void 0&&(r=!1);var o=De[Le]=(i=De[Le])!==null&&i!==void 0?i:{version:ce};if(!r&&o[t]){var a=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+t);return n.error(a.stack||a.message),!1}if(o.version!==ce){var a=new Error("@opentelemetry/api: All API registration versions must match");return n.error(a.stack||a.message),!1}return o[t]=e,n.debug("@opentelemetry/api: Registered a global for "+t+" v"+ce+"."),!0}function de(t){var e,n,r=(e=De[Le])===null||e===void 0?void 0:e.version;if(!(!r||!Ui(r)))return(n=De[Le])===null||n===void 0?void 0:n[t]}function _t(t,e){e.debug("@opentelemetry/api: Unregistering a global for "+t+" v"+ce+".");var n=De[Le];n&&delete n[t]}var Bi=function(){function t(e){this._namespace=e.namespace||"DiagComponentLogger"}return t.prototype.debug=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return me("debug",this._namespace,e)},t.prototype.error=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return me("error",this._namespace,e)},t.prototype.info=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return me("info",this._namespace,e)},t.prototype.warn=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return me("warn",this._namespace,e)},t.prototype.verbose=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return me("verbose",this._namespace,e)},t}();function me(t,e,n){var r=de("diag");if(r)return n.unshift(e),r[t].apply(r,n)}var g;(function(t){t[t.NONE=0]="NONE",t[t.ERROR=30]="ERROR",t[t.WARN=50]="WARN",t[t.INFO=60]="INFO",t[t.DEBUG=70]="DEBUG",t[t.VERBOSE=80]="VERBOSE",t[t.ALL=9999]="ALL"})(g||(g={}));function Gi(t,e){t<g.NONE?t=g.NONE:t>g.ALL&&(t=g.ALL),e=e||{};function n(r,i){var o=e[r];return typeof o=="function"&&t>=i?o.bind(e):function(){}}return{error:n("error",g.ERROR),warn:n("warn",g.WARN),info:n("info",g.INFO),debug:n("debug",g.DEBUG),verbose:n("verbose",g.VERBOSE)}}var Vi="diag",W=function(){function t(){function e(r){return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var a=de("diag");if(a)return a[r].apply(a,i)}}var n=this;n.setLogger=function(r,i){var o,a;if(i===void 0&&(i=g.INFO),r===n){var u=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return n.error((o=u.stack)!==null&&o!==void 0?o:u.message),!1}var c=de("diag"),s=Gi(i,r);if(c){var l=(a=new Error().stack)!==null&&a!==void 0?a:"<failed to generate stacktrace>";c.warn("Current logger will be overwritten from "+l),s.warn("Current logger will overwrite one already registered from "+l)}return dt("diag",s,n,!0)},n.disable=function(){_t(Vi,n)},n.createComponentLogger=function(r){return new Bi(r)},n.verbose=e("verbose"),n.debug=e("debug"),n.info=e("info"),n.warn=e("warn"),n.error=e("error")}return t.instance=function(){return this._instance||(this._instance=new t),this._instance},t}(),ji=function(){function t(e){this._entries=e?new Map(e):new Map}return t.prototype.getEntry=function(e){var n=this._entries.get(e);if(n)return Object.assign({},n)},t.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map(function(e){var n=e[0],r=e[1];return[n,r]})},t.prototype.setEntry=function(e,n){var r=new t(this._entries);return r._entries.set(e,n),r},t.prototype.removeEntry=function(e){var n=new t(this._entries);return n._entries.delete(e),n},t.prototype.removeEntries=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r=new t(this._entries),i=0,o=e;i<o.length;i++){var a=o[i];r._entries.delete(a)}return r},t.prototype.clear=function(){return new t},t}(),Fi=Symbol("BaggageEntryMetadata"),Hi=W.instance();function Xi(t){return t===void 0&&(t={}),new ji(new Map(Object.entries(t)))}function fr(t){return typeof t!="string"&&(Hi.error("Cannot create baggage metadata from unknown type: "+typeof t),t=""),{__TYPE__:Fi,toString:function(){return t}}}var Ki={get:function(t,e){if(t!=null)return t[e]},keys:function(t){return t==null?[]:Object.keys(t)}},Wi={set:function(t,e,n){t!=null&&(t[e]=n)}};function tn(t){return Symbol.for(t)}var Yi=function(){function t(e){var n=this;n._currentContext=e?new Map(e):new Map,n.getValue=function(r){return n._currentContext.get(r)},n.setValue=function(r,i){var o=new t(n._currentContext);return o._currentContext.set(r,i),o},n.deleteValue=function(r){var i=new t(n._currentContext);return i._currentContext.delete(r),i}}return t}(),$=new Yi,zi=function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t},qi=function(){function t(){}return t.prototype.active=function(){return $},t.prototype.with=function(e,n,r){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];return n.call.apply(n,zi([r],i))},t.prototype.bind=function(e,n){return n},t.prototype.enable=function(){return this},t.prototype.disable=function(){return this},t}(),$i=function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t},gt="context",Ji=new qi,nn=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalContextManager=function(e){return dt(gt,e,W.instance())},t.prototype.active=function(){return this._getContextManager().active()},t.prototype.with=function(e,n,r){for(var i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return(i=this._getContextManager()).with.apply(i,$i([e,n,r],o))},t.prototype.bind=function(e,n){return this._getContextManager().bind(e,n)},t.prototype._getContextManager=function(){return de(gt)||Ji},t.prototype.disable=function(){this._getContextManager().disable(),_t(gt,W.instance())},t}(),j;(function(t){t[t.NONE=0]="NONE",t[t.SAMPLED=1]="SAMPLED"})(j||(j={}));var dr="0000000000000000",_r="00000000000000000000000000000000",hr={traceId:_r,spanId:dr,traceFlags:j.NONE},Ce=function(){function t(e){e===void 0&&(e=hr),this._spanContext=e}return t.prototype.spanContext=function(){return this._spanContext},t.prototype.setAttribute=function(e,n){return this},t.prototype.setAttributes=function(e){return this},t.prototype.addEvent=function(e,n){return this},t.prototype.setStatus=function(e){return this},t.prototype.updateName=function(e){return this},t.prototype.end=function(e){},t.prototype.isRecording=function(){return!1},t.prototype.recordException=function(e,n){},t}(),rn=tn("OpenTelemetry Context Key SPAN");function on(t){return t.getValue(rn)||void 0}function Qi(){return on(nn.getInstance().active())}function an(t,e){return t.setValue(rn,e)}function Zi(t){return t.deleteValue(rn)}function eo(t,e){return an(t,new Ce(e))}function pr(t){var e;return(e=on(t))===null||e===void 0?void 0:e.spanContext()}var to=/^([0-9a-f]{32})$/i,no=/^[0-9a-f]{16}$/i;function vr(t){return to.test(t)&&t!==_r}function ro(t){return no.test(t)&&t!==dr}function ht(t){return vr(t.traceId)&&ro(t.spanId)}function io(t){return new Ce(t)}var An=nn.getInstance(),Er=function(){function t(){}return t.prototype.startSpan=function(e,n,r){var i=!!(n!=null&&n.root);if(i)return new Ce;var o=r&&pr(r);return oo(o)&&ht(o)?new Ce(o):new Ce},t.prototype.startActiveSpan=function(e,n,r,i){var o,a,u;if(!(arguments.length<2)){arguments.length===2?u=n:arguments.length===3?(o=n,u=r):(o=n,a=r,u=i);var c=a??An.active(),s=this.startSpan(e,o,c),l=an(c,s);return An.with(l,u,void 0,s)}},t}();function oo(t){return typeof t=="object"&&typeof t.spanId=="string"&&typeof t.traceId=="string"&&typeof t.traceFlags=="number"}var ao=new Er,so=function(){function t(e,n,r,i){this._provider=e,this.name=n,this.version=r,this.options=i}return t.prototype.startSpan=function(e,n,r){return this._getTracer().startSpan(e,n,r)},t.prototype.startActiveSpan=function(e,n,r,i){var o=this._getTracer();return Reflect.apply(o.startActiveSpan,o,arguments)},t.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):ao},t}(),uo=function(){function t(){}return t.prototype.getTracer=function(e,n,r){return new Er},t}(),co=new uo,Rn=function(){function t(){}return t.prototype.getTracer=function(e,n,r){var i;return(i=this.getDelegateTracer(e,n,r))!==null&&i!==void 0?i:new so(this,e,n,r)},t.prototype.getDelegate=function(){var e;return(e=this._delegate)!==null&&e!==void 0?e:co},t.prototype.setDelegate=function(e){this._delegate=e},t.prototype.getDelegateTracer=function(e,n,r){var i;return(i=this._delegate)===null||i===void 0?void 0:i.getTracer(e,n,r)},t}(),rt;(function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(rt||(rt={}));var Vt;(function(t){t[t.INTERNAL=0]="INTERNAL",t[t.SERVER=1]="SERVER",t[t.CLIENT=2]="CLIENT",t[t.PRODUCER=3]="PRODUCER",t[t.CONSUMER=4]="CONSUMER"})(Vt||(Vt={}));var jt;(function(t){t[t.UNSET=0]="UNSET",t[t.OK=1]="OK",t[t.ERROR=2]="ERROR"})(jt||(jt={}));var mt="trace",lo=function(){function t(){this._proxyTracerProvider=new Rn,this.wrapSpanContext=io,this.isSpanContextValid=ht,this.deleteSpan=Zi,this.getSpan=on,this.getActiveSpan=Qi,this.getSpanContext=pr,this.setSpan=an,this.setSpanContext=eo}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalTracerProvider=function(e){var n=dt(mt,this._proxyTracerProvider,W.instance());return n&&this._proxyTracerProvider.setDelegate(e),n},t.prototype.getTracerProvider=function(){return de(mt)||this._proxyTracerProvider},t.prototype.getTracer=function(e,n){return this.getTracerProvider().getTracer(e,n)},t.prototype.disable=function(){_t(mt,W.instance()),this._proxyTracerProvider=new Rn},t}(),fo=function(){function t(){}return t.prototype.inject=function(e,n){},t.prototype.extract=function(e,n){return e},t.prototype.fields=function(){return[]},t}(),sn=tn("OpenTelemetry Baggage Key");function _o(t){return t.getValue(sn)||void 0}function ho(t,e){return t.setValue(sn,e)}function po(t){return t.deleteValue(sn)}var yt="propagation",vo=new fo,Eo=function(){function t(){this.createBaggage=Xi,this.getBaggage=_o,this.setBaggage=ho,this.deleteBaggage=po}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalPropagator=function(e){return dt(yt,e,W.instance())},t.prototype.inject=function(e,n,r){return r===void 0&&(r=Wi),this._getGlobalPropagator().inject(e,n,r)},t.prototype.extract=function(e,n,r){return r===void 0&&(r=Ki),this._getGlobalPropagator().extract(e,n,r)},t.prototype.fields=function(){return this._getGlobalPropagator().fields()},t.prototype.disable=function(){_t(yt,W.instance())},t.prototype._getGlobalPropagator=function(){return de(yt)||vo},t}(),ne=nn.getInstance(),x=lo.getInstance(),qe=Eo.getInstance(),_=W.instance(),Cn=function(t,e){return e===void 0&&(e=p.None),t?t.camera&&t.microphone?p.MicrophoneAndCamera:t.camera?p.Camera:t.microphone?p.Microphone:p.None:e};function go(t){return t.replace(/^wss:\/\//,"https://")}function wn(t){try{if(!t)return;var e=new URL(t);return e.pathname="",e.search="",e.toString()}catch{return}}var we;(function(t){t.Showcards="showcards",t.Hidecards="hidecards",t.Feature="feature",t.Marker="marker"})(we||(we={}));var F;(function(t){t.dpSpeaking="dpSpeaking",t.userSpeaking="userSpeaking",t.dpProcessing="dpProcessing",t.idle="idle"})(F||(F={}));var mo=function(){function t(e){e===void 0&&(e=new K),this.logger=e,this._conversationState=F.idle,this._userActive=!1,this._onConversationStateUpdated=new L}return t.prototype.processStateMessage=function(e){if(e&&e.persona&&Object.keys(e.persona).length>0){var n=Object.keys(e.persona)[0];if(!this._userActive&&e.persona[n].speechState){var r=e.persona[n].speechState;r===Me.Idle?this.setSpeechState(F.idle):r===Me.Speaking&&this.setSpeechState(F.dpSpeaking)}}},t.prototype.processRecognizeResultsMessage=function(e){this._userActive=!0;var n=e.status!==0,r=e.results&&e.results.some(function(o){return o.final});if(n){var i=typeof e.errorMessage<"u"?e.errorMessage:"recognizeResults sent back a message with non-zero status but no error message.";this.logger.log("error",i)}else r?this.setSpeechState(F.dpProcessing):this.setSpeechState(F.userSpeaking);this._userActive=!1},t.prototype.setSpeechState=function(e){this._conversationState!==e&&(this._conversationState=e,this._onConversationStateUpdated.call(this._conversationState))},t.prototype.getSpeechState=function(){return this._conversationState},Object.defineProperty(t.prototype,"onConversationStateUpdated",{get:function(){return this._onConversationStateUpdated},enumerable:!1,configurable:!0}),t.prototype.reset=function(){this._userActive=!1,this._conversationState=F.idle,this._onConversationStateUpdated.call(this._conversationState)},t}(),yo=function(){function t(){}return t.prototype.format=function(e){var n,r=(n=e.provider.meta.dialogflow)===null||n===void 0?void 0:n.queryResult.fulfillmentMessages,i=r==null?void 0:r.find(function(o){return!!(o!=null&&o.payload)});return i?this.formatLegacyDialogflow(i):this.formatContextData(e.output.context)},t.prototype.formatLegacyDialogflow=function(e){var n=this,r=e.payload.soulmachines;return Object.keys(r).map(function(i){return{id:i,data:k({id:i},n.formatCardData(r[i]))}})},t.prototype.formatContextData=function(e){var n=this;return this.allowedIds(e).map(function(r){var i=r.replace("public-","");return{id:i,data:k({id:i},n.formatCardData(e[r]))}})},t.prototype.allowedIds=function(e){return Object.keys(e).filter(function(n){return/public-/.test(n)===!0}).filter(function(n){return/\.original/gm.test(n)===!1})},t.prototype.formatCardData=function(e){var n=typeof e=="string"?JSON.parse(e):e,r=n.component,i=n.type,o=oi(n,["component","type"]);return k({type:i||r},o)},t}(),To=function(){function t(e,n,r){e===void 0&&(e=new K),n===void 0&&(n=new mo),r===void 0&&(r=new yo),this.logger=e,this.conversationState=n,this.contentCardFormatter=r,this._onCardChanged=new L,this._autoClearCards=!1,this.cardData=new Map,this.activeCardIds=new Set}return t.prototype.processStateMessage=function(e){this.conversationState.processStateMessage(e)},t.prototype.processRecognizeResultsMessage=function(e){this.conversationState.processRecognizeResultsMessage(e)},Object.defineProperty(t.prototype,"onConversationStateUpdated",{get:function(){return this.conversationState.onConversationStateUpdated},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"autoClearCards",{set:function(e){this._autoClearCards=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onCardChanged",{get:function(){return this._onCardChanged},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeCards",{get:function(){var e=this,n=[];return this.activeCardIds.forEach(function(r){var i=e.cardData.get(r);i?n.push(i):e.logger.log("error","card data for ".concat(r," does not exist"))}),n},enumerable:!1,configurable:!0}),t.prototype.onSpeechMarker=function(e){var n=e.arguments;e.name===we.Showcards?this.addActiveCardIds(n):e.name===we.Hidecards&&this.removeActiveCards(n),n.length===0&&e.name===we.Hidecards&&this.clearActiveCards()},t.prototype.onConversationResult=function(e){var n=this,r=this.contentCardFormatter.format(e);this._autoClearCards&&this.clearActiveCards(),r.map(function(i){var o=i.id,a=i.data;n.cardData.set(o,a)})},t.prototype.reset=function(){this.clearActiveCards(),this.cardData.clear(),this.conversationState.reset()},t.prototype.clearActiveCards=function(){this.activeCardIds.clear(),this.onCardChanged.call(this.activeCards)},t.prototype.addActiveCardIds=function(e){this.activeCardIds=new Set(Ut(Ut([],xt(this.activeCardIds),!1),xt(e),!1)),this.onCardChanged.call(this.activeCards)},t.prototype.removeActiveCards=function(e){var n=this;e.forEach(function(r){return n.activeCardIds.delete(r)}),this.onCardChanged.call(this.activeCards)},t}(),So=function(){function t(e){var n=this;this.scene=e,this._previousUrl=window.location.href,this._observer=new MutationObserver(function(){return n.observeDocumentChanges()})}return t.prototype.observeUrlChanges=function(){this._observer.observe(document,{subtree:!0,childList:!0})},t.prototype.disconnect=function(){this._observer.disconnect()},t.prototype.send=function(){var e={personaId:this.scene.currentPersonaId,text:kt.PAGE_METADATA,variables:{pageUrl:window.location.href.split("?")[0]},optionalArgs:{}};this.scene.sendRequest("conversationSend",e)},t.prototype.observeDocumentChanges=function(){window.location.href!==this._previousUrl&&(this._previousUrl=window.location.href,this.send())},t}(),Tt=Object.keys(B).length,Oo=function(){function t(){this._connectionState={name:B.Disconnected,totalSteps:Tt,currentStep:0,percentageLoaded:0},this._onConnectionStateUpdated=new L}return t.prototype.setConnectionState=function(e){if(this._connectionState.name!==e){var n=Object.keys(B).indexOf(e),r={name:e,currentStep:n,totalSteps:Tt,percentageLoaded:100/(Tt-1)*n};this._connectionState=r,this._onConnectionStateUpdated.call(r)}},t.prototype.getConnectionState=function(){return this._connectionState},Object.defineProperty(t.prototype,"onConnectionStateUpdated",{get:function(){return this._onConnectionStateUpdated},enumerable:!1,configurable:!0}),t.prototype.reset=function(){this.setConnectionState(B.Disconnected)},t}(),z={CLOUD_PROVIDER:"cloud.provider",CLOUD_ACCOUNT_ID:"cloud.account.id",CLOUD_REGION:"cloud.region",CLOUD_AVAILABILITY_ZONE:"cloud.availability_zone",CLOUD_PLATFORM:"cloud.platform",AWS_ECS_CONTAINER_ARN:"aws.ecs.container.arn",AWS_ECS_CLUSTER_ARN:"aws.ecs.cluster.arn",AWS_ECS_LAUNCHTYPE:"aws.ecs.launchtype",AWS_ECS_TASK_ARN:"aws.ecs.task.arn",AWS_ECS_TASK_FAMILY:"aws.ecs.task.family",AWS_ECS_TASK_REVISION:"aws.ecs.task.revision",AWS_EKS_CLUSTER_ARN:"aws.eks.cluster.arn",AWS_LOG_GROUP_NAMES:"aws.log.group.names",AWS_LOG_GROUP_ARNS:"aws.log.group.arns",AWS_LOG_STREAM_NAMES:"aws.log.stream.names",AWS_LOG_STREAM_ARNS:"aws.log.stream.arns",CONTAINER_NAME:"container.name",CONTAINER_ID:"container.id",CONTAINER_RUNTIME:"container.runtime",CONTAINER_IMAGE_NAME:"container.image.name",CONTAINER_IMAGE_TAG:"container.image.tag",DEPLOYMENT_ENVIRONMENT:"deployment.environment",DEVICE_ID:"device.id",DEVICE_MODEL_IDENTIFIER:"device.model.identifier",DEVICE_MODEL_NAME:"device.model.name",FAAS_NAME:"faas.name",FAAS_ID:"faas.id",FAAS_VERSION:"faas.version",FAAS_INSTANCE:"faas.instance",FAAS_MAX_MEMORY:"faas.max_memory",HOST_ID:"host.id",HOST_NAME:"host.name",HOST_TYPE:"host.type",HOST_ARCH:"host.arch",HOST_IMAGE_NAME:"host.image.name",HOST_IMAGE_ID:"host.image.id",HOST_IMAGE_VERSION:"host.image.version",K8S_CLUSTER_NAME:"k8s.cluster.name",K8S_NODE_NAME:"k8s.node.name",K8S_NODE_UID:"k8s.node.uid",K8S_NAMESPACE_NAME:"k8s.namespace.name",K8S_POD_UID:"k8s.pod.uid",K8S_POD_NAME:"k8s.pod.name",K8S_CONTAINER_NAME:"k8s.container.name",K8S_REPLICASET_UID:"k8s.replicaset.uid",K8S_REPLICASET_NAME:"k8s.replicaset.name",K8S_DEPLOYMENT_UID:"k8s.deployment.uid",K8S_DEPLOYMENT_NAME:"k8s.deployment.name",K8S_STATEFULSET_UID:"k8s.statefulset.uid",K8S_STATEFULSET_NAME:"k8s.statefulset.name",K8S_DAEMONSET_UID:"k8s.daemonset.uid",K8S_DAEMONSET_NAME:"k8s.daemonset.name",K8S_JOB_UID:"k8s.job.uid",K8S_JOB_NAME:"k8s.job.name",K8S_CRONJOB_UID:"k8s.cronjob.uid",K8S_CRONJOB_NAME:"k8s.cronjob.name",OS_TYPE:"os.type",OS_DESCRIPTION:"os.description",OS_NAME:"os.name",OS_VERSION:"os.version",PROCESS_PID:"process.pid",PROCESS_EXECUTABLE_NAME:"process.executable.name",PROCESS_EXECUTABLE_PATH:"process.executable.path",PROCESS_COMMAND:"process.command",PROCESS_COMMAND_LINE:"process.command_line",PROCESS_COMMAND_ARGS:"process.command_args",PROCESS_OWNER:"process.owner",PROCESS_RUNTIME_NAME:"process.runtime.name",PROCESS_RUNTIME_VERSION:"process.runtime.version",PROCESS_RUNTIME_DESCRIPTION:"process.runtime.description",SERVICE_NAME:"service.name",SERVICE_NAMESPACE:"service.namespace",SERVICE_INSTANCE_ID:"service.instance.id",SERVICE_VERSION:"service.version",TELEMETRY_SDK_NAME:"telemetry.sdk.name",TELEMETRY_SDK_LANGUAGE:"telemetry.sdk.language",TELEMETRY_SDK_VERSION:"telemetry.sdk.version",TELEMETRY_AUTO_VERSION:"telemetry.auto.version",WEBENGINE_NAME:"webengine.name",WEBENGINE_VERSION:"webengine.version",WEBENGINE_DESCRIPTION:"webengine.description"},bo="=",In=";",Ao=",";function Ro(t){var e=t.split(In);if(!(e.length<=0)){var n=e.shift();if(n){var r=n.split(bo);if(r.length===2){var i=decodeURIComponent(r[0].trim()),o=decodeURIComponent(r[1].trim()),a;return e.length>0&&(a=fr(e.join(In))),{key:i,value:o,metadata:a}}}}}function gr(t){return typeof t!="string"||t.length===0?{}:t.split(Ao).map(function(e){return Ro(e)}).filter(function(e){return e!==void 0&&e.value.length>0}).reduce(function(e,n){return e[n.key]=n.value,e},{})}function Co(){return function(t){_.error(wo(t))}}function wo(t){return typeof t=="string"?t:JSON.stringify(Io(t))}function Io(t){for(var e={},n=t;n!==null;)Object.getOwnPropertyNames(n).forEach(function(r){if(!e[r]){var i=n[r];i&&(e[r]=String(i))}}),n=Object.getPrototypeOf(n);return e}var No=Co();function Mo(t){try{No(t)}catch{}}var Ft;(function(t){t.AlwaysOff="always_off",t.AlwaysOn="always_on",t.ParentBasedAlwaysOff="parentbased_always_off",t.ParentBasedAlwaysOn="parentbased_always_on",t.ParentBasedTraceIdRatio="parentbased_traceidratio",t.TraceIdRatio="traceidratio"})(Ft||(Ft={}));var Po=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},Lo=",",Do=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];function xo(t){return Do.indexOf(t)>-1}var Uo=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS"];function ko(t){return Uo.indexOf(t)>-1}var Nn=1/0,Mn=128,mr={CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:g.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:Nn,OTEL_ATTRIBUTE_COUNT_LIMIT:Mn,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:Nn,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:Mn,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_TRACES_EXPORTER:"none",OTEL_TRACES_SAMPLER:Ft.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:""};function Bo(t,e,n,r,i){if(r===void 0&&(r=-1/0),i===void 0&&(i=1/0),typeof n[t]<"u"){var o=Number(n[t]);isNaN(o)||(o<r?e[t]=r:o>i?e[t]=i:e[t]=o)}}function Go(t,e,n,r){r===void 0&&(r=Lo);var i=n[t];typeof i=="string"&&(e[t]=i.split(r).map(function(o){return o.trim()}))}var Vo={ALL:g.ALL,VERBOSE:g.VERBOSE,DEBUG:g.DEBUG,INFO:g.INFO,WARN:g.WARN,ERROR:g.ERROR,NONE:g.NONE};function jo(t,e,n){var r=n[t];if(typeof r=="string"){var i=Vo[r.toUpperCase()];i!=null&&(e[t]=i)}}function Fo(t){var e={};for(var n in mr){var r=n;switch(r){case"OTEL_LOG_LEVEL":jo(r,e,t);break;default:if(xo(r))Bo(r,e,t);else if(ko(r))Go(r,e,t);else{var i=t[r];typeof i<"u"&&i!==null&&(e[r]=String(i))}}}return e}function X(){var t=Fo(Po);return Object.assign({},mr,t)}function Ie(t){for(var e=t.length,n="",r=0;r<e;r+=2){var i=t.substring(r,r+2),o=parseInt(i,16);n+=String.fromCharCode(o)}return btoa(n)}Array(32);var Ht=performance,Ho="1.7.0",je={CLOUD_PROVIDER:"cloud.provider",CLOUD_ACCOUNT_ID:"cloud.account.id",CLOUD_REGION:"cloud.region",CLOUD_AVAILABILITY_ZONE:"cloud.availability_zone",CLOUD_PLATFORM:"cloud.platform",AWS_ECS_CONTAINER_ARN:"aws.ecs.container.arn",AWS_ECS_CLUSTER_ARN:"aws.ecs.cluster.arn",AWS_ECS_LAUNCHTYPE:"aws.ecs.launchtype",AWS_ECS_TASK_ARN:"aws.ecs.task.arn",AWS_ECS_TASK_FAMILY:"aws.ecs.task.family",AWS_ECS_TASK_REVISION:"aws.ecs.task.revision",AWS_EKS_CLUSTER_ARN:"aws.eks.cluster.arn",AWS_LOG_GROUP_NAMES:"aws.log.group.names",AWS_LOG_GROUP_ARNS:"aws.log.group.arns",AWS_LOG_STREAM_NAMES:"aws.log.stream.names",AWS_LOG_STREAM_ARNS:"aws.log.stream.arns",CONTAINER_NAME:"container.name",CONTAINER_ID:"container.id",CONTAINER_RUNTIME:"container.runtime",CONTAINER_IMAGE_NAME:"container.image.name",CONTAINER_IMAGE_TAG:"container.image.tag",DEPLOYMENT_ENVIRONMENT:"deployment.environment",DEVICE_ID:"device.id",DEVICE_MODEL_IDENTIFIER:"device.model.identifier",DEVICE_MODEL_NAME:"device.model.name",FAAS_NAME:"faas.name",FAAS_ID:"faas.id",FAAS_VERSION:"faas.version",FAAS_INSTANCE:"faas.instance",FAAS_MAX_MEMORY:"faas.max_memory",HOST_ID:"host.id",HOST_NAME:"host.name",HOST_TYPE:"host.type",HOST_ARCH:"host.arch",HOST_IMAGE_NAME:"host.image.name",HOST_IMAGE_ID:"host.image.id",HOST_IMAGE_VERSION:"host.image.version",K8S_CLUSTER_NAME:"k8s.cluster.name",K8S_NODE_NAME:"k8s.node.name",K8S_NODE_UID:"k8s.node.uid",K8S_NAMESPACE_NAME:"k8s.namespace.name",K8S_POD_UID:"k8s.pod.uid",K8S_POD_NAME:"k8s.pod.name",K8S_CONTAINER_NAME:"k8s.container.name",K8S_REPLICASET_UID:"k8s.replicaset.uid",K8S_REPLICASET_NAME:"k8s.replicaset.name",K8S_DEPLOYMENT_UID:"k8s.deployment.uid",K8S_DEPLOYMENT_NAME:"k8s.deployment.name",K8S_STATEFULSET_UID:"k8s.statefulset.uid",K8S_STATEFULSET_NAME:"k8s.statefulset.name",K8S_DAEMONSET_UID:"k8s.daemonset.uid",K8S_DAEMONSET_NAME:"k8s.daemonset.name",K8S_JOB_UID:"k8s.job.uid",K8S_JOB_NAME:"k8s.job.name",K8S_CRONJOB_UID:"k8s.cronjob.uid",K8S_CRONJOB_NAME:"k8s.cronjob.name",OS_TYPE:"os.type",OS_DESCRIPTION:"os.description",OS_NAME:"os.name",OS_VERSION:"os.version",PROCESS_PID:"process.pid",PROCESS_EXECUTABLE_NAME:"process.executable.name",PROCESS_EXECUTABLE_PATH:"process.executable.path",PROCESS_COMMAND:"process.command",PROCESS_COMMAND_LINE:"process.command_line",PROCESS_COMMAND_ARGS:"process.command_args",PROCESS_OWNER:"process.owner",PROCESS_RUNTIME_NAME:"process.runtime.name",PROCESS_RUNTIME_VERSION:"process.runtime.version",PROCESS_RUNTIME_DESCRIPTION:"process.runtime.description",SERVICE_NAME:"service.name",SERVICE_NAMESPACE:"service.namespace",SERVICE_INSTANCE_ID:"service.instance.id",SERVICE_VERSION:"service.version",TELEMETRY_SDK_NAME:"telemetry.sdk.name",TELEMETRY_SDK_LANGUAGE:"telemetry.sdk.language",TELEMETRY_SDK_VERSION:"telemetry.sdk.version",TELEMETRY_AUTO_VERSION:"telemetry.auto.version",WEBENGINE_NAME:"webengine.name",WEBENGINE_VERSION:"webengine.version",WEBENGINE_DESCRIPTION:"webengine.description"},Xo={CPP:"cpp",DOTNET:"dotnet",ERLANG:"erlang",GO:"go",JAVA:"java",NODEJS:"nodejs",PHP:"php",PYTHON:"python",RUBY:"ruby",WEBJS:"webjs"},ie,St=(ie={},ie[je.TELEMETRY_SDK_NAME]="opentelemetry",ie[je.PROCESS_RUNTIME_NAME]="browser",ie[je.TELEMETRY_SDK_LANGUAGE]=Xo.WEBJS,ie[je.TELEMETRY_SDK_VERSION]=Ho,ie);var yr=9,it=Math.pow(10,yr);function Pn(t){var e=t/1e3,n=Math.trunc(e),r=Number((e-n).toFixed(yr))*it;return[n,r]}function Ko(){var t=Ht.timeOrigin;if(typeof t!="number"){var e=Ht;t=e.timing&&e.timing.fetchStart}return t}function Tr(t){var e=Pn(Ko()),n=Pn(typeof t=="number"?t:Ht.now()),r=e[0]+n[0],i=e[1]+n[1];return i>it&&(i-=it,r+=1),[r,i]}function Xt(t){return t[0]*it+t[1]}function Fe(t){return Math.round(t[0]*1e6+t[1]/1e3)}var Z;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.FAILED=1]="FAILED"})(Z||(Z={}));var Ln;(function(t){t.HTTP="http"})(Ln||(Ln={}));var Wo=Function.prototype,Yo=Wo.toString;Yo.call(Object);var zo=function(){function t(){var e=this;this._promise=new Promise(function(n,r){e._resolve=n,e._reject=r})}return Object.defineProperty(t.prototype,"promise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),t.prototype.resolve=function(e){this._resolve(e)},t.prototype.reject=function(e){this._reject(e)},t}(),qo=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},$o=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))},Jo=function(){function t(e,n){this._callback=e,this._that=n,this._isCalled=!1,this._deferred=new zo}return Object.defineProperty(t.prototype,"isCalled",{get:function(){return this._isCalled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"promise",{get:function(){return this._deferred.promise},enumerable:!1,configurable:!0}),t.prototype.call=function(){for(var e,n=this,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];if(!this._isCalled){this._isCalled=!0;try{Promise.resolve((e=this._callback).call.apply(e,$o([this._that],qo(r),!1))).then(function(o){return n._deferred.resolve(o)},function(o){return n._deferred.reject(o)})}catch(o){this._deferred.reject(o)}}return this._deferred.promise},t}();function Qo(){return"unknown_service"}var Zo=function(){function t(e){this.attributes=e}return t.empty=function(){return t.EMPTY},t.default=function(){var e;return new t((e={},e[z.SERVICE_NAME]=Qo(),e[z.TELEMETRY_SDK_LANGUAGE]=St[z.TELEMETRY_SDK_LANGUAGE],e[z.TELEMETRY_SDK_NAME]=St[z.TELEMETRY_SDK_NAME],e[z.TELEMETRY_SDK_VERSION]=St[z.TELEMETRY_SDK_VERSION],e))},t.prototype.merge=function(e){if(!e||!Object.keys(e.attributes).length)return this;var n=Object.assign({},this.attributes,e.attributes);return new t(n)},t.EMPTY=new t({}),t}();var q={AWS_LAMBDA_INVOKED_ARN:"aws.lambda.invoked_arn",DB_SYSTEM:"db.system",DB_CONNECTION_STRING:"db.connection_string",DB_USER:"db.user",DB_JDBC_DRIVER_CLASSNAME:"db.jdbc.driver_classname",DB_NAME:"db.name",DB_STATEMENT:"db.statement",DB_OPERATION:"db.operation",DB_MSSQL_INSTANCE_NAME:"db.mssql.instance_name",DB_CASSANDRA_KEYSPACE:"db.cassandra.keyspace",DB_CASSANDRA_PAGE_SIZE:"db.cassandra.page_size",DB_CASSANDRA_CONSISTENCY_LEVEL:"db.cassandra.consistency_level",DB_CASSANDRA_TABLE:"db.cassandra.table",DB_CASSANDRA_IDEMPOTENCE:"db.cassandra.idempotence",DB_CASSANDRA_SPECULATIVE_EXECUTION_COUNT:"db.cassandra.speculative_execution_count",DB_CASSANDRA_COORDINATOR_ID:"db.cassandra.coordinator.id",DB_CASSANDRA_COORDINATOR_DC:"db.cassandra.coordinator.dc",DB_HBASE_NAMESPACE:"db.hbase.namespace",DB_REDIS_DATABASE_INDEX:"db.redis.database_index",DB_MONGODB_COLLECTION:"db.mongodb.collection",DB_SQL_TABLE:"db.sql.table",EXCEPTION_TYPE:"exception.type",EXCEPTION_MESSAGE:"exception.message",EXCEPTION_STACKTRACE:"exception.stacktrace",EXCEPTION_ESCAPED:"exception.escaped",FAAS_TRIGGER:"faas.trigger",FAAS_EXECUTION:"faas.execution",FAAS_DOCUMENT_COLLECTION:"faas.document.collection",FAAS_DOCUMENT_OPERATION:"faas.document.operation",FAAS_DOCUMENT_TIME:"faas.document.time",FAAS_DOCUMENT_NAME:"faas.document.name",FAAS_TIME:"faas.time",FAAS_CRON:"faas.cron",FAAS_COLDSTART:"faas.coldstart",FAAS_INVOKED_NAME:"faas.invoked_name",FAAS_INVOKED_PROVIDER:"faas.invoked_provider",FAAS_INVOKED_REGION:"faas.invoked_region",NET_TRANSPORT:"net.transport",NET_PEER_IP:"net.peer.ip",NET_PEER_PORT:"net.peer.port",NET_PEER_NAME:"net.peer.name",NET_HOST_IP:"net.host.ip",NET_HOST_PORT:"net.host.port",NET_HOST_NAME:"net.host.name",NET_HOST_CONNECTION_TYPE:"net.host.connection.type",NET_HOST_CONNECTION_SUBTYPE:"net.host.connection.subtype",NET_HOST_CARRIER_NAME:"net.host.carrier.name",NET_HOST_CARRIER_MCC:"net.host.carrier.mcc",NET_HOST_CARRIER_MNC:"net.host.carrier.mnc",NET_HOST_CARRIER_ICC:"net.host.carrier.icc",PEER_SERVICE:"peer.service",ENDUSER_ID:"enduser.id",ENDUSER_ROLE:"enduser.role",ENDUSER_SCOPE:"enduser.scope",THREAD_ID:"thread.id",THREAD_NAME:"thread.name",CODE_FUNCTION:"code.function",CODE_NAMESPACE:"code.namespace",CODE_FILEPATH:"code.filepath",CODE_LINENO:"code.lineno",HTTP_METHOD:"http.method",HTTP_URL:"http.url",HTTP_TARGET:"http.target",HTTP_HOST:"http.host",HTTP_SCHEME:"http.scheme",HTTP_STATUS_CODE:"http.status_code",HTTP_FLAVOR:"http.flavor",HTTP_USER_AGENT:"http.user_agent",HTTP_REQUEST_CONTENT_LENGTH:"http.request_content_length",HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED:"http.request_content_length_uncompressed",HTTP_RESPONSE_CONTENT_LENGTH:"http.response_content_length",HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED:"http.response_content_length_uncompressed",HTTP_SERVER_NAME:"http.server_name",HTTP_ROUTE:"http.route",HTTP_CLIENT_IP:"http.client_ip",AWS_DYNAMODB_TABLE_NAMES:"aws.dynamodb.table_names",AWS_DYNAMODB_CONSUMED_CAPACITY:"aws.dynamodb.consumed_capacity",AWS_DYNAMODB_ITEM_COLLECTION_METRICS:"aws.dynamodb.item_collection_metrics",AWS_DYNAMODB_PROVISIONED_READ_CAPACITY:"aws.dynamodb.provisioned_read_capacity",AWS_DYNAMODB_PROVISIONED_WRITE_CAPACITY:"aws.dynamodb.provisioned_write_capacity",AWS_DYNAMODB_CONSISTENT_READ:"aws.dynamodb.consistent_read",AWS_DYNAMODB_PROJECTION:"aws.dynamodb.projection",AWS_DYNAMODB_LIMIT:"aws.dynamodb.limit",AWS_DYNAMODB_ATTRIBUTES_TO_GET:"aws.dynamodb.attributes_to_get",AWS_DYNAMODB_INDEX_NAME:"aws.dynamodb.index_name",AWS_DYNAMODB_SELECT:"aws.dynamodb.select",AWS_DYNAMODB_GLOBAL_SECONDARY_INDEXES:"aws.dynamodb.global_secondary_indexes",AWS_DYNAMODB_LOCAL_SECONDARY_INDEXES:"aws.dynamodb.local_secondary_indexes",AWS_DYNAMODB_EXCLUSIVE_START_TABLE:"aws.dynamodb.exclusive_start_table",AWS_DYNAMODB_TABLE_COUNT:"aws.dynamodb.table_count",AWS_DYNAMODB_SCAN_FORWARD:"aws.dynamodb.scan_forward",AWS_DYNAMODB_SEGMENT:"aws.dynamodb.segment",AWS_DYNAMODB_TOTAL_SEGMENTS:"aws.dynamodb.total_segments",AWS_DYNAMODB_COUNT:"aws.dynamodb.count",AWS_DYNAMODB_SCANNED_COUNT:"aws.dynamodb.scanned_count",AWS_DYNAMODB_ATTRIBUTE_DEFINITIONS:"aws.dynamodb.attribute_definitions",AWS_DYNAMODB_GLOBAL_SECONDARY_INDEX_UPDATES:"aws.dynamodb.global_secondary_index_updates",MESSAGING_SYSTEM:"messaging.system",MESSAGING_DESTINATION:"messaging.destination",MESSAGING_DESTINATION_KIND:"messaging.destination_kind",MESSAGING_TEMP_DESTINATION:"messaging.temp_destination",MESSAGING_PROTOCOL:"messaging.protocol",MESSAGING_PROTOCOL_VERSION:"messaging.protocol_version",MESSAGING_URL:"messaging.url",MESSAGING_MESSAGE_ID:"messaging.message_id",MESSAGING_CONVERSATION_ID:"messaging.conversation_id",MESSAGING_MESSAGE_PAYLOAD_SIZE_BYTES:"messaging.message_payload_size_bytes",MESSAGING_MESSAGE_PAYLOAD_COMPRESSED_SIZE_BYTES:"messaging.message_payload_compressed_size_bytes",MESSAGING_OPERATION:"messaging.operation",MESSAGING_CONSUMER_ID:"messaging.consumer_id",MESSAGING_RABBITMQ_ROUTING_KEY:"messaging.rabbitmq.routing_key",MESSAGING_KAFKA_MESSAGE_KEY:"messaging.kafka.message_key",MESSAGING_KAFKA_CONSUMER_GROUP:"messaging.kafka.consumer_group",MESSAGING_KAFKA_CLIENT_ID:"messaging.kafka.client_id",MESSAGING_KAFKA_PARTITION:"messaging.kafka.partition",MESSAGING_KAFKA_TOMBSTONE:"messaging.kafka.tombstone",RPC_SYSTEM:"rpc.system",RPC_SERVICE:"rpc.service",RPC_METHOD:"rpc.method",RPC_GRPC_STATUS_CODE:"rpc.grpc.status_code",RPC_JSONRPC_VERSION:"rpc.jsonrpc.version",RPC_JSONRPC_REQUEST_ID:"rpc.jsonrpc.request_id",RPC_JSONRPC_ERROR_CODE:"rpc.jsonrpc.error_code",RPC_JSONRPC_ERROR_MESSAGE:"rpc.jsonrpc.error_message",MESSAGE_TYPE:"message.type",MESSAGE_ID:"message.id",MESSAGE_COMPRESSED_SIZE:"message.compressed_size",MESSAGE_UNCOMPRESSED_SIZE:"message.uncompressed_size"},P={CLOUD_PROVIDER:"cloud.provider",CLOUD_ACCOUNT_ID:"cloud.account.id",CLOUD_REGION:"cloud.region",CLOUD_AVAILABILITY_ZONE:"cloud.availability_zone",CLOUD_PLATFORM:"cloud.platform",AWS_ECS_CONTAINER_ARN:"aws.ecs.container.arn",AWS_ECS_CLUSTER_ARN:"aws.ecs.cluster.arn",AWS_ECS_LAUNCHTYPE:"aws.ecs.launchtype",AWS_ECS_TASK_ARN:"aws.ecs.task.arn",AWS_ECS_TASK_FAMILY:"aws.ecs.task.family",AWS_ECS_TASK_REVISION:"aws.ecs.task.revision",AWS_EKS_CLUSTER_ARN:"aws.eks.cluster.arn",AWS_LOG_GROUP_NAMES:"aws.log.group.names",AWS_LOG_GROUP_ARNS:"aws.log.group.arns",AWS_LOG_STREAM_NAMES:"aws.log.stream.names",AWS_LOG_STREAM_ARNS:"aws.log.stream.arns",CONTAINER_NAME:"container.name",CONTAINER_ID:"container.id",CONTAINER_RUNTIME:"container.runtime",CONTAINER_IMAGE_NAME:"container.image.name",CONTAINER_IMAGE_TAG:"container.image.tag",DEPLOYMENT_ENVIRONMENT:"deployment.environment",DEVICE_ID:"device.id",DEVICE_MODEL_IDENTIFIER:"device.model.identifier",DEVICE_MODEL_NAME:"device.model.name",FAAS_NAME:"faas.name",FAAS_ID:"faas.id",FAAS_VERSION:"faas.version",FAAS_INSTANCE:"faas.instance",FAAS_MAX_MEMORY:"faas.max_memory",HOST_ID:"host.id",HOST_NAME:"host.name",HOST_TYPE:"host.type",HOST_ARCH:"host.arch",HOST_IMAGE_NAME:"host.image.name",HOST_IMAGE_ID:"host.image.id",HOST_IMAGE_VERSION:"host.image.version",K8S_CLUSTER_NAME:"k8s.cluster.name",K8S_NODE_NAME:"k8s.node.name",K8S_NODE_UID:"k8s.node.uid",K8S_NAMESPACE_NAME:"k8s.namespace.name",K8S_POD_UID:"k8s.pod.uid",K8S_POD_NAME:"k8s.pod.name",K8S_CONTAINER_NAME:"k8s.container.name",K8S_REPLICASET_UID:"k8s.replicaset.uid",K8S_REPLICASET_NAME:"k8s.replicaset.name",K8S_DEPLOYMENT_UID:"k8s.deployment.uid",K8S_DEPLOYMENT_NAME:"k8s.deployment.name",K8S_STATEFULSET_UID:"k8s.statefulset.uid",K8S_STATEFULSET_NAME:"k8s.statefulset.name",K8S_DAEMONSET_UID:"k8s.daemonset.uid",K8S_DAEMONSET_NAME:"k8s.daemonset.name",K8S_JOB_UID:"k8s.job.uid",K8S_JOB_NAME:"k8s.job.name",K8S_CRONJOB_UID:"k8s.cronjob.uid",K8S_CRONJOB_NAME:"k8s.cronjob.name",OS_TYPE:"os.type",OS_DESCRIPTION:"os.description",OS_NAME:"os.name",OS_VERSION:"os.version",PROCESS_PID:"process.pid",PROCESS_EXECUTABLE_NAME:"process.executable.name",PROCESS_EXECUTABLE_PATH:"process.executable.path",PROCESS_COMMAND:"process.command",PROCESS_COMMAND_LINE:"process.command_line",PROCESS_COMMAND_ARGS:"process.command_args",PROCESS_OWNER:"process.owner",PROCESS_RUNTIME_NAME:"process.runtime.name",PROCESS_RUNTIME_VERSION:"process.runtime.version",PROCESS_RUNTIME_DESCRIPTION:"process.runtime.description",SERVICE_NAME:"service.name",SERVICE_NAMESPACE:"service.namespace",SERVICE_INSTANCE_ID:"service.instance.id",SERVICE_VERSION:"service.version",TELEMETRY_SDK_NAME:"telemetry.sdk.name",TELEMETRY_SDK_LANGUAGE:"telemetry.sdk.language",TELEMETRY_SDK_VERSION:"telemetry.sdk.version",TELEMETRY_AUTO_VERSION:"telemetry.auto.version",WEBENGINE_NAME:"webengine.name",WEBENGINE_VERSION:"webengine.version",WEBENGINE_DESCRIPTION:"webengine.description"},ea={CPP:"cpp",DOTNET:"dotnet",ERLANG:"erlang",GO:"go",JAVA:"java",NODEJS:"nodejs",PHP:"php",PYTHON:"python",RUBY:"ruby",WEBJS:"webjs"},Sr=tn("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function ta(t){return t.setValue(Sr,!0)}function un(t){return t.getValue(Sr)===!0}var na="=",Kt=";",Wt=",",Ot="baggage",ra=180,ia=4096,oa=8192,aa=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o};function sa(t){return t.reduce(function(e,n){var r=""+e+(e!==""?Wt:"")+n;return r.length>oa?e:r},"")}function ua(t){return t.getAllEntries().map(function(e){var n=aa(e,2),r=n[0],i=n[1],o=encodeURIComponent(r)+"="+encodeURIComponent(i.value);return i.metadata!==void 0&&(o+=Kt+i.metadata.toString()),o})}function ca(t){var e=t.split(Kt);if(!(e.length<=0)){var n=e.shift();if(n){var r=n.indexOf(na);if(!(r<=0)){var i=decodeURIComponent(n.substring(0,r).trim()),o=decodeURIComponent(n.substring(r+1).trim()),a;return e.length>0&&(a=fr(e.join(Kt))),{key:i,value:o,metadata:a}}}}}var la=function(){function t(){}return t.prototype.inject=function(e,n,r){var i=qe.getBaggage(e);if(!(!i||un(e))){var o=ua(i).filter(function(u){return u.length<=ia}).slice(0,ra),a=sa(o);a.length>0&&r.set(n,Ot,a)}},t.prototype.extract=function(e,n,r){var i=r.get(n,Ot),o=Array.isArray(i)?i.join(Wt):i;if(!o)return e;var a={};if(o.length===0)return e;var u=o.split(Wt);return u.forEach(function(c){var s=ca(c);if(s){var l={value:s.value};s.metadata&&(l.metadata=s.metadata),a[s.key]=l}}),Object.entries(a).length===0?e:qe.setBaggage(e,qe.createBaggage(a))},t.prototype.fields=function(){return[Ot]},t}(),Or=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},fa=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o};function $e(t){var e,n,r={};if(typeof t!="object"||t==null)return r;try{for(var i=Or(Object.entries(t)),o=i.next();!o.done;o=i.next()){var a=fa(o.value,2),u=a[0],c=a[1];if(!da(u)){_.warn("Invalid attribute key: "+u);continue}if(!br(c)){_.warn("Invalid attribute value set for key: "+u);continue}Array.isArray(c)?r[u]=c.slice():r[u]=c}}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function da(t){return typeof t=="string"&&t.length>0}function br(t){return t==null?!0:Array.isArray(t)?_a(t):Ar(t)}function _a(t){var e,n,r;try{for(var i=Or(t),o=i.next();!o.done;o=i.next()){var a=o.value;if(a!=null){if(!r){if(Ar(a)){r=typeof a;continue}return!1}if(typeof a!==r)return!1}}}catch(u){e={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return!0}function Ar(t){switch(typeof t){case"number":case"boolean":case"string":return!0}return!1}function ha(){return function(t){_.error(pa(t))}}function pa(t){return typeof t=="string"?t:JSON.stringify(va(t))}function va(t){for(var e={},n=t;n!==null;)Object.getOwnPropertyNames(n).forEach(function(r){if(!e[r]){var i=n[r];i&&(e[r]=String(i))}}),n=Object.getPrototypeOf(n);return e}var Ea=ha();function ot(t){try{Ea(t)}catch{}}var U;(function(t){t.AlwaysOff="always_off",t.AlwaysOn="always_on",t.ParentBasedAlwaysOff="parentbased_always_off",t.ParentBasedAlwaysOn="parentbased_always_on",t.ParentBasedTraceIdRatio="parentbased_traceidratio",t.TraceIdRatio="traceidratio"})(U||(U={}));var Rr=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},Dn={},ga=",",ma=["OTEL_SDK_DISABLED"];function ya(t){return ma.indexOf(t)>-1}var Ta=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_BLRP_EXPORT_TIMEOUT","OTEL_BLRP_MAX_EXPORT_BATCH_SIZE","OTEL_BLRP_MAX_QUEUE_SIZE","OTEL_BLRP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_OTLP_LOGS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];function Sa(t){return Ta.indexOf(t)>-1}var Oa=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS"];function ba(t){return Oa.indexOf(t)>-1}var Je=1/0,Qe=128,Aa=128,Ra=128,Cr={OTEL_SDK_DISABLED:!1,CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_BLRP_EXPORT_TIMEOUT:3e4,OTEL_BLRP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BLRP_MAX_QUEUE_SIZE:2048,OTEL_BLRP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_LOGS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_LOGS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_LOGS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:g.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:Je,OTEL_ATTRIBUTE_COUNT_LIMIT:Qe,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:Je,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:Qe,OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT:Je,OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT:Qe,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT:Aa,OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT:Ra,OTEL_TRACES_EXPORTER:"",OTEL_TRACES_SAMPLER:U.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_LOGS_EXPORTER:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_LOGS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_LOGS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_TRACES_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_LOGS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE:"cumulative"};function Ca(t,e,n){if(!(typeof n[t]>"u")){var r=String(n[t]);e[t]=r.toLowerCase()==="true"}}function wa(t,e,n,r,i){if(r===void 0&&(r=-1/0),i===void 0&&(i=1/0),typeof n[t]<"u"){var o=Number(n[t]);isNaN(o)||(o<r?e[t]=r:o>i?e[t]=i:e[t]=o)}}function Ia(t,e,n,r){r===void 0&&(r=ga);var i=n[t];typeof i=="string"&&(e[t]=i.split(r).map(function(o){return o.trim()}))}var Na={ALL:g.ALL,VERBOSE:g.VERBOSE,DEBUG:g.DEBUG,INFO:g.INFO,WARN:g.WARN,ERROR:g.ERROR,NONE:g.NONE};function Ma(t,e,n){var r=n[t];if(typeof r=="string"){var i=Na[r.toUpperCase()];i!=null&&(e[t]=i)}}function Yt(t){var e={};for(var n in Cr){var r=n;switch(r){case"OTEL_LOG_LEVEL":Ma(r,e,t);break;default:if(ya(r))Ca(r,e,t);else if(Sa(r))wa(r,e,t);else if(ba(r))Ia(r,e,t);else{var i=t[r];typeof i<"u"&&i!==null&&(e[r]=String(i))}}}return e}function Pa(){return Yt(typeof process<"u"&&process&&Dn?Dn:Rr)}function M(){var t=Yt(Rr);return Object.assign({},Cr,t)}var le=performance,La="1.18.1",oe,bt=(oe={},oe[P.TELEMETRY_SDK_NAME]="opentelemetry",oe[P.PROCESS_RUNTIME_NAME]="browser",oe[P.TELEMETRY_SDK_LANGUAGE]=ea.WEBJS,oe[P.TELEMETRY_SDK_VERSION]=La,oe);var Da=9,xa=6,Ua=Math.pow(10,xa),zt=Math.pow(10,Da);function se(t){var e=t/1e3,n=Math.trunc(e),r=Math.round(t%1e3*Ua);return[n,r]}function wr(){var t=le.timeOrigin;if(typeof t!="number"){var e=le;t=e.timing&&e.timing.fetchStart}return t}function ka(t){var e=se(wr()),n=se(typeof t=="number"?t:le.now());return Nr(e,n)}function Ba(t,e){var n=e[0]-t[0],r=e[1]-t[1];return r<0&&(n-=1,r+=zt),[n,r]}function Ir(t){return Array.isArray(t)&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number"}function xn(t){return Ir(t)||typeof t=="number"||t instanceof Date}function Nr(t,e){var n=[t[0]+e[0],t[1]+e[1]];return n[1]>=zt&&(n[1]-=zt,n[0]+=1),n}var qt;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.FAILED=1]="FAILED"})(qt||(qt={}));var Ga=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Va=function(){function t(e){e===void 0&&(e={});var n;this._propagators=(n=e.propagators)!==null&&n!==void 0?n:[],this._fields=Array.from(new Set(this._propagators.map(function(r){return typeof r.fields=="function"?r.fields():[]}).reduce(function(r,i){return r.concat(i)},[])))}return t.prototype.inject=function(e,n,r){var i,o;try{for(var a=Ga(this._propagators),u=a.next();!u.done;u=a.next()){var c=u.value;try{c.inject(e,n,r)}catch(s){_.warn("Failed to inject with "+c.constructor.name+". Err: "+s.message)}}}catch(s){i={error:s}}finally{try{u&&!u.done&&(o=a.return)&&o.call(a)}finally{if(i)throw i.error}}},t.prototype.extract=function(e,n,r){return this._propagators.reduce(function(i,o){try{return o.extract(i,n,r)}catch(a){_.warn("Failed to inject with "+o.constructor.name+". Err: "+a.message)}return i},e)},t.prototype.fields=function(){return this._fields.slice()},t}(),$t="[_0-9a-z-*/]",ja="[a-z]"+$t+"{0,255}",Fa="[a-z0-9]"+$t+"{0,240}@[a-z]"+$t+"{0,13}",Ha=new RegExp("^(?:"+ja+"|"+Fa+")$"),Xa=/^[ -~]{0,255}[!-~]$/,Ka=/,|=/;function Wa(t){return Ha.test(t)}function Ya(t){return Xa.test(t)&&!Ka.test(t)}var Un=32,za=512,kn=",",Bn="=",qa=function(){function t(e){this._internalState=new Map,e&&this._parse(e)}return t.prototype.set=function(e,n){var r=this._clone();return r._internalState.has(e)&&r._internalState.delete(e),r._internalState.set(e,n),r},t.prototype.unset=function(e){var n=this._clone();return n._internalState.delete(e),n},t.prototype.get=function(e){return this._internalState.get(e)},t.prototype.serialize=function(){var e=this;return this._keys().reduce(function(n,r){return n.push(r+Bn+e.get(r)),n},[]).join(kn)},t.prototype._parse=function(e){e.length>za||(this._internalState=e.split(kn).reverse().reduce(function(n,r){var i=r.trim(),o=i.indexOf(Bn);if(o!==-1){var a=i.slice(0,o),u=i.slice(o+1,r.length);Wa(a)&&Ya(u)&&n.set(a,u)}return n},new Map),this._internalState.size>Un&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,Un))))},t.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},t.prototype._clone=function(){var e=new t;return e._internalState=new Map(this._internalState),e},t}(),At="traceparent",Rt="tracestate",$a="00",Ja="(?!ff)[\\da-f]{2}",Qa="(?![0]{32})[\\da-f]{32}",Za="(?![0]{16})[\\da-f]{16}",es="[\\da-f]{2}",ts=new RegExp("^\\s?("+Ja+")-("+Qa+")-("+Za+")-("+es+")(-.*)?\\s?$");function ns(t){var e=ts.exec(t);return!e||e[1]==="00"&&e[5]?null:{traceId:e[2],spanId:e[3],traceFlags:parseInt(e[4],16)}}var rs=function(){function t(){}return t.prototype.inject=function(e,n,r){var i=x.getSpanContext(e);if(!(!i||un(e)||!ht(i))){var o=$a+"-"+i.traceId+"-"+i.spanId+"-0"+Number(i.traceFlags||j.NONE).toString(16);r.set(n,At,o),i.traceState&&r.set(n,Rt,i.traceState.serialize())}},t.prototype.extract=function(e,n,r){var i=r.get(n,At);if(!i)return e;var o=Array.isArray(i)?i[0]:i;if(typeof o!="string")return e;var a=ns(o);if(!a)return e;a.isRemote=!0;var u=r.get(n,Rt);if(u){var c=Array.isArray(u)?u.join(","):u;a.traceState=new qa(typeof c=="string"?c:void 0)}return x.setSpanContext(e,a)},t.prototype.fields=function(){return[At,Rt]},t}(),is="[object Object]",os="[object Null]",as="[object Undefined]",ss=Function.prototype,Mr=ss.toString,us=Mr.call(Object),cs=ls(Object.getPrototypeOf,Object),Pr=Object.prototype,Lr=Pr.hasOwnProperty,J=Symbol?Symbol.toStringTag:void 0,Dr=Pr.toString;function ls(t,e){return function(n){return t(e(n))}}function Gn(t){if(!fs(t)||ds(t)!==is)return!1;var e=cs(t);if(e===null)return!0;var n=Lr.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&Mr.call(n)===us}function fs(t){return t!=null&&typeof t=="object"}function ds(t){return t==null?t===void 0?as:os:J&&J in Object(t)?_s(t):hs(t)}function _s(t){var e=Lr.call(t,J),n=t[J],r=!1;try{t[J]=void 0,r=!0}catch{}var i=Dr.call(t);return r&&(e?t[J]=n:delete t[J]),i}function hs(t){return Dr.call(t)}var ps=20;function vs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=t.shift(),r=new WeakMap;t.length>0;)n=xr(n,t.shift(),0,r);return n}function Ct(t){return at(t)?t.slice():t}function xr(t,e,n,r){n===void 0&&(n=0);var i;if(!(n>ps)){if(n++,Ze(t)||Ze(e)||Ur(e))i=Ct(e);else if(at(t)){if(i=t.slice(),at(e))for(var o=0,a=e.length;o<a;o++)i.push(Ct(e[o]));else if(ye(e))for(var u=Object.keys(e),o=0,a=u.length;o<a;o++){var c=u[o];i[c]=Ct(e[c])}}else if(ye(t))if(ye(e)){if(!Es(t,e))return e;i=Object.assign({},t);for(var u=Object.keys(e),o=0,a=u.length;o<a;o++){var c=u[o],s=e[c];if(Ze(s))typeof s>"u"?delete i[c]:i[c]=s;else{var l=i[c],f=s;if(Vn(t,c,r)||Vn(e,c,r))delete i[c];else{if(ye(l)&&ye(f)){var d=r.get(l)||[],h=r.get(f)||[];d.push({obj:t,key:c}),h.push({obj:e,key:c}),r.set(l,d),r.set(f,h)}i[c]=xr(i[c],s,n,r)}}}}else i=e;return i}}function Vn(t,e,n){for(var r=n.get(t[e])||[],i=0,o=r.length;i<o;i++){var a=r[i];if(a.key===e&&a.obj===t)return!0}return!1}function at(t){return Array.isArray(t)}function Ur(t){return typeof t=="function"}function ye(t){return!Ze(t)&&!at(t)&&!Ur(t)&&typeof t=="object"}function Ze(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t>"u"||t instanceof Date||t instanceof RegExp||t===null}function Es(t,e){return!(!Gn(t)||!Gn(e))}var gs=function(){function t(){var e=this;this._promise=new Promise(function(n,r){e._resolve=n,e._reject=r})}return Object.defineProperty(t.prototype,"promise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),t.prototype.resolve=function(e){this._resolve(e)},t.prototype.reject=function(e){this._reject(e)},t}(),ms=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},ys=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))},Ts=function(){function t(e,n){this._callback=e,this._that=n,this._isCalled=!1,this._deferred=new gs}return Object.defineProperty(t.prototype,"isCalled",{get:function(){return this._isCalled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"promise",{get:function(){return this._deferred.promise},enumerable:!1,configurable:!0}),t.prototype.call=function(){for(var e,n=this,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];if(!this._isCalled){this._isCalled=!0;try{Promise.resolve((e=this._callback).call.apply(e,ys([this._that],ms(r),!1))).then(function(o){return n._deferred.resolve(o)},function(o){return n._deferred.reject(o)})}catch(o){this._deferred.reject(o)}}return this._deferred.promise},t}(),Ss="exception",Os=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},bs=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},As=function(){function t(e,n,r,i,o,a,u,c,s){u===void 0&&(u=[]),this.attributes={},this.links=[],this.events=[],this._droppedAttributesCount=0,this._droppedEventsCount=0,this._droppedLinksCount=0,this.status={code:jt.UNSET},this.endTime=[0,0],this._ended=!1,this._duration=[-1,-1],this.name=r,this._spanContext=i,this.parentSpanId=a,this.kind=o,this.links=u;var l=Date.now();this._performanceStartTime=le.now(),this._performanceOffset=l-(this._performanceStartTime+wr()),this._startTimeProvided=c!=null,this.startTime=this._getTime(c??l),this.resource=e.resource,this.instrumentationLibrary=e.instrumentationLibrary,this._spanLimits=e.getSpanLimits(),this._spanProcessor=e.getActiveSpanProcessor(),this._spanProcessor.onStart(this,n),this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0}return t.prototype.spanContext=function(){return this._spanContext},t.prototype.setAttribute=function(e,n){return n==null||this._isSpanEnded()?this:e.length===0?(_.warn("Invalid attribute key: "+e),this):br(n)?Object.keys(this.attributes).length>=this._spanLimits.attributeCountLimit&&!Object.prototype.hasOwnProperty.call(this.attributes,e)?(this._droppedAttributesCount++,this):(this.attributes[e]=this._truncateToSize(n),this):(_.warn("Invalid attribute value set for key: "+e),this)},t.prototype.setAttributes=function(e){var n,r;try{for(var i=Os(Object.entries(e)),o=i.next();!o.done;o=i.next()){var a=bs(o.value,2),u=a[0],c=a[1];this.setAttribute(u,c)}}catch(s){n={error:s}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return this},t.prototype.addEvent=function(e,n,r){if(this._isSpanEnded())return this;if(this._spanLimits.eventCountLimit===0)return _.warn("No events allowed."),this._droppedEventsCount++,this;this.events.length>=this._spanLimits.eventCountLimit&&(_.warn("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),xn(n)&&(xn(r)||(r=n),n=void 0);var i=$e(n);return this.events.push({name:e,attributes:i,time:this._getTime(r),droppedAttributesCount:0}),this},t.prototype.setStatus=function(e){return this._isSpanEnded()?this:(this.status=e,this)},t.prototype.updateName=function(e){return this._isSpanEnded()?this:(this.name=e,this)},t.prototype.end=function(e){if(this._isSpanEnded()){_.error(this.name+" "+this._spanContext.traceId+"-"+this._spanContext.spanId+" - You can only call end() on a span once.");return}this._ended=!0,this.endTime=this._getTime(e),this._duration=Ba(this.startTime,this.endTime),this._duration[0]<0&&(_.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._spanProcessor.onEnd(this)},t.prototype._getTime=function(e){if(typeof e=="number"&&e<le.now())return ka(e+this._performanceOffset);if(typeof e=="number")return se(e);if(e instanceof Date)return se(e.getTime());if(Ir(e))return e;if(this._startTimeProvided)return se(Date.now());var n=le.now()-this._performanceStartTime;return Nr(this.startTime,se(n))},t.prototype.isRecording=function(){return this._ended===!1},t.prototype.recordException=function(e,n){var r={};typeof e=="string"?r[q.EXCEPTION_MESSAGE]=e:e&&(e.code?r[q.EXCEPTION_TYPE]=e.code.toString():e.name&&(r[q.EXCEPTION_TYPE]=e.name),e.message&&(r[q.EXCEPTION_MESSAGE]=e.message),e.stack&&(r[q.EXCEPTION_STACKTRACE]=e.stack)),r[q.EXCEPTION_TYPE]||r[q.EXCEPTION_MESSAGE]?this.addEvent(Ss,r,n):_.warn("Failed to record an exception "+e)},Object.defineProperty(t.prototype,"duration",{get:function(){return this._duration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ended",{get:function(){return this._ended},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"droppedAttributesCount",{get:function(){return this._droppedAttributesCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"droppedEventsCount",{get:function(){return this._droppedEventsCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"droppedLinksCount",{get:function(){return this._droppedLinksCount},enumerable:!1,configurable:!0}),t.prototype._isSpanEnded=function(){return this._ended&&_.warn("Can not execute the operation on ended Span {traceId: "+this._spanContext.traceId+", spanId: "+this._spanContext.spanId+"}"),this._ended},t.prototype._truncateToLimitUtil=function(e,n){return e.length<=n?e:e.substr(0,n)},t.prototype._truncateToSize=function(e){var n=this,r=this._attributeValueLengthLimit;return r<=0?(_.warn("Attribute value limit must be positive, got "+r),e):typeof e=="string"?this._truncateToLimitUtil(e,r):Array.isArray(e)?e.map(function(i){return typeof i=="string"?n._truncateToLimitUtil(i,r):i}):e},t}(),_e;(function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(_e||(_e={}));var st=function(){function t(){}return t.prototype.shouldSample=function(){return{decision:_e.NOT_RECORD}},t.prototype.toString=function(){return"AlwaysOffSampler"},t}(),fe=function(){function t(){}return t.prototype.shouldSample=function(){return{decision:_e.RECORD_AND_SAMPLED}},t.prototype.toString=function(){return"AlwaysOnSampler"},t}(),wt=function(){function t(e){var n,r,i,o;this._root=e.root,this._root||(ot(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new fe),this._remoteParentSampled=(n=e.remoteParentSampled)!==null&&n!==void 0?n:new fe,this._remoteParentNotSampled=(r=e.remoteParentNotSampled)!==null&&r!==void 0?r:new st,this._localParentSampled=(i=e.localParentSampled)!==null&&i!==void 0?i:new fe,this._localParentNotSampled=(o=e.localParentNotSampled)!==null&&o!==void 0?o:new st}return t.prototype.shouldSample=function(e,n,r,i,o,a){var u=x.getSpanContext(e);return!u||!ht(u)?this._root.shouldSample(e,n,r,i,o,a):u.isRemote?u.traceFlags&j.SAMPLED?this._remoteParentSampled.shouldSample(e,n,r,i,o,a):this._remoteParentNotSampled.shouldSample(e,n,r,i,o,a):u.traceFlags&j.SAMPLED?this._localParentSampled.shouldSample(e,n,r,i,o,a):this._localParentNotSampled.shouldSample(e,n,r,i,o,a)},t.prototype.toString=function(){return"ParentBased{root="+this._root.toString()+", remoteParentSampled="+this._remoteParentSampled.toString()+", remoteParentNotSampled="+this._remoteParentNotSampled.toString()+", localParentSampled="+this._localParentSampled.toString()+", localParentNotSampled="+this._localParentNotSampled.toString()+"}"},t}(),jn=function(){function t(e){e===void 0&&(e=0),this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(this._ratio*4294967295)}return t.prototype.shouldSample=function(e,n){return{decision:vr(n)&&this._accumulate(n)<this._upperBound?_e.RECORD_AND_SAMPLED:_e.NOT_RECORD}},t.prototype.toString=function(){return"TraceIdRatioBased{"+this._ratio+"}"},t.prototype._normalize=function(e){return typeof e!="number"||isNaN(e)?0:e>=1?1:e<=0?0:e},t.prototype._accumulate=function(e){for(var n=0,r=0;r<e.length/8;r++){var i=r*8,o=parseInt(e.slice(i,i+8),16);n=(n^o)>>>0}return n},t}(),Rs=M(),Cs=U.AlwaysOn,ae=1;function kr(){return{sampler:Br(Rs),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:M().OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:M().OTEL_ATTRIBUTE_COUNT_LIMIT},spanLimits:{attributeValueLengthLimit:M().OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:M().OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT,linkCountLimit:M().OTEL_SPAN_LINK_COUNT_LIMIT,eventCountLimit:M().OTEL_SPAN_EVENT_COUNT_LIMIT,attributePerEventCountLimit:M().OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT,attributePerLinkCountLimit:M().OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT}}}function Br(t){switch(t===void 0&&(t=M()),t.OTEL_TRACES_SAMPLER){case U.AlwaysOn:return new fe;case U.AlwaysOff:return new st;case U.ParentBasedAlwaysOn:return new wt({root:new fe});case U.ParentBasedAlwaysOff:return new wt({root:new st});case U.TraceIdRatio:return new jn(Fn(t));case U.ParentBasedTraceIdRatio:return new wt({root:new jn(Fn(t))});default:return _.error('OTEL_TRACES_SAMPLER value "'+t.OTEL_TRACES_SAMPLER+" invalid, defaulting to "+Cs+'".'),new fe}}function Fn(t){if(t.OTEL_TRACES_SAMPLER_ARG===void 0||t.OTEL_TRACES_SAMPLER_ARG==="")return _.error("OTEL_TRACES_SAMPLER_ARG is blank, defaulting to "+ae+"."),ae;var e=Number(t.OTEL_TRACES_SAMPLER_ARG);return isNaN(e)?(_.error("OTEL_TRACES_SAMPLER_ARG="+t.OTEL_TRACES_SAMPLER_ARG+" was given, but it is invalid, defaulting to "+ae+"."),ae):e<0||e>1?(_.error("OTEL_TRACES_SAMPLER_ARG="+t.OTEL_TRACES_SAMPLER_ARG+" was given, but it is out of range ([0..1]), defaulting to "+ae+"."),ae):e}function ws(t){var e={sampler:Br()},n=kr(),r=Object.assign({},n,e,t);return r.generalLimits=Object.assign({},n.generalLimits,t.generalLimits||{}),r.spanLimits=Object.assign({},n.spanLimits,t.spanLimits||{}),r}function Is(t){var e,n,r,i,o,a,u,c,s,l,f,d,h=Object.assign({},t.spanLimits),v=Pa();return h.attributeCountLimit=(a=(o=(i=(n=(e=t.spanLimits)===null||e===void 0?void 0:e.attributeCountLimit)!==null&&n!==void 0?n:(r=t.generalLimits)===null||r===void 0?void 0:r.attributeCountLimit)!==null&&i!==void 0?i:v.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT)!==null&&o!==void 0?o:v.OTEL_ATTRIBUTE_COUNT_LIMIT)!==null&&a!==void 0?a:Qe,h.attributeValueLengthLimit=(d=(f=(l=(c=(u=t.spanLimits)===null||u===void 0?void 0:u.attributeValueLengthLimit)!==null&&c!==void 0?c:(s=t.generalLimits)===null||s===void 0?void 0:s.attributeValueLengthLimit)!==null&&l!==void 0?l:v.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT)!==null&&f!==void 0?f:v.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT)!==null&&d!==void 0?d:Je,Object.assign({},t,{spanLimits:h})}var Ns=function(){function t(e,n){this._exporter=e,this._isExporting=!1,this._finishedSpans=[],this._droppedSpansCount=0;var r=M();this._maxExportBatchSize=typeof(n==null?void 0:n.maxExportBatchSize)=="number"?n.maxExportBatchSize:r.OTEL_BSP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize=typeof(n==null?void 0:n.maxQueueSize)=="number"?n.maxQueueSize:r.OTEL_BSP_MAX_QUEUE_SIZE,this._scheduledDelayMillis=typeof(n==null?void 0:n.scheduledDelayMillis)=="number"?n.scheduledDelayMillis:r.OTEL_BSP_SCHEDULE_DELAY,this._exportTimeoutMillis=typeof(n==null?void 0:n.exportTimeoutMillis)=="number"?n.exportTimeoutMillis:r.OTEL_BSP_EXPORT_TIMEOUT,this._shutdownOnce=new Ts(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&(_.warn("BatchSpanProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}return t.prototype.forceFlush=function(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()},t.prototype.onStart=function(e,n){},t.prototype.onEnd=function(e){this._shutdownOnce.isCalled||e.spanContext().traceFlags&j.SAMPLED&&this._addToBuffer(e)},t.prototype.shutdown=function(){return this._shutdownOnce.call()},t.prototype._shutdown=function(){var e=this;return Promise.resolve().then(function(){return e.onShutdown()}).then(function(){return e._flushAll()}).then(function(){return e._exporter.shutdown()})},t.prototype._addToBuffer=function(e){if(this._finishedSpans.length>=this._maxQueueSize){this._droppedSpansCount===0&&_.debug("maxQueueSize reached, dropping spans"),this._droppedSpansCount++;return}this._droppedSpansCount>0&&(_.warn("Dropped "+this._droppedSpansCount+" spans because maxQueueSize reached"),this._droppedSpansCount=0),this._finishedSpans.push(e),this._maybeStartTimer()},t.prototype._flushAll=function(){var e=this;return new Promise(function(n,r){for(var i=[],o=Math.ceil(e._finishedSpans.length/e._maxExportBatchSize),a=0,u=o;a<u;a++)i.push(e._flushOneBatch());Promise.all(i).then(function(){n()}).catch(r)})},t.prototype._flushOneBatch=function(){var e=this;return this._clearTimer(),this._finishedSpans.length===0?Promise.resolve():new Promise(function(n,r){var i=setTimeout(function(){r(new Error("Timeout"))},e._exportTimeoutMillis);ne.with(ta(ne.active()),function(){var o=e._finishedSpans.splice(0,e._maxExportBatchSize),a=function(){return e._exporter.export(o,function(c){var s;clearTimeout(i),c.code===qt.SUCCESS?n():r((s=c.error)!==null&&s!==void 0?s:new Error("BatchSpanProcessor: span export failed"))})},u=o.map(function(c){return c.resource}).filter(function(c){return c.asyncAttributesPending});u.length===0?a():Promise.all(u.map(function(c){var s;return(s=c.waitForAsyncAttributes)===null||s===void 0?void 0:s.call(c)})).then(a,function(c){ot(c),r(c)})})})},t.prototype._maybeStartTimer=function(){var e=this;if(!this._isExporting){var n=function(){e._isExporting=!0,e._flushOneBatch().then(function(){e._isExporting=!1,e._finishedSpans.length>0&&(e._clearTimer(),e._maybeStartTimer())}).catch(function(r){e._isExporting=!1,ot(r)})};if(this._finishedSpans.length>=this._maxExportBatchSize)return n();this._timer===void 0&&(this._timer=setTimeout(function(){return n()},this._scheduledDelayMillis),this._timer,void 0)}},t.prototype._clearTimer=function(){this._timer!==void 0&&(clearTimeout(this._timer),this._timer=void 0)},t}(),Ms=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Gr=function(t){Ms(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.onInit(r),i}return e.prototype.onInit=function(n){var r=this;(n==null?void 0:n.disableAutoFlushOnDocumentHide)!==!0&&typeof document<"u"&&(this._visibilityChangeListener=function(){document.visibilityState==="hidden"&&r.forceFlush()},this._pageHideListener=function(){r.forceFlush()},document.addEventListener("visibilitychange",this._visibilityChangeListener),document.addEventListener("pagehide",this._pageHideListener))},e.prototype.onShutdown=function(){typeof document<"u"&&(this._visibilityChangeListener&&document.removeEventListener("visibilitychange",this._visibilityChangeListener),this._pageHideListener&&document.removeEventListener("pagehide",this._pageHideListener))},e}(Ns),Ps=8,Ls=16,Ds=function(){function t(){this.generateTraceId=Hn(Ls),this.generateSpanId=Hn(Ps)}return t}(),He=Array(32);function Hn(t){return function(){for(var n=0;n<t*2;n++)He[n]=Math.floor(Math.random()*16)+48,He[n]>=58&&(He[n]+=39);return String.fromCharCode.apply(null,He.slice(0,t*2))}}var xs=function(){function t(e,n,r){this._tracerProvider=r;var i=ws(n);this._sampler=i.sampler,this._generalLimits=i.generalLimits,this._spanLimits=i.spanLimits,this._idGenerator=n.idGenerator||new Ds,this.resource=r.resource,this.instrumentationLibrary=e}return t.prototype.startSpan=function(e,n,r){var i,o,a;n===void 0&&(n={}),r===void 0&&(r=ne.active()),n.root&&(r=x.deleteSpan(r));var u=x.getSpan(r);if(un(r)){_.debug("Instrumentation suppressed, returning Noop Span");var c=x.wrapSpanContext(hr);return c}var s=u==null?void 0:u.spanContext(),l=this._idGenerator.generateSpanId(),f,d,h;!s||!x.isSpanContextValid(s)?f=this._idGenerator.generateTraceId():(f=s.traceId,d=s.traceState,h=s.spanId);var v=(i=n.kind)!==null&&i!==void 0?i:Vt.INTERNAL,m=((o=n.links)!==null&&o!==void 0?o:[]).map(function(E){return{context:E.context,attributes:$e(E.attributes)}}),O=$e(n.attributes),b=this._sampler.shouldSample(r,f,e,v,O,m);d=(a=b.traceState)!==null&&a!==void 0?a:d;var A=b.decision===rt.RECORD_AND_SAMPLED?j.SAMPLED:j.NONE,C={traceId:f,spanId:l,traceFlags:A,traceState:d};if(b.decision===rt.NOT_RECORD){_.debug("Recording is off, propagating context in a non-recording span");var c=x.wrapSpanContext(C);return c}var I=new As(this,r,e,C,v,h,m,n.startTime),R=$e(Object.assign(O,b.attributes));return I.setAttributes(R),I},t.prototype.startActiveSpan=function(e,n,r,i){var o,a,u;if(!(arguments.length<2)){arguments.length===2?u=n:arguments.length===3?(o=n,u=r):(o=n,a=r,u=i);var c=a??ne.active(),s=this.startSpan(e,o,c),l=x.setSpan(c,s);return ne.with(l,u,void 0,s)}},t.prototype.getGeneralLimits=function(){return this._generalLimits},t.prototype.getSpanLimits=function(){return this._spanLimits},t.prototype.getActiveSpanProcessor=function(){return this._tracerProvider.getActiveSpanProcessor()},t}();function Us(){return"unknown_service"}var H=function(){return H=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},H.apply(this,arguments)},ks=function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(l){try{s(r.next(l))}catch(f){a(f)}}function c(l){try{s(r.throw(l))}catch(f){a(f)}}function s(l){l.done?o(l.value):i(l.value).then(u,c)}s((r=r.apply(t,e||[])).next())})},Bs=function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(s){return function(l){return c([s,l])}}function c(s){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=s[0]&2?i.return:s[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;switch(i=0,o&&(s=[s[0]&2,o.value]),s[0]){case 0:case 1:o=s;break;case 4:return n.label++,{value:s[1],done:!1};case 5:n.label++,i=s[1],s=[0];continue;case 7:s=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){n.label=s[1];break}if(s[0]===6&&n.label<o[1]){n.label=o[1],o=s;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(s);break}o[2]&&n.ops.pop(),n.trys.pop();continue}s=e.call(t,n)}catch(l){s=[6,l],i=0}finally{r=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Gs=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},Xn=function(){function t(e,n){var r=this,i;this._attributes=e,this.asyncAttributesPending=n!=null,this._syncAttributes=(i=this._attributes)!==null&&i!==void 0?i:{},this._asyncAttributesPromise=n==null?void 0:n.then(function(o){return r._attributes=Object.assign({},r._attributes,o),r.asyncAttributesPending=!1,o},function(o){return _.debug("a resource's async attributes promise rejected: %s",o),r.asyncAttributesPending=!1,{}})}return t.empty=function(){return t.EMPTY},t.default=function(){var e;return new t((e={},e[P.SERVICE_NAME]=Us(),e[P.TELEMETRY_SDK_LANGUAGE]=bt[P.TELEMETRY_SDK_LANGUAGE],e[P.TELEMETRY_SDK_NAME]=bt[P.TELEMETRY_SDK_NAME],e[P.TELEMETRY_SDK_VERSION]=bt[P.TELEMETRY_SDK_VERSION],e))},Object.defineProperty(t.prototype,"attributes",{get:function(){var e;return this.asyncAttributesPending&&_.error("Accessing resource attributes before async attributes settled"),(e=this._attributes)!==null&&e!==void 0?e:{}},enumerable:!1,configurable:!0}),t.prototype.waitForAsyncAttributes=function(){return ks(this,void 0,void 0,function(){return Bs(this,function(e){switch(e.label){case 0:return this.asyncAttributesPending?[4,this._asyncAttributesPromise]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.merge=function(e){var n=this,r;if(!e)return this;var i=H(H({},this._syncAttributes),(r=e._syncAttributes)!==null&&r!==void 0?r:e.attributes);if(!this._asyncAttributesPromise&&!e._asyncAttributesPromise)return new t(i);var o=Promise.all([this._asyncAttributesPromise,e._asyncAttributesPromise]).then(function(a){var u,c=Gs(a,2),s=c[0],l=c[1];return H(H(H(H({},n._syncAttributes),s),(u=e._syncAttributes)!==null&&u!==void 0?u:e.attributes),l)});return new t(i,o)},t.EMPTY=new t({}),t}(),Xe=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Vs=function(){function t(e){this._spanProcessors=e}return t.prototype.forceFlush=function(){var e,n,r=[];try{for(var i=Xe(this._spanProcessors),o=i.next();!o.done;o=i.next()){var a=o.value;r.push(a.forceFlush())}}catch(u){e={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return new Promise(function(u){Promise.all(r).then(function(){u()}).catch(function(c){ot(c||new Error("MultiSpanProcessor: forceFlush failed")),u()})})},t.prototype.onStart=function(e,n){var r,i;try{for(var o=Xe(this._spanProcessors),a=o.next();!a.done;a=o.next()){var u=a.value;u.onStart(e,n)}}catch(c){r={error:c}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}},t.prototype.onEnd=function(e){var n,r;try{for(var i=Xe(this._spanProcessors),o=i.next();!o.done;o=i.next()){var a=o.value;a.onEnd(e)}}catch(u){n={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype.shutdown=function(){var e,n,r=[];try{for(var i=Xe(this._spanProcessors),o=i.next();!o.done;o=i.next()){var a=o.value;r.push(a.shutdown())}}catch(u){e={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return new Promise(function(u,c){Promise.all(r).then(function(){u()},c)})},t}(),js=function(){function t(){}return t.prototype.onStart=function(e,n){},t.prototype.onEnd=function(e){},t.prototype.shutdown=function(){return Promise.resolve()},t.prototype.forceFlush=function(){return Promise.resolve()},t}(),Q;(function(t){t[t.resolved=0]="resolved",t[t.timeout=1]="timeout",t[t.error=2]="error",t[t.unresolved=3]="unresolved"})(Q||(Q={}));var Fs=function(){function t(e){e===void 0&&(e={});var n;this._registeredSpanProcessors=[],this._tracers=new Map;var r=vs({},kr(),Is(e));this.resource=(n=r.resource)!==null&&n!==void 0?n:Xn.empty(),this.resource=Xn.default().merge(this.resource),this._config=Object.assign({},r,{resource:this.resource});var i=this._buildExporterFromEnv();if(i!==void 0){var o=new Gr(i);this.activeSpanProcessor=o}else this.activeSpanProcessor=new js}return t.prototype.getTracer=function(e,n,r){var i=e+"@"+(n||"")+":"+((r==null?void 0:r.schemaUrl)||"");return this._tracers.has(i)||this._tracers.set(i,new xs({name:e,version:n,schemaUrl:r==null?void 0:r.schemaUrl},this._config,this)),this._tracers.get(i)},t.prototype.addSpanProcessor=function(e){this._registeredSpanProcessors.length===0&&this.activeSpanProcessor.shutdown().catch(function(n){return _.error("Error while trying to shutdown current span processor",n)}),this._registeredSpanProcessors.push(e),this.activeSpanProcessor=new Vs(this._registeredSpanProcessors)},t.prototype.getActiveSpanProcessor=function(){return this.activeSpanProcessor},t.prototype.register=function(e){e===void 0&&(e={}),x.setGlobalTracerProvider(this),e.propagator===void 0&&(e.propagator=this._buildPropagatorFromEnv()),e.contextManager&&ne.setGlobalContextManager(e.contextManager),e.propagator&&qe.setGlobalPropagator(e.propagator)},t.prototype.forceFlush=function(){var e=this._config.forceFlushTimeoutMillis,n=this._registeredSpanProcessors.map(function(r){return new Promise(function(i){var o,a=setTimeout(function(){i(new Error("Span processor did not completed within timeout period of "+e+" ms")),o=Q.timeout},e);r.forceFlush().then(function(){clearTimeout(a),o!==Q.timeout&&(o=Q.resolved,i(o))}).catch(function(u){clearTimeout(a),o=Q.error,i(u)})})});return new Promise(function(r,i){Promise.all(n).then(function(o){var a=o.filter(function(u){return u!==Q.resolved});a.length>0?i(a):r()}).catch(function(o){return i([o])})})},t.prototype.shutdown=function(){return this.activeSpanProcessor.shutdown()},t.prototype._getPropagator=function(e){var n;return(n=this.constructor._registeredPropagators.get(e))===null||n===void 0?void 0:n()},t.prototype._getSpanExporter=function(e){var n;return(n=this.constructor._registeredExporters.get(e))===null||n===void 0?void 0:n()},t.prototype._buildPropagatorFromEnv=function(){var e=this,n=Array.from(new Set(M().OTEL_PROPAGATORS)),r=n.map(function(o){var a=e._getPropagator(o);return a||_.warn('Propagator "'+o+'" requested through environment variable is unavailable.'),a}),i=r.reduce(function(o,a){return a&&o.push(a),o},[]);if(i.length!==0)return n.length===1?i[0]:new Va({propagators:i})},t.prototype._buildExporterFromEnv=function(){var e=M().OTEL_TRACES_EXPORTER;if(!(e==="none"||e==="")){var n=this._getSpanExporter(e);return n||_.error('Exporter "'+e+'" requested through environment variable is unavailable.'),n}},t._registeredPropagators=new Map([["tracecontext",function(){return new rs}],["baggage",function(){return new la}]]),t._registeredExporters=new Map,t}(),Hs=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},Xs=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))},Ks=function(){function t(){this._enabled=!1,this._currentContext=$}return t.prototype._bindFunction=function(e,n){e===void 0&&(e=$);var r=this,i=function(){for(var o=this,a=[],u=0;u<arguments.length;u++)a[u]=arguments[u];return r.with(e,function(){return n.apply(o,a)})};return Object.defineProperty(i,"length",{enumerable:!1,configurable:!0,writable:!1,value:n.length}),i},t.prototype.active=function(){return this._currentContext},t.prototype.bind=function(e,n){return e===void 0&&(e=this.active()),typeof n=="function"?this._bindFunction(e,n):n},t.prototype.disable=function(){return this._currentContext=$,this._enabled=!1,this},t.prototype.enable=function(){return this._enabled?this:(this._enabled=!0,this._currentContext=$,this)},t.prototype.with=function(e,n,r){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var a=this._currentContext;this._currentContext=e||$;try{return n.call.apply(n,Xs([r],Hs(i),!1))}finally{this._currentContext=a}},t}(),Ws=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ys=function(t){Ws(e,t);function e(n){n===void 0&&(n={});var r=t.call(this,n)||this;if(n.contextManager)throw"contextManager should be defined in register method not in constructor";if(n.propagator)throw"propagator should be defined in register method not in constructor";return r}return e.prototype.register=function(n){n===void 0&&(n={}),n.contextManager===void 0&&(n.contextManager=new Ks),n.contextManager&&n.contextManager.enable(),t.prototype.register.call(this,n)},e}(Fs),zs=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},Vr=1e4;function qs(t){t===void 0&&(t={});var e={};return Object.entries(t).forEach(function(n){var r=zs(n,2),i=r[0],o=r[1];typeof o<"u"?e[i]=String(o):_.warn('Header "'+i+'" has wrong value and will be ignored')}),e}function $s(t,e){return t.endsWith("/")||(t=t+"/"),t+e}function Js(t,e){return!t.includes(e)&&!t.endsWith("/")&&(t=t+"/"),t}function Qs(t){return typeof t=="number"?t<=0?jr(t,Vr):t:Zs()}function Zs(){var t,e=Number((t=X().OTEL_EXPORTER_OTLP_TRACES_TIMEOUT)!==null&&t!==void 0?t:X().OTEL_EXPORTER_OTLP_TIMEOUT);return e<=0?jr(e,Vr):e}function jr(t,e){return _.warn("Timeout must be greater than 0",t),e}var eu=function(){function t(e){e===void 0&&(e={}),this._sendingPromises=[],this.url=this.getDefaultUrl(e),typeof e.hostname=="string"&&(this.hostname=e.hostname),this.shutdown=this.shutdown.bind(this),this._shutdownOnce=new Jo(this._shutdown,this),this._concurrencyLimit=typeof e.concurrencyLimit=="number"?e.concurrencyLimit:1/0,this.timeoutMillis=Qs(e.timeoutMillis),this.onInit(e)}return t.prototype.export=function(e,n){if(this._shutdownOnce.isCalled){n({code:Z.FAILED,error:new Error("Exporter has been shutdown")});return}if(this._sendingPromises.length>=this._concurrencyLimit){n({code:Z.FAILED,error:new Error("Concurrent export limit reached")});return}this._export(e).then(function(){n({code:Z.SUCCESS})}).catch(function(r){n({code:Z.FAILED,error:r})})},t.prototype._export=function(e){var n=this;return new Promise(function(r,i){try{_.debug("items to be sent",e),n.send(e,r,i)}catch(o){i(o)}})},t.prototype.shutdown=function(){return this._shutdownOnce.call()},t.prototype._shutdown=function(){return _.debug("shutdown started"),this.onShutdown(),Promise.all(this._sendingPromises).then(function(){})},t}(),tu=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Jt=function(t){tu(e,t);function e(n,r,i){var o=t.call(this,n)||this;return o.name="OTLPExporterError",o.data=i,o.code=r,o}return e}(Error),ut=function(){return ut=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},ut.apply(this,arguments)},nu=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o};function ru(t,e,n,r,i){if(navigator.sendBeacon(e,new Blob([t],n)))_.debug("sendBeacon - can send",t),r();else{var o=new Jt("sendBeacon - cannot send "+t);i(o)}}function iu(t,e,n,r,i,o){var a,u=setTimeout(function(){a=!0,c.abort()},r),c=new XMLHttpRequest;c.open("POST",e);var s={Accept:"application/json","Content-Type":"application/json"};Object.entries(ut(ut({},s),n)).forEach(function(l){var f=nu(l,2),d=f[0],h=f[1];c.setRequestHeader(d,h)}),c.send(t),c.onreadystatechange=function(){if(c.readyState===XMLHttpRequest.DONE)if(c.status>=200&&c.status<=299)clearTimeout(u),_.debug("xhr success",t),i();else if(a){var l=new Jt("Request Timeout",c.status);o(l)}else{var l=new Jt("Failed to export with XHR (status: "+c.status+")",c.status);clearTimeout(u),o(l)}}}var ou=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),au=function(t){ou(e,t);function e(n){n===void 0&&(n={});var r=t.call(this,n)||this;return r._useXHR=!1,r._useXHR=!!n.headers||typeof navigator.sendBeacon!="function",r._useXHR?r._headers=Object.assign({},qs(n.headers),gr(X().OTEL_EXPORTER_OTLP_HEADERS)):r._headers={},r}return e.prototype.onInit=function(){window.addEventListener("unload",this.shutdown)},e.prototype.onShutdown=function(){window.removeEventListener("unload",this.shutdown)},e.prototype.send=function(n,r,i){var o=this;if(this._shutdownOnce.isCalled){_.debug("Shutdown already started. Cannot send objects");return}var a=this.convert(n),u=JSON.stringify(a),c=new Promise(function(l,f){o._useXHR?iu(u,o.url,o._headers,o.timeoutMillis,l,f):ru(u,o.url,{type:"application/json"},l,f)}).then(r,i);this._sendingPromises.push(c);var s=function(){var l=o._sendingPromises.indexOf(c);o._sendingPromises.splice(l,1)};c.then(s,s)},e}(eu),Kn;(function(t){t[t.SPAN_KIND_UNSPECIFIED=0]="SPAN_KIND_UNSPECIFIED",t[t.SPAN_KIND_INTERNAL=1]="SPAN_KIND_INTERNAL",t[t.SPAN_KIND_SERVER=2]="SPAN_KIND_SERVER",t[t.SPAN_KIND_CLIENT=3]="SPAN_KIND_CLIENT",t[t.SPAN_KIND_PRODUCER=4]="SPAN_KIND_PRODUCER",t[t.SPAN_KIND_CONSUMER=5]="SPAN_KIND_CONSUMER"})(Kn||(Kn={}));var su=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o};function pt(t){return Object.keys(t).map(function(e){return Fr(e,t[e])})}function Fr(t,e){return{key:t,value:Hr(e)}}function Hr(t){var e=typeof t;return e==="string"?{stringValue:t}:e==="number"?Number.isInteger(t)?{intValue:t}:{doubleValue:t}:e==="boolean"?{boolValue:t}:t instanceof Uint8Array?{bytesValue:t}:Array.isArray(t)?{arrayValue:{values:t.map(Hr)}}:e==="object"&&t!=null?{kvlistValue:{values:Object.entries(t).map(function(n){var r=su(n,2),i=r[0],o=r[1];return Fr(i,o)})}}:{}}function uu(t,e){var n=t.spanContext(),r=t.status,i=e?t.parentSpanId:t.parentSpanId!=null?Ie(t.parentSpanId):void 0;return{traceId:e?n.traceId:Ie(n.traceId),spanId:e?n.spanId:Ie(n.spanId),parentSpanId:i,name:t.name,kind:t.kind==null?0:t.kind+1,startTimeUnixNano:Xt(t.startTime),endTimeUnixNano:Xt(t.endTime),attributes:pt(t.attributes),droppedAttributesCount:0,events:t.events.map(lu),droppedEventsCount:0,status:{code:r.code,message:r.message},links:t.links.map(function(o){return cu(o,e)}),droppedLinksCount:0}}function cu(t,e){return{attributes:t.attributes?pt(t.attributes):[],spanId:e?t.context.spanId:Ie(t.context.spanId),traceId:e?t.context.traceId:Ie(t.context.traceId),droppedAttributesCount:0}}function lu(t){return{attributes:t.attributes?pt(t.attributes):[],name:t.name,timeUnixNano:Xt(t.time),droppedAttributesCount:0}}var fu=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},du=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o};function _u(t,e){return{resourceSpans:pu(t,e)}}function hu(t){var e,n,r=new Map;try{for(var i=fu(t),o=i.next();!o.done;o=i.next()){var a=o.value,u=r.get(a.resource);u||(u=new Map,r.set(a.resource,u));var c=a.instrumentationLibrary.name+"@"+(a.instrumentationLibrary.version||"")+":"+(a.instrumentationLibrary.schemaUrl||""),s=u.get(c);s||(s=[],u.set(c,s)),s.push(a)}}catch(l){e={error:l}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function pu(t,e){for(var n=hu(t),r=[],i=n.entries(),o=i.next();!o.done;){for(var a=du(o.value,2),u=a[0],c=a[1],s=[],l=c.values(),f=l.next();!f.done;){var d=f.value;if(d.length>0){var h=d[0].instrumentationLibrary,v=h.name,m=h.version,O=h.schemaUrl,b=d.map(function(C){return uu(C,e)});s.push({scope:{name:v,version:m},spans:b,schemaUrl:O})}f=l.next()}var A={resource:{attributes:pt(u.attributes),droppedAttributesCount:0},scopeSpans:s,schemaUrl:void 0};r.push(A),o=i.next()}return r}var ve=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),vu=function(){function t(){}return t.prototype.createHistogram=function(e,n){return Au},t.prototype.createCounter=function(e,n){return bu},t.prototype.createUpDownCounter=function(e,n){return Ru},t.prototype.createObservableGauge=function(e,n){return wu},t.prototype.createObservableCounter=function(e,n){return Cu},t.prototype.createObservableUpDownCounter=function(e,n){return Iu},t.prototype.addBatchObservableCallback=function(e,n){},t.prototype.removeBatchObservableCallback=function(e){},t}(),cn=function(){function t(){}return t}(),Eu=function(t){ve(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.add=function(n,r){},e}(cn),gu=function(t){ve(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.add=function(n,r){},e}(cn),mu=function(t){ve(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.record=function(n,r){},e}(cn),ln=function(){function t(){}return t.prototype.addCallback=function(e){},t.prototype.removeCallback=function(e){},t}(),yu=function(t){ve(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(ln),Tu=function(t){ve(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(ln),Su=function(t){ve(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(ln),Ou=new vu,bu=new Eu,Au=new mu,Ru=new gu,Cu=new yu,wu=new Tu,Iu=new Su,ct;(function(t){t[t.INT=0]="INT",t[t.DOUBLE=1]="DOUBLE"})(ct||(ct={}));var Nu=function(){function t(){}return t.prototype.getMeter=function(e,n,r){return Ou},t}(),Wn=new Nu,Mu=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},Ke=Symbol.for("io.opentelemetry.js.api.metrics"),Te=Mu;function Pu(t,e,n){return function(r){return r===t?e:n}}var Yn=4,Lu=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalMeterProvider=function(e){return Te[Ke]?this.getMeterProvider():(Te[Ke]=Pu(Yn,e,Wn),e)},t.prototype.getMeterProvider=function(){var e,n;return(n=(e=Te[Ke])===null||e===void 0?void 0:e.call(Te,Yn))!==null&&n!==void 0?n:Wn},t.prototype.getMeter=function(e,n,r){return this.getMeterProvider().getMeter(e,n,r)},t.prototype.disable=function(){delete Te[Ke]},t}();Lu.getInstance();var lt;(function(t){t[t.DELTA=0]="DELTA",t[t.CUMULATIVE=1]="CUMULATIVE"})(lt||(lt={}));var xe;(function(t){t[t.HISTOGRAM=0]="HISTOGRAM",t[t.EXPONENTIAL_HISTOGRAM=1]="EXPONENTIAL_HISTOGRAM",t[t.GAUGE=2]="GAUGE",t[t.SUM=3]="SUM"})(xe||(xe={}));var Du=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();function xu(t){var e=Object.keys(t);return e.length===0?"":(e=e.sort(),JSON.stringify(e.map(function(n){return[n,t[n]]})))}var Xr=function(t){Du(e,t);function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return e}(Error);function Qt(t,e){var n,r=new Promise(function(o,a){n=setTimeout(function(){a(new Xr("Operation timed out."))},e)});return Promise.race([t,r]).then(function(i){return clearTimeout(n),i},function(i){throw clearTimeout(n),i})}var he;(function(t){t[t.DROP=0]="DROP",t[t.SUM=1]="SUM",t[t.LAST_VALUE=2]="LAST_VALUE",t[t.HISTOGRAM=3]="HISTOGRAM"})(he||(he={}));var Uu=function(){function t(){this.kind=he.DROP}return t.prototype.createAccumulation=function(){},t.prototype.merge=function(e,n){},t.prototype.diff=function(e,n){},t.prototype.toMetricData=function(e,n,r,i){},t}(),w;(function(t){t.COUNTER="COUNTER",t.HISTOGRAM="HISTOGRAM",t.UP_DOWN_COUNTER="UP_DOWN_COUNTER",t.OBSERVABLE_COUNTER="OBSERVABLE_COUNTER",t.OBSERVABLE_GAUGE="OBSERVABLE_GAUGE",t.OBSERVABLE_UP_DOWN_COUNTER="OBSERVABLE_UP_DOWN_COUNTER"})(w||(w={}));function ku(t,e,n){var r,i,o;return{name:t,type:e,description:(r=n==null?void 0:n.description)!==null&&r!==void 0?r:"",unit:(i=n==null?void 0:n.unit)!==null&&i!==void 0?i:"",valueType:(o=n==null?void 0:n.valueType)!==null&&o!==void 0?o:ct.DOUBLE}}var Bu=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o};function Gu(t){var e=t.map(function(){return 0});return e.push(0),{buckets:{boundaries:t,counts:e},sum:0,count:0,hasMinMax:!1,min:1/0,max:-1/0}}var It=function(){function t(e,n,r,i){r===void 0&&(r=!0),i===void 0&&(i=Gu(n)),this.startTime=e,this._boundaries=n,this._recordMinMax=r,this._current=i}return t.prototype.record=function(e){this._current.count+=1,this._current.sum+=e,this._recordMinMax&&(this._current.min=Math.min(e,this._current.min),this._current.max=Math.max(e,this._current.max),this._current.hasMinMax=!0);for(var n=0;n<this._boundaries.length;n++)if(e<this._boundaries[n]){this._current.buckets.counts[n]+=1;return}this._current.buckets.counts[this._boundaries.length]+=1},t.prototype.setStartTime=function(e){this.startTime=e},t.prototype.toPointValue=function(){return this._current},t}(),Kr=function(){function t(e,n){this._boundaries=e,this._recordMinMax=n,this.kind=he.HISTOGRAM}return t.prototype.createAccumulation=function(e){return new It(e,this._boundaries,this._recordMinMax)},t.prototype.merge=function(e,n){for(var r=e.toPointValue(),i=n.toPointValue(),o=r.buckets.counts,a=i.buckets.counts,u=new Array(o.length),c=0;c<o.length;c++)u[c]=o[c]+a[c];var s=1/0,l=-1/0;return this._recordMinMax&&(r.hasMinMax&&i.hasMinMax?(s=Math.min(r.min,i.min),l=Math.max(r.max,i.max)):r.hasMinMax?(s=r.min,l=r.max):i.hasMinMax&&(s=i.min,l=i.max)),new It(e.startTime,r.buckets.boundaries,this._recordMinMax,{buckets:{boundaries:r.buckets.boundaries,counts:u},count:r.count+i.count,sum:r.sum+i.sum,hasMinMax:this._recordMinMax&&(r.hasMinMax||i.hasMinMax),min:s,max:l})},t.prototype.diff=function(e,n){for(var r=e.toPointValue(),i=n.toPointValue(),o=r.buckets.counts,a=i.buckets.counts,u=new Array(o.length),c=0;c<o.length;c++)u[c]=a[c]-o[c];return new It(n.startTime,r.buckets.boundaries,this._recordMinMax,{buckets:{boundaries:r.buckets.boundaries,counts:u},count:i.count-r.count,sum:i.sum-r.sum,hasMinMax:!1,min:1/0,max:-1/0})},t.prototype.toMetricData=function(e,n,r,i){return{descriptor:e,aggregationTemporality:n,dataPointType:xe.HISTOGRAM,dataPoints:r.map(function(o){var a=Bu(o,2),u=a[0],c=a[1],s=c.toPointValue(),l=e.type===w.UP_DOWN_COUNTER||e.type===w.OBSERVABLE_GAUGE||e.type===w.OBSERVABLE_UP_DOWN_COUNTER;return{attributes:u,startTime:c.startTime,endTime:i,value:{min:s.hasMinMax?s.min:void 0,max:s.hasMinMax?s.max:void 0,sum:l?void 0:s.sum,buckets:s.buckets,count:s.count}}})}},t}(),Vu=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},Nt=function(){function t(e,n,r){n===void 0&&(n=0),r===void 0&&(r=[0,0]),this.startTime=e,this._current=n,this.sampleTime=r}return t.prototype.record=function(e){this._current=e,this.sampleTime=Tr()},t.prototype.setStartTime=function(e){this.startTime=e},t.prototype.toPointValue=function(){return this._current},t}(),ju=function(){function t(){this.kind=he.LAST_VALUE}return t.prototype.createAccumulation=function(e){return new Nt(e)},t.prototype.merge=function(e,n){var r=Fe(n.sampleTime)>=Fe(e.sampleTime)?n:e;return new Nt(e.startTime,r.toPointValue(),r.sampleTime)},t.prototype.diff=function(e,n){var r=Fe(n.sampleTime)>=Fe(e.sampleTime)?n:e;return new Nt(n.startTime,r.toPointValue(),r.sampleTime)},t.prototype.toMetricData=function(e,n,r,i){return{descriptor:e,aggregationTemporality:n,dataPointType:xe.GAUGE,dataPoints:r.map(function(o){var a=Vu(o,2),u=a[0],c=a[1];return{attributes:u,startTime:c.startTime,endTime:i,value:c.toPointValue()}})}},t}(),Fu=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},Se=function(){function t(e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1),this.startTime=e,this.monotonic=n,this._current=r,this.reset=i}return t.prototype.record=function(e){this.monotonic&&e<0||(this._current+=e)},t.prototype.setStartTime=function(e){this.startTime=e},t.prototype.toPointValue=function(){return this._current},t}(),zn=function(){function t(e){this.monotonic=e,this.kind=he.SUM}return t.prototype.createAccumulation=function(e){return new Se(e,this.monotonic)},t.prototype.merge=function(e,n){var r=e.toPointValue(),i=n.toPointValue();return n.reset?new Se(n.startTime,this.monotonic,i,n.reset):new Se(e.startTime,this.monotonic,r+i)},t.prototype.diff=function(e,n){var r=e.toPointValue(),i=n.toPointValue();return this.monotonic&&r>i?new Se(n.startTime,this.monotonic,i,!0):new Se(n.startTime,this.monotonic,i-r)},t.prototype.toMetricData=function(e,n,r,i){return{descriptor:e,aggregationTemporality:n,dataPointType:xe.SUM,dataPoints:r.map(function(o){var a=Fu(o,2),u=a[0],c=a[1];return{attributes:u,startTime:c.startTime,endTime:i,value:c.toPointValue()}}),isMonotonic:this.monotonic}},t}(),Ee=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),re=function(){function t(){}return t.Drop=function(){return Wr},t.Sum=function(){return Yr},t.LastValue=function(){return zr},t.Histogram=function(){return qr},t.Default=function(){return zu},t}(),Hu=function(t){Ee(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.createAggregator=function(n){return e.DEFAULT_INSTANCE},e.DEFAULT_INSTANCE=new Uu,e}(re),Xu=function(t){Ee(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.createAggregator=function(n){switch(n.type){case w.COUNTER:case w.OBSERVABLE_COUNTER:case w.HISTOGRAM:return e.MONOTONIC_INSTANCE;default:return e.NON_MONOTONIC_INSTANCE}},e.MONOTONIC_INSTANCE=new zn(!0),e.NON_MONOTONIC_INSTANCE=new zn(!1),e}(re),Ku=function(t){Ee(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.createAggregator=function(n){return e.DEFAULT_INSTANCE},e.DEFAULT_INSTANCE=new ju,e}(re),Wu=function(t){Ee(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.createAggregator=function(n){return e.DEFAULT_INSTANCE},e.DEFAULT_INSTANCE=new Kr([0,5,10,25,50,75,100,250,500,1e3],!0),e}(re);(function(t){Ee(e,t);function e(n,r){r===void 0&&(r=!0);var i=t.call(this)||this;if(i._recordMinMax=r,n===void 0||n.length===0)throw new Error("HistogramAggregator should be created with boundaries.");n=n.concat(),n=n.sort(function(u,c){return u-c});var o=n.lastIndexOf(-1/0),a=n.indexOf(1/0);return a===-1&&(a=void 0),i._boundaries=n.slice(o+1,a),i}return e.prototype.createAggregator=function(n){return new Kr(this._boundaries,this._recordMinMax)},e})(re);var Yu=function(t){Ee(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype._resolve=function(n){switch(n.type){case w.COUNTER:case w.UP_DOWN_COUNTER:case w.OBSERVABLE_COUNTER:case w.OBSERVABLE_UP_DOWN_COUNTER:return Yr;case w.OBSERVABLE_GAUGE:return zr;case w.HISTOGRAM:return qr}return _.warn("Unable to recognize instrument type: "+n.type),Wr},e.prototype.createAggregator=function(n){return this._resolve(n).createAggregator(n)},e}(re),Wr=new Hu,Yr=new Xu,zr=new Ku,qr=new Wu,zu=new Yu,qu=function(t){return re.Default()},$u=function(t){return lt.CUMULATIVE},Mt=function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(l){try{s(r.next(l))}catch(f){a(f)}}function c(l){try{s(r.throw(l))}catch(f){a(f)}}function s(l){l.done?o(l.value):i(l.value).then(u,c)}s((r=r.apply(t,e||[])).next())})},Pt=function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(s){return function(l){return c([s,l])}}function c(s){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=s[0]&2?i.return:s[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;switch(i=0,o&&(s=[s[0]&2,o.value]),s[0]){case 0:case 1:o=s;break;case 4:return n.label++,{value:s[1],done:!1};case 5:n.label++,i=s[1],s=[0];continue;case 7:s=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){n.label=s[1];break}if(s[0]===6&&n.label<o[1]){n.label=o[1],o=s;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(s);break}o[2]&&n.ops.pop(),n.trys.pop();continue}s=e.call(t,n)}catch(l){s=[6,l],i=0}finally{r=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Ju=function(){function t(e){var n,r;this._shutdown=!1,this._aggregationSelector=(n=e==null?void 0:e.aggregationSelector)!==null&&n!==void 0?n:qu,this._aggregationTemporalitySelector=(r=e==null?void 0:e.aggregationTemporalitySelector)!==null&&r!==void 0?r:$u}return t.prototype.setMetricProducer=function(e){if(this._metricProducer)throw new Error("MetricReader can not be bound to a MeterProvider again.");this._metricProducer=e,this.onInitialized()},t.prototype.selectAggregation=function(e){return this._aggregationSelector(e)},t.prototype.selectAggregationTemporality=function(e){return this._aggregationTemporalitySelector(e)},t.prototype.onInitialized=function(){},t.prototype.collect=function(e){return Mt(this,void 0,void 0,function(){return Pt(this,function(n){if(this._metricProducer===void 0)throw new Error("MetricReader is not bound to a MetricProducer");if(this._shutdown)throw new Error("MetricReader is shutdown");return[2,this._metricProducer.collect({timeoutMillis:e==null?void 0:e.timeoutMillis})]})})},t.prototype.shutdown=function(e){return Mt(this,void 0,void 0,function(){return Pt(this,function(n){switch(n.label){case 0:return this._shutdown?(_.error("Cannot call shutdown twice."),[2]):(e==null?void 0:e.timeoutMillis)!=null?[3,2]:[4,this.onShutdown()];case 1:return n.sent(),[3,4];case 2:return[4,Qt(this.onShutdown(),e.timeoutMillis)];case 3:n.sent(),n.label=4;case 4:return this._shutdown=!0,[2]}})})},t.prototype.forceFlush=function(e){return Mt(this,void 0,void 0,function(){return Pt(this,function(n){switch(n.label){case 0:return this._shutdown?(_.warn("Cannot forceFlush on already shutdown MetricReader."),[2]):(e==null?void 0:e.timeoutMillis)!=null?[3,2]:[4,this.onForceFlush()];case 1:return n.sent(),[2];case 2:return[4,Qt(this.onForceFlush(),e.timeoutMillis)];case 3:return n.sent(),[2]}})})},t}(),Qu=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),We=function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function u(l){try{s(r.next(l))}catch(f){a(f)}}function c(l){try{s(r.throw(l))}catch(f){a(f)}}function s(l){l.done?o(l.value):i(l.value).then(u,c)}s((r=r.apply(t,e||[])).next())})},Ye=function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(s){return function(l){return c([s,l])}}function c(s){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=s[0]&2?i.return:s[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;switch(i=0,o&&(s=[s[0]&2,o.value]),s[0]){case 0:case 1:o=s;break;case 4:return n.label++,{value:s[1],done:!1};case 5:n.label++,i=s[1],s=[0];continue;case 7:s=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){n.label=s[1];break}if(s[0]===6&&n.label<o[1]){n.label=o[1],o=s;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(s);break}o[2]&&n.ops.pop(),n.trys.pop();continue}s=e.call(t,n)}catch(l){s=[6,l],i=0}finally{r=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},Zu=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},ec=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))};(function(t){Qu(e,t);function e(n){var r,i,o,a,u=t.call(this,{aggregationSelector:(r=n.exporter.selectAggregation)===null||r===void 0?void 0:r.bind(n.exporter),aggregationTemporalitySelector:(i=n.exporter.selectAggregationTemporality)===null||i===void 0?void 0:i.bind(n.exporter)})||this;if(n.exportIntervalMillis!==void 0&&n.exportIntervalMillis<=0)throw Error("exportIntervalMillis must be greater than 0");if(n.exportTimeoutMillis!==void 0&&n.exportTimeoutMillis<=0)throw Error("exportTimeoutMillis must be greater than 0");if(n.exportTimeoutMillis!==void 0&&n.exportIntervalMillis!==void 0&&n.exportIntervalMillis<n.exportTimeoutMillis)throw Error("exportIntervalMillis must be greater than or equal to exportTimeoutMillis");return u._exportInterval=(o=n.exportIntervalMillis)!==null&&o!==void 0?o:6e4,u._exportTimeout=(a=n.exportTimeoutMillis)!==null&&a!==void 0?a:3e4,u._exporter=n.exporter,u}return e.prototype._runOnce=function(){return We(this,void 0,void 0,function(){var n,r,i,o,a=this;return Ye(this,function(u){switch(u.label){case 0:return[4,this.collect({})];case 1:return n=u.sent(),r=n.resourceMetrics,i=n.errors,i.length>0&&(o=_).error.apply(o,ec(["PeriodicExportingMetricReader: metrics collection errors"],Zu(i),!1)),[2,new Promise(function(c,s){a._exporter.export(r,function(l){var f;l.code!==Z.SUCCESS?s((f=l.error)!==null&&f!==void 0?f:new Error("PeriodicExportingMetricReader: metrics export failed (error "+l.error+")")):c()})})]}})})},e.prototype.onInitialized=function(){var n=this;this._interval=setInterval(function(){return We(n,void 0,void 0,function(){var r;return Ye(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,Qt(this._runOnce(),this._exportTimeout)];case 1:return i.sent(),[3,3];case 2:return r=i.sent(),r instanceof Xr?(_.error("Export took longer than %s milliseconds and timed out.",this._exportTimeout),[2]):(Mo(r),[3,3]);case 3:return[2]}})})},this._exportInterval),this._interval},e.prototype.onForceFlush=function(){return We(this,void 0,void 0,function(){return Ye(this,function(n){switch(n.label){case 0:return[4,this._exporter.forceFlush()];case 1:return n.sent(),[2]}})})},e.prototype.onShutdown=function(){return We(this,void 0,void 0,function(){return Ye(this,function(n){switch(n.label){case 0:return this._interval&&clearInterval(this._interval),[4,this._exporter.shutdown()];case 1:return n.sent(),[2]}})})},e})(Ju);var ge=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),fn=function(){function t(e,n){this._writableMetricStorage=e,this._descriptor=n}return t.prototype._record=function(e,n,r){n===void 0&&(n={}),r===void 0&&(r=ne.active()),this._descriptor.valueType===ct.INT&&!Number.isInteger(e)&&(_.warn("INT value type cannot accept a floating-point value for "+this._descriptor.name+", ignoring the fractional digits."),e=Math.trunc(e)),this._writableMetricStorage.record(e,n,r,Tr())},t}();(function(t){ge(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.add=function(n,r,i){this._record(n,r,i)},e})(fn);(function(t){ge(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.add=function(n,r,i){if(n<0){_.warn("negative value provided to counter "+this._descriptor.name+": "+n);return}this._record(n,r,i)},e})(fn);(function(t){ge(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.record=function(n,r,i){if(n<0){_.warn("negative value provided to histogram "+this._descriptor.name+": "+n);return}this._record(n,r,i)},e})(fn);var dn=function(){function t(e,n,r){this._observableRegistry=r,this._descriptor=e,this._metricStorages=n}return t.prototype.addCallback=function(e){this._observableRegistry.addCallback(e,this)},t.prototype.removeCallback=function(e){this._observableRegistry.removeCallback(e,this)},t}();(function(t){ge(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e})(dn);(function(t){ge(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e})(dn);(function(t){ge(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e})(dn);var $r=function(){function t(e){this._instrumentDescriptor=e}return t.prototype.getInstrumentDescriptor=function(){return this._instrumentDescriptor},t.prototype.updateDescription=function(e){this._instrumentDescriptor=ku(this._instrumentDescriptor.name,this._instrumentDescriptor.type,{description:e,valueType:this._instrumentDescriptor.valueType,unit:this._instrumentDescriptor.unit})},t}(),tc=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),qn=function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(s){return function(l){return c([s,l])}}function c(s){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=s[0]&2?i.return:s[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;switch(i=0,o&&(s=[s[0]&2,o.value]),s[0]){case 0:case 1:o=s;break;case 4:return n.label++,{value:s[1],done:!1};case 5:n.label++,i=s[1],s=[0];continue;case 7:s=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){n.label=s[1];break}if(s[0]===6&&n.label<o[1]){n.label=o[1],o=s;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(s);break}o[2]&&n.ops.pop(),n.trys.pop();continue}s=e.call(t,n)}catch(l){s=[6,l],i=0}finally{r=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},nc=function(){function t(e){this._hash=e,this._valueMap=new Map,this._keyMap=new Map}return t.prototype.get=function(e,n){return n??(n=this._hash(e)),this._valueMap.get(n)},t.prototype.getOrDefault=function(e,n){var r=this._hash(e);if(this._valueMap.has(r))return this._valueMap.get(r);var i=n();return this._keyMap.has(r)||this._keyMap.set(r,e),this._valueMap.set(r,i),i},t.prototype.set=function(e,n,r){r??(r=this._hash(e)),this._keyMap.has(r)||this._keyMap.set(r,e),this._valueMap.set(r,n)},t.prototype.has=function(e,n){return n??(n=this._hash(e)),this._valueMap.has(n)},t.prototype.keys=function(){var e,n;return qn(this,function(r){switch(r.label){case 0:e=this._keyMap.entries(),n=e.next(),r.label=1;case 1:return n.done===!0?[3,3]:[4,[n.value[1],n.value[0]]];case 2:return r.sent(),n=e.next(),[3,1];case 3:return[2]}})},t.prototype.entries=function(){var e,n;return qn(this,function(r){switch(r.label){case 0:e=this._valueMap.entries(),n=e.next(),r.label=1;case 1:return n.done===!0?[3,3]:[4,[this._keyMap.get(n.value[0]),n.value[1],n.value[0]]];case 2:return r.sent(),n=e.next(),[3,1];case 3:return[2]}})},Object.defineProperty(t.prototype,"size",{get:function(){return this._valueMap.size},enumerable:!1,configurable:!0}),t}(),Ne=function(t){tc(e,t);function e(){return t.call(this,xu)||this}return e}(nc),rc=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},Jr=function(){function t(e){this._aggregator=e,this._activeCollectionStorage=new Ne,this._cumulativeMemoStorage=new Ne}return t.prototype.record=function(e,n,r,i){var o=this,a=this._activeCollectionStorage.getOrDefault(n,function(){return o._aggregator.createAccumulation(i)});a==null||a.record(e)},t.prototype.batchCumulate=function(e,n){var r=this;Array.from(e.entries()).forEach(function(i){var o=rc(i,3),a=o[0],u=o[1],c=o[2],s=r._aggregator.createAccumulation(n);s==null||s.record(u);var l=s;if(r._cumulativeMemoStorage.has(a,c)){var f=r._cumulativeMemoStorage.get(a,c);l=r._aggregator.diff(f,s)}r._cumulativeMemoStorage.set(a,s,c),r._activeCollectionStorage.set(a,l,c)})},t.prototype.collect=function(){var e=this._activeCollectionStorage;return this._activeCollectionStorage=new Ne,e},t}(),$n=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Jn=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},Qr=function(){function t(e){this._aggregator=e,this._unreportedAccumulations=new Map,this._reportHistory=new Map}return t.prototype.buildMetrics=function(e,n,r,i,o){this._stashAccumulations(n,i);var a=this._getMergedUnreportedAccumulations(e),u=a,c;if(this._reportHistory.has(e)){var s=this._reportHistory.get(e),l=s.collectionTime;c=s.aggregationTemporality,c===lt.CUMULATIVE?u=t.merge(s.accumulations,a,this._aggregator):u=t.calibrateStartTime(s.accumulations,a,l)}else c=e.selectAggregationTemporality(r.type);return this._reportHistory.set(e,{accumulations:u,collectionTime:o,aggregationTemporality:c}),this._aggregator.toMetricData(r,c,ic(u),o)},t.prototype._stashAccumulations=function(e,n){var r=this;e.forEach(function(i){var o=r._unreportedAccumulations.get(i);o===void 0&&(o=[],r._unreportedAccumulations.set(i,o)),o.push(n)})},t.prototype._getMergedUnreportedAccumulations=function(e){var n,r,i=new Ne,o=this._unreportedAccumulations.get(e);if(this._unreportedAccumulations.set(e,[]),o===void 0)return i;try{for(var a=$n(o),u=a.next();!u.done;u=a.next()){var c=u.value;i=t.merge(i,c,this._aggregator)}}catch(s){n={error:s}}finally{try{u&&!u.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return i},t.merge=function(e,n,r){for(var i=e,o=n.entries(),a=o.next();a.done!==!0;){var u=Jn(a.value,3),c=u[0],s=u[1],l=u[2];if(e.has(c,l)){var f=e.get(c,l),d=r.merge(f,s);i.set(c,d,l)}else i.set(c,s,l);a=o.next()}return i},t.calibrateStartTime=function(e,n,r){var i,o;try{for(var a=$n(e.keys()),u=a.next();!u.done;u=a.next()){var c=Jn(u.value,2),s=c[0],l=c[1],f=n.get(s,l);f==null||f.setStartTime(r)}}catch(d){i={error:d}}finally{try{u&&!u.done&&(o=a.return)&&o.call(a)}finally{if(i)throw i.error}}return n},t}();function ic(t){return Array.from(t.entries())}var oc=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),ac=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){a={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o};(function(t){oc(e,t);function e(n,r,i){var o=t.call(this,n)||this;return o._attributesProcessor=i,o._deltaMetricStorage=new Jr(r),o._temporalMetricStorage=new Qr(r),o}return e.prototype.record=function(n,r){var i=this,o=new Ne;Array.from(n.entries()).forEach(function(a){var u=ac(a,2),c=u[0],s=u[1];o.set(i._attributesProcessor.process(c),s)}),this._deltaMetricStorage.batchCumulate(o,r)},e.prototype.collect=function(n,r,i){var o=this._deltaMetricStorage.collect();return this._temporalMetricStorage.buildMetrics(n,r,this._instrumentDescriptor,o,i)},e})($r);var sc=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();(function(t){sc(e,t);function e(n,r,i){var o=t.call(this,n)||this;return o._attributesProcessor=i,o._deltaMetricStorage=new Jr(r),o._temporalMetricStorage=new Qr(r),o}return e.prototype.record=function(n,r,i,o){r=this._attributesProcessor.process(r,i),this._deltaMetricStorage.record(n,r,i,o)},e.prototype.collect=function(n,r,i){var o=this._deltaMetricStorage.collect();return this._temporalMetricStorage.buildMetrics(n,r,this._instrumentDescriptor,o,i)},e})($r);var Zr=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),ei=function(){function t(){}return t.Noop=function(){return cc},t}(),uc=function(t){Zr(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.process=function(n,r){return n},e}(ei);(function(t){Zr(e,t);function e(n){var r=t.call(this)||this;return r._allowedAttributeNames=n,r}return e.prototype.process=function(n,r){var i=this,o={};return Object.keys(n).filter(function(a){return i._allowedAttributeNames.includes(a)}).forEach(function(a){return o[a]=n[a]}),o},e})(ei);var cc=new uc,lc=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Zt="v1/traces",fc="http://localhost:4318/"+Zt,dc=function(t){lc(e,t);function e(n){n===void 0&&(n={});var r=t.call(this,n)||this;return r._headers=Object.assign(r._headers,gr(X().OTEL_EXPORTER_OTLP_TRACES_HEADERS)),r}return e.prototype.convert=function(n){return _u(n,!0)},e.prototype.getDefaultUrl=function(n){return typeof n.url=="string"?n.url:X().OTEL_EXPORTER_OTLP_TRACES_ENDPOINT.length>0?Js(X().OTEL_EXPORTER_OTLP_TRACES_ENDPOINT,Zt):X().OTEL_EXPORTER_OTLP_ENDPOINT.length>0?$s(X().OTEL_EXPORTER_OTLP_ENDPOINT,Zt):fc},e}(au),Qn="http://localhost:4318/v1/traces",Oe=function(){var t,e;return{init:function(n){var r;e||(n.url=n.url||Qn,n.webSDKVersion=n.webSDKVersion||"unknown",t=new Ys({resource:new Zo((r={},r[P.SERVICE_NAME]="smwebsdk",r[P.SERVICE_VERSION]=n.webSDKVersion,r))}),t.addSpanProcessor(new Gr(new dc({url:n.url,headers:{Authorization:"Bearer "+n.jwt}}))),t.register(),e=t.getTracer("smwebsdk"))},isInitialized:function(){return!!e},getTracer:function(){return e},defaultUrl:Qn}}();Object.freeze(Oe);var _c=typeof process<"u"&&"15.7.0"||"unknown";function hc(t){return new Promise(function(e){return setTimeout(function(){return e()},t)})}var pc=50,vc=200,Ec=1;function gc(t,e,n){return e===void 0&&(e={}),T(this,void 0,void 0,function(){var r,i,o,a,u,c;return S(this,function(s){switch(s.label){case 0:r=[],i=e.maxRetries||pc,o=e.delayMs||vc,u=0,s.label=1;case 1:if(!(u<i))return[3,8];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,t()];case 3:return a=s.sent(),n.connectionResult={message:"success",value:a,retries:r},[3,6];case 4:if(c=s.sent(),r.push(c),n.connectionResult={message:"failed",retries:r},c instanceof Error&&c.name==="noSessionToResume"&&et(),!(c instanceof Error)||c.name!=="noScene")throw c;if(r.length===i)throw console.warn("Retry gave up after ".concat(i,` retries:
`).concat(r.map(function(l){return l instanceof Error?l.message:l.toString()}).join(`
`))),c;return[4,hc(o)];case 5:return s.sent(),[3,7];case 6:return[3,8];case 7:return u++,[3,1];case 8:return[2,a]}})})}function mc(t,e,n){sessionStorage.setItem("sm-server",t),sessionStorage.setItem("sm-session-id",e),sessionStorage.setItem("sm-api-key",n)}function Zn(){return{server:sessionStorage.getItem("sm-server"),resumeSessionId:sessionStorage.getItem("sm-session-id"),savedApiKey:sessionStorage.getItem("sm-api-key")}}function et(){sessionStorage.removeItem("sm-server"),sessionStorage.removeItem("sm-session-id"),sessionStorage.removeItem("sm-api-key")}var ti=function(){function t(e,n,r,i,o,a,u){n===void 0&&(n=!1),r===void 0&&(r=p.MicrophoneAndCamera),i===void 0&&(i=p.Microphone);var c=this;if(this._onConversationResultEvents={},this._onSpeechMarkerEvents={},this._session=void 0,this._isWebSocketOnly=!1,this._transactionId=0,this._pendingResponses={},this._microphoneUnmuteTimer=void 0,this._echoCancellationEnabled=!0,this._serverControlledCameras=!1,this._stopSpeakingWhenNotVisible=!0,this._loggingConfig={session:{},contentAwareness:{}},this._logger=new K,this._tracerOptions={disableTracing:!1,parentCtx:$,url:Oe.defaultUrl},this._sessionResumeEnabled=!1,this._isResumedSession=!1,this._sendMetadata={pageUrl:!1},this._onMicrophoneActive=new L,this._onCameraActive=new L,this.currentPersonaId=Ec,this.version={webSdk:_c,platformSdk:"unknown"},this.iosVisibilityChange=function(){var f=document.visibilityState==="visible";setTimeout(function(){c._session&&c._session.sendRtcEvent("ui",{visible:f})},500)},this.stopSpeakingWhenNotVisible=function(){document.visibilityState!=="visible"&&c.sendRequest("stopSpeaking",{personaId:c.currentPersonaId})},this.stopSpeakingWhenUnloaded=function(){c.sendRequest("stopSpeaking",{personaId:c.currentPersonaId})},this.isSceneOptions(e)){var s=e;this._videoElement=s.videoElement,this._apiKey=s.apiKey,this._audioOnly=s.audioOnly||n,s.stopSpeakingWhenNotVisible===!1&&(this._stopSpeakingWhenNotVisible=!1),this._requestedUserMedia=Cn(s.requestedMediaDevices,r),this._requiredUserMedia=Cn(s.requiredMediaDevices,i),this.contentAwarenessDebounceTime=s.contentAwarenessDebounceTime,this._loggingConfig=k(k({},this._loggingConfig),s.loggingConfig||{}),s.sendMetadata&&(this._sendMetadata=s.sendMetadata),s.tracerOptions&&(this._tracerOptions=s.tracerOptions)}else this._videoElement=e,this._audioOnly=n,this._requestedUserMedia=r,this._requiredUserMedia=i,this.contentAwarenessDebounceTime=o,this._loggingConfig=k(k({},this._loggingConfig),a),u&&(this._tracerOptions=u);this._logger=new K(this._loggingConfig.session.minLogLevel,this._loggingConfig.session.enabled),this._onStateEvent=new L,this._onStateEvent.addListener(function(f,d){c._onState&&c._onState(f,d)}),this._onRecognizeResultsEvent=new L,this._onRecognizeResultsEvent.addListener(function(f,d,h,v){c._onRecognizeResults&&c._onRecognizeResults(f,d,h,v)}),this._onDisconnectedEvent=new L,this._onDisconnectedEvent.addListener(function(f,d,h){et(),c.cleanupEventListeners(),c._onDisconnected&&c._onDisconnected(f,d,h)}),this._onUserTextEvent=new L,this._onUserTextEvent.addListener(function(f,d){c._onUserText&&c._onUserText(f,d)}),this._onDemoModeEvent=new L,this._underRuntimeHost=!!window.SmIsUnderRuntimeHost;var l=new Uint32Array(3);window.crypto.getRandomValues(l),this._sceneId=l.toString().replace(/,/g,"-"),this.conversation=new To,this.connectionState=new Oo,this._metadataSender=new So(this),this._logger.log("debug","websdk version:",this.version.webSdk)}return t.prototype.isSceneOptions=function(e){var n=!!e,r=!!(e!=null&&e.tagName);return n&&!r},t.prototype.connectionValid=function(){return!!(this._underRuntimeHost||this._session&&this._session.serverConnection)},t.prototype.isConnected=function(){return!!(this.connectionValid()&&this._session&&this._session.serverConnection&&this._session.serverConnection.readyState===this._session.serverConnection.OPEN)},t.prototype.keepAlive=function(){this._session&&this._session.peerConnection!==null&&this._session.sendRtcEvent("keepAlive",{})},t.prototype.disconnect=function(){var e,n;et(),this.cleanupEventListeners(),this.connectionState.reset(),this.conversation.reset(),(e=this.contentAwareness)===null||e===void 0||e.disconnect(),this._metadataSender.disconnect(),(n=this._session)===null||n===void 0||n.close(!0),this._session=void 0},t.prototype.connect=function(e,n,r,i){var o,a,u;return T(this,void 0,void 0,function(){var c,s,l,f,d,h,v,m,O,b,A,C,I=this;return S(this,function(R){switch(R.label){case 0:return c=Date.now(),s=this.connectArgsToConfig(e,n,r,i),f=function(E){l==null||l.addEvent(E.name)},this.connectionState.onConnectionStateUpdated.addListener(f),this._underRuntimeHost?(this._session=new ai(this._videoElement,this._logger),[3,8]):[3,1];case 1:if(d=s.tokenServerUri||s.tokenServerAccessToken,this._apiKey&&d&&this._logger.log("warn","You are trying to connect via an API key and a token server. Please use one or the other"),!(this._apiKey&&!d))return[3,6];R.label=2;case 2:return R.trys.push([2,5,,6]),[4,this.fetchAuthConfig(this._apiKey)];case 3:return h=R.sent(),[4,h.json()];case 4:return v=R.sent(),m=Zn().server,s.tokenServerUri=v.url,s.tokenServerAccessToken=v.jwt,m&&(s.tokenServerUri=wn(v.url)+"server/"+m),[3,6];case 5:throw O=R.sent(),O instanceof Error&&O.message==="Broken API key"?this._logger.log("error","Broken API key. Please check your key or re copy the key from DDNA Studio."):this._logger.log("error","Invalid API key: Please check your key configuration in DDNA Studio. For more information click here https://soulmachines-support.atlassian.net/wiki/spaces/SSAS/pages/1320058919/Connecting+Using+API+Keys#Troubleshooting"),y("Invalid API key","serverConnectionFailed");case 6:if(!s.tokenServerUri||!s.tokenServerAccessToken)throw y("Please authenticate via an API key or with a serverUri and accessToken","serverConnectionFailed");return[4,this.initializeTracer(s.tokenServerUri,s.tokenServerAccessToken)];case 7:b=R.sent(),A=b.initTracerStartTime,C=b.initTracerEndTime,l=(u=(a=(o=Oe.getTracer())===null||o===void 0?void 0:o.startSpan("createSessionAndConnect"))===null||a===void 0?void 0:a.setAttribute("sm.websdk.connection.pretraceinitduration.milliseconds",A-c))===null||u===void 0?void 0:u.setAttribute("sm.websdk.connection.traceinitduration.milliseconds",C-A),this._isWebSocketOnly?this._session=new ci(s.tokenServerUri,s.tokenServerAccessToken,this._logger):this._session=new ui(this._videoElement,s.tokenServerUri,s.userText,s.tokenServerAccessToken,this._audioOnly,this._requestedUserMedia,this._requiredUserMedia,this._echoCancellationEnabled,this._logger,this.connectionState),R.label=8;case 8:if(!this._session)throw y("Failed to create session","unknown");return this._session.onConnected=this.sessionConnected.bind(this),this._session.onMessage=this.onMessage.bind(this),this._session.onClose=this.sessionClosed.bind(this),this._session.onUserText=this.rtcUserText.bind(this),"microphoneActiveCallbacks"in this._session&&(this._session.microphoneActiveCallbacks=this._onMicrophoneActive),"cameraActiveCallbacks"in this._session&&(this._session.cameraActiveCallbacks=this._onCameraActive),this._session.features.isIos&&document.addEventListener("visibilitychange",this.iosVisibilityChange),[4,gc(function(){return T(I,void 0,void 0,function(){return S(this,function(E){switch(E.label){case 0:return[4,this._session.connect()];case 1:return[2,E.sent()]}})})},s.retryOptions,this).finally(function(){I.connectionState.onConnectionStateUpdated.removeListener(f),l==null||l.end()})];case 9:return[2,R.sent()]}})})},t.prototype.initializeTracer=function(e,n){return T(this,void 0,void 0,function(){var r,i,o;return S(this,function(a){switch(a.label){case 0:if(r=Date.now(),!(!this._tracerOptions.disableTracing&&!Oe.isInitialized()))return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.initTelemetryToken({tokenServerUri:e,authToken:n})];case 2:return a.sent(),[3,4];case 3:return i=a.sent(),o="Could not initialize tracer telemetry token: ",i instanceof ReferenceError&&i.message==="fetch is not defined"?this._logger.log("debug",o+i.name+": "+i.message):i instanceof Error?this._logger.log("warn",o+i.name+": "+i.message):this._logger.log("warn",o+"unknown error type"),[3,4];case 4:return[2,{initTracerStartTime:r,initTracerEndTime:Date.now()}]}})})},t.prototype.initTelemetryToken=function(e){var n=e.tokenServerUri,r=e.authToken;return T(this,void 0,void 0,function(){var i,o,a,u,c;return S(this,function(s){switch(s.label){case 0:return i="api/telemetry/jwt",o="api/telemetry/v1/traces",a=wn(go(n)),a?[4,fetch(a+i,{headers:{Authorization:"Bearer "+r}})]:(this._logger.log("debug","Could not initialize tracer telemetry token: invalid token server URI"),[2]);case 1:return u=s.sent(),u?u.ok?[4,u.json()]:(this._logger.log("warn","Failed to fetch otel token: "+u.status+": "+u.statusText),[2]):(this._logger.log("warn","Failed to receive response from otel token endpoint"),[2]);case 2:if(c=s.sent(),!c.success)return this._logger.log("warn","Failed: otel response not successful"),[2];try{Oe.init({jwt:c.telemetryJwt,url:a+o,webSDKVersion:this.version.webSdk}),this._logger.log("log","Telemetry initialized")}catch(l){l instanceof Error?this._logger.log("warn","Failed to initialize tracer: "+l.message):this._logger.log("warn","Failed to initialize tracer: unknown error")}return[2]}})})},t.prototype.onMessage=function(e){var n=e.category;if(n==="scene"){var r=e;this.onSceneMessage(r);return}},t.prototype.sendOnewaySceneRequest=function(e,n){if(this._session){var r={name:e,body:n,category:nt.Scene,kind:Ae.Request};this._session.sendMessage(r)}},t.prototype.sendRequest=function(e,n){var r=this;return n===void 0&&(n={}),new Promise(function(i,o){if(!r._session){o(y("No session available","noSession"));return}var a=r._sceneId+"_"+ ++r._transactionId,u={transaction:a,name:e,body:n,category:nt.Scene,kind:Ae.Request},c={resolve:i,reject:o};r._pendingResponses[a]=c,r._session&&r._session.sendMessage(u)})},t.prototype.onSceneMessage=function(e){var n,r,i,o=e.name,a=e.body,u=e.kind,c=e.status,s=e.transaction;if(a&&o==="state"){var l=a;this._onStateEvent.call(this,l),!((n=l.scene)===null||n===void 0)&&n.featureFlags&&this.enableFlaggedFeatures(l.scene.featureFlags),!((r=l.scene)===null||r===void 0)&&r.sdkVersion&&(this.version.platformSdk=(i=l.scene)===null||i===void 0?void 0:i.sdkVersion,this._logger.log("debug","platformSdk version:",this.version.platformSdk)),this.conversation.processStateMessage(l),this.controlMicrophoneMute(a)}else if(a&&o==="recognizeResults"){var f=a,d=f.status,h=f.errorMessage,v=f.results;this.conversation.processRecognizeResultsMessage(a),this._onRecognizeResultsEvent.call(this,d,h,v)}else if(a&&o==="conversationResult"){this.conversation.onConversationResult(a);var m=a.personaId;if(m){var O=new tt(this,m),b=this._onConversationResultEvents[m];b.call(O,a),this.currentPersonaId=m}}else if(a&&o==="speechMarker"){this.conversation.onSpeechMarker(a);var m=a.personaId;if(m){var O=new tt(this,m),A=this._onSpeechMarkerEvents[m];A.call(O,a),this.currentPersonaId=m}}else a&&o==="demoMode"&&this._onDemoModeEvent.call(this,a);u===Ae.Response&&s&&this.processResponse(a,o,c,s)},t.prototype.processResponse=function(e,n,r,i){var o=this._pendingResponses[i];if(o){if(r===0)o.resolve(e);else{var a=new si;a.requestName=n,a.status=r,a.responseBody=e,o.reject(a)}delete this._pendingResponses[i]}},t.prototype.controlMicrophoneMute=function(e){var n=this;if(e.persona&&this._session&&this._session.microphoneMuteDelay!==-1)for(var r in e.persona){var i=e.persona[r];i.speechState&&(i.speechState===Me.Speaking?(this._session.microphoneMuted||(this._logger.log("warn","Persona is speaking - mute microphone"),this._session.microphoneMuted=!0),this._microphoneUnmuteTimer&&(clearTimeout(this._microphoneUnmuteTimer),this._microphoneUnmuteTimer=void 0)):this._session.microphoneMuted&&!this._microphoneUnmuteTimer&&(this._microphoneUnmuteTimer=setTimeout(function(){!n._session||!n._microphoneUnmuteTimer||(n._logger.log("warn","Persona is no longer speaking - unmute microphone"),n._session.microphoneMuted=!1,n._microphoneUnmuteTimer=void 0)},this._session.microphoneMuteDelay)))}},t.prototype.close=function(){this._session&&this._session.close(!0)},t.prototype.sessionConnected=function(e,n,r,i){this.contentAwareness=new Li(this,this.contentAwarenessDebounceTime,new K(this._loggingConfig.contentAwareness.minLogLevel,this._loggingConfig.contentAwareness.enabled)),this._stopSpeakingWhenNotVisible&&document.addEventListener("visibilitychange",this.stopSpeakingWhenNotVisible),window.addEventListener("beforeunload",this.stopSpeakingWhenUnloaded),this._sendMetadata.pageUrl&&this._metadataSender.observeUrlChanges(),this._isResumedSession=n,e&&(this._sessionResumeEnabled=!0,mc(r,i,this._apiKey||"")),n&&this._sendMetadata.pageUrl&&this._metadataSender.send()},t.prototype.cleanupEventListeners=function(){var e;!((e=this._session)===null||e===void 0)&&e.features.isIos&&document.removeEventListener("visibilitychange",this.iosVisibilityChange),this._stopSpeakingWhenNotVisible&&document.removeEventListener("visibilitychange",this.stopSpeakingWhenNotVisible),window.removeEventListener("beforeunload",this.stopSpeakingWhenUnloaded)},t.prototype.sessionClosed=function(e){et(),this.cleanupEventListeners(),this._session&&(this.connectionState.reset(),this.conversation.reset(),this._onDisconnectedEvent.call(this,this._session.sessionId,e))},t.prototype.rtcUserText=function(e){this._onUserTextEvent.call(this,e)},t.prototype.enableFlaggedFeatures=function(e){this._serverControlledCameras=e.includes(Bt.UI_SDK_CAMERA_CONTROL)},t.prototype.sendContent=function(){var e;this.contentAwareness||console.warn("ContentAwareness is not enabled for this project"),(e=this.contentAwareness)===null||e===void 0||e.measure()},t.prototype.sendVideoBounds=function(e,n){this._session&&this._session.sendVideoBounds(e,n)},t.prototype.configure=function(e){return this.sendRequest("configure",e)},t.prototype.sendUserText=function(e){this._session&&this._session.sendUserText(e)},t.prototype.startRecognize=function(e){var n={};return e!==void 0&&(n.audioSource=e),this.sendRequest("startRecognize",n)},t.prototype.stopRecognize=function(){return this.sendRequest("stopRecognize")},t.prototype.isMicrophoneConnected=function(){return this._session?this._session.isMicrophoneConnected:!1},t.prototype.isCameraConnected=function(){return this._session?this._session.isCameraConnected:!1},t.prototype.session=function(){return this._session},t.prototype.hasContentAwareness=function(){return!!this.contentAwareness},t.prototype.hasServerControlledCameras=function(){return this._serverControlledCameras},t.prototype.supportsSessionPersistence=function(){return this._sessionResumeEnabled},t.prototype.isResumedSession=function(){return this._isResumedSession},Object.defineProperty(t.prototype,"onConversationResultEvents",{get:function(){return this._onConversationResultEvents},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onSpeechMarkerEvents",{get:function(){return this._onSpeechMarkerEvents},enumerable:!1,configurable:!0}),t.prototype.getState=function(){return T(this,void 0,void 0,function(){return S(this,function(e){return[2,this.sendRequest("getState")]})})},Object.defineProperty(t.prototype,"onStateEvent",{get:function(){return this._onStateEvent},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onState",{set:function(e){this._onState=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onDisconnectedEvent",{get:function(){return this._onDisconnectedEvent},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onDisconnected",{set:function(e){this._onDisconnected=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onRecognizeResultsEvent",{get:function(){return this._onRecognizeResultsEvent},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onRecognizeResults",{set:function(e){this._onRecognizeResults=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onUserTextEvent",{get:function(){return this._onUserTextEvent},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onUserText",{set:function(e){this._onUserText=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"echoCancellationEnabled",{get:function(){return this._echoCancellationEnabled},set:function(e){this._echoCancellationEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onDemoModeEvent",{get:function(){return this._onDemoModeEvent},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoElement",{get:function(){return this._videoElement},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"viewerOffsetX",{get:function(){return this._session?this._session.offsetX:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"viewerOffsetY",{get:function(){return this._session?this._session.offsetY:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isWebSocketOnly",{get:function(){return this._isWebSocketOnly},set:function(e){this._isWebSocketOnly=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onMicrophoneActive",{get:function(){return this._onMicrophoneActive},enumerable:!1,configurable:!0}),t.prototype.isMicrophoneActive=function(){var e;return!!(!((e=this._session)===null||e===void 0)&&e.isMicrophoneActive())},Object.defineProperty(t.prototype,"onCameraActive",{get:function(){return this._onCameraActive},enumerable:!1,configurable:!0}),t.prototype.isCameraActive=function(){var e;return!!(!((e=this._session)===null||e===void 0)&&e.isCameraActive())},t.prototype.setMediaDeviceActive=function(e){var n;return T(this,void 0,void 0,function(){return S(this,function(r){switch(r.label){case 0:return this.isConnected()?[4,(n=this._session)===null||n===void 0?void 0:n.setMediaDeviceActive({microphone:e.microphone,camera:e.camera})]:[3,2];case 1:return r.sent(),[3,3];case 2:throw y("Connection has not been established","noConnection");case 3:return[2]}})})},t.prototype.startVideo=function(e){return T(this,void 0,void 0,function(){var n;return S(this,function(r){switch(r.label){case 0:if(n=e||this._videoElement,!n)throw y("Cannot find HTMLVideoElement","noVideoElement");return[4,this.playVideo(n)];case 1:return r.sent()?[2,{video:!0,audio:!0}]:(n.muted=!0,[4,this.playVideo(n)]);case 2:if(r.sent())return[2,{video:!0,audio:!1}];throw y("Cannot start media playback","userInteractionRequired")}})})},t.prototype.playVideo=function(e){return T(this,void 0,void 0,function(){return S(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e.play()];case 1:return n.sent(),[2,!0];case 2:return n.sent(),[2,!1];case 3:return[2]}})})},t.prototype.fetchAuthConfig=function(e){var n;try{var r=JSON.parse(atob(e));n=r.authServer}catch{throw y("Broken API key","Failed to decode api key")}var i=Zn(),o=i.server,a=i.resumeSessionId,u=i.savedApiKey;return o&&a&&u===e&&(n=n+"?sessionId="+a),fetch(n,{headers:{key:e}})},t.prototype.connectArgsToConfig=function(e,n,r,i){var o,a;return typeof e=="string"?{tokenServerUri:e,tokenServerAccessToken:r,userText:n,retryOptions:i}:{tokenServerUri:((o=e==null?void 0:e.tokenServer)===null||o===void 0?void 0:o.uri)||"",tokenServerAccessToken:(a=e==null?void 0:e.tokenServer)===null||a===void 0?void 0:a.token,userText:e==null?void 0:e.userText,retryOptions:e==null?void 0:e.retryOptions}},t.prototype.isLoggingEnabled=function(){return this._logger.isEnabled},t.prototype.getMinLogLevel=function(){return this._logger.getMinLogLevel()},t.prototype.setLogging=function(e){this._logger.enableLogging(e)},t.prototype.setMinLogLevel=function(e){this._logger.setMinLogLevel(e)},t}(),er;(function(t){t[t.none=0]="none",t[t.microphone=1]="microphone",t[t.microphoneAndCamera=2]="microphoneAndCamera",t[t.camera=3]="camera"})(er||(er={}));var yc=function(){function t(){this.Scene=ti,this.Persona=tt,this.userMedia={none:p.None,microphone:p.Microphone,microphoneAndCamera:p.MicrophoneAndCamera,camera:p.Camera},this.DetectCapabilities=function(){return new ft().detectWebRTCFeatures()},this.setLogging=function(e){}}return t}();new yc;const tr=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],V=(()=>{if(typeof document>"u")return!1;const t=tr[0],e={};for(const n of tr)if((n==null?void 0:n[1])in document){for(const[i,o]of n.entries())e[t[i]]=o;return e}return!1})(),nr={change:V.fullscreenchange,error:V.fullscreenerror};let N={request(t=document.documentElement,e){return new Promise((n,r)=>{const i=()=>{N.off("change",i),n()};N.on("change",i);const o=t[V.requestFullscreen](e);o instanceof Promise&&o.then(i).catch(r)})},exit(){return new Promise((t,e)=>{if(!N.isFullscreen){t();return}const n=()=>{N.off("change",n),t()};N.on("change",n);const r=document[V.exitFullscreen]();r instanceof Promise&&r.then(n).catch(e)})},toggle(t,e){return N.isFullscreen?N.exit():N.request(t,e)},onchange(t){N.on("change",t)},onerror(t){N.on("error",t)},on(t,e){const n=nr[t];n&&document.addEventListener(n,e,!1)},off(t,e){const n=nr[t];n&&document.removeEventListener(n,e,!1)},raw:V};Object.defineProperties(N,{isFullscreen:{get:()=>!!document[V.fullscreenElement]},element:{enumerable:!0,get:()=>document[V.fullscreenElement]??void 0},isEnabled:{enumerable:!0,get:()=>!!document[V.fullscreenEnabled]}});V||(N={isEnabled:!1});const rr=N,Tc=document.getElementById("target");document.getElementById("fullscreen-button").addEventListener("click",()=>{rr.isEnabled&&rr.toggle(Tc,{navigationUI:"hide"})});let pe,Lt=null;const Sc="1";async function Oc(){const t=document.getElementById("sm-video");pe=new ti({apiKey:"eyJzb3VsSWQiOiJkZG5hLXNhbmctaGFuLS1kZW1vYXBwIiwiYXV0aFNlcnZlciI6Imh0dHBzOi8vZGguYXouc291bG1hY2hpbmVzLmNsb3VkL2FwaS9qd3QiLCJhdXRoVG9rZW4iOiJhcGlrZXlfdjFfMDllYTEyN2YtYjU2NS00ZjZmLWJmNTUtMTFjNTQwZjU1MmUwIn0=",videoElement:t,requestedMediaDevices:{microphone:!0,camera:!0},requiredMediaDevices:{microphone:!0,camera:!0}}),await pe.connect().then(e=>bc(e)).catch(e=>Ac(e))}function bc(t){console.info("success! session id:",t),pe.startVideo().then(e=>console.info("started video with state:",e)).catch(e=>console.warn("could not start video:",e))}function Ac(t){switch(t.name){case"noUserMedia":console.warn("user blocked device access");break;case"noScene":case"serverConnectionFailed":console.warn("server connection failed");break;default:console.warn("unhandled error:",t)}}const ir=document.getElementById("connect-button");ir.addEventListener("click",()=>{const t=document.getElementById("sm-video");Oc(),ir.style.display="none",t.style.height="100%",t.style.width="100%"});function Rc(){console.log("stopSpeaking"),Lt||(Lt=new tt(pe,Sc)),Lt.stopSpeaking()}function Cc(){console.log("toggleUserMicrophone");const t=pe.isMicrophoneActive();pe.setMediaDeviceActive({microphone:!t}).then(()=>console.log("microphone active: "+t)).catch(e=>console.log("microphone update failed: ",e))}document.addEventListener("DOMContentLoaded",function(){document.getElementById("sm-video").addEventListener("click",function(e){console.log("Button Code:",e.button),e.button===0&&(Rc(),Cc())})});
